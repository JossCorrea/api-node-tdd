if (self.CavalryLogger) { CavalryLogger.start_js(["+4sWy"]); }

/**
 * @providesModule Shaka
 * @preserve-whitespace
 * @nopackage
 * @codegen-command: scripts/shaka-player/build/fb_build.sh
 * @generated
 */
__d("Shaka",["Promise","EventListener","VideoPlayerShakaPerformanceLogger","VideoPushParametersHelper","TimeSlice","VideoPlayerLocalBandwidthEstimator","VideoPlayerResourceTimer","ShakaSegmentReferenceHelper","SegmentRequestManager","concatArrayBuffer","BufferReplacementHelper","logLongAkamaiRequest","throttle","ViewportPriorityAdjuster","FirstLoadedVideoPriorityAdjuster","VideoPriorityCalculator","VideoStreamingManager","MultipleSegmentsProvider","LocalBitrateHelper","UnitConstants","BufferVelocity","VideoPlayerBitrateEstimator","VideoPlayerShakaGlobalConfig","getSeekRangeGapsFromShakaReferences","mergeSeekRangeGaps","NetworkStatusDetector","MosUtils","BanzaiODS","VideoDashPrefetchCache","VideoClientEdgeCooperation","VideoStreamingTaskQueueProvider","BinarySearch","ShakaTimelineSegmentIndexUtils","gkx","setTimeoutAcrossTransitions","setTimeout","setIntervalAcrossTransitions","setInterval","setImmediateAcrossTransitions","setImmediate","clearTimeout","clearInterval","clearImmediate","dispatchEvent","EventListener","Event","extractCEA608","performanceNow","parseHeaders","canUseFetchStream","SubscriptionsHandler","VideoPushTracker"],(function $module_Shaka(global,require,requireDynamic,requireLazy,module,exports){

// run `scripts/shaka-player/build/fb_build.sh` to regenerate Shaka.js after modifying this
// file

var Promise = require('Promise');
var EventListener = require('EventListener');
var VideoPlayerShakaPerformanceLogger = require('VideoPlayerShakaPerformanceLogger');
var VideoPushParametersHelper = require('VideoPushParametersHelper');
var TimeSlice = require('TimeSlice');
var VideoPlayerLocalBandwidthEstimator = require('VideoPlayerLocalBandwidthEstimator');
var VideoPlayerResourceTimer = require('VideoPlayerResourceTimer');
var ShakaSegmentReferenceHelper = require('ShakaSegmentReferenceHelper');
var SegmentRequestManager = require('SegmentRequestManager');
var concatArrayBuffer = require('concatArrayBuffer');
var BufferReplacementHelper = require('BufferReplacementHelper');
var logLongAkamaiRequest = require('logLongAkamaiRequest');
var throttle = require('throttle');
var ViewportPriorityAdjuster = require('ViewportPriorityAdjuster');
var FirstLoadedVideoPriorityAdjuster = require('FirstLoadedVideoPriorityAdjuster');
var VideoPriorityCalculator = require('VideoPriorityCalculator');
var VideoStreamingManager = require('VideoStreamingManager');
var MultipleSegmentsProvider = require('MultipleSegmentsProvider');
var LocalBitrateHelper = require('LocalBitrateHelper');
var UnitConstants = require('UnitConstants');
var BufferVelocity = require('BufferVelocity');
var VideoPlayerBitrateEstimator = require('VideoPlayerBitrateEstimator');
var VideoPlayerShakaGlobalConfig = require('VideoPlayerShakaGlobalConfig');
var getSeekRangeGapsFromShakaReferences = require('getSeekRangeGapsFromShakaReferences');
var mergeSeekRangeGaps = require('mergeSeekRangeGaps');
var NetworkStatusDetector = require('NetworkStatusDetector');
var MosUtils = require('MosUtils');
var BanzaiODS = require('BanzaiODS');
var VideoDashPrefetchCache = require('VideoDashPrefetchCache');
var VideoClientEdgeCooperation = require('VideoClientEdgeCooperation');
var VideoStreamingTaskQueueProvider = require('VideoStreamingTaskQueueProvider');
var BinarySearch = require('BinarySearch');
var ShakaTimelineSegmentIndexUtils = require('ShakaTimelineSegmentIndexUtils');
var gkx = require('gkx');

var setTimeout = VideoPlayerShakaGlobalConfig.getBool(
    'timeouts_persist_on_page_transition',
    true
  ) ?
  require('setTimeoutAcrossTransitions') :
  require('setTimeout');
var setInterval = VideoPlayerShakaGlobalConfig.getBool(
    'timeouts_persist_on_page_transition',
    true
  ) ?
  require('setIntervalAcrossTransitions') :
  require('setInterval');
var setImmediate = VideoPlayerShakaGlobalConfig.getBool(
    'timeouts_persist_on_page_transition',
    true
  ) ?
  require('setImmediateAcrossTransitions') :
  require('setImmediate');
var clearTimeout = require('clearTimeout');
var clearInterval = require('clearInterval');
var clearImmediate = require('clearImmediate');
var dispatchDomEvent = require('dispatchEvent');
var eventListenerCapture = require('EventListener').capture;
var eventKill = require('Event').kill;
var extractCEA608 = require('extractCEA608');
var performanceNow = require('performanceNow');
var parseHeaders = require('parseHeaders');
var canUseFetchStream = require('canUseFetchStream');
var SubscriptionsHandler = require('SubscriptionsHandler');
var VideoPushTracker = require('VideoPushTracker');

function setEventProperty(obj, name, handler) {
  obj[name] = TimeSlice.guard(handler, 'shaka ' + name);
};

if (
  VideoPlayerShakaGlobalConfig.getBool('shaka_native_promise', false) &&
  VideoPlayerShakaGlobalConfig.getBool('use_native_promise', true)
) {
  Promise = window.Promise;
}

var g = {};

(function(window){var n,aa=this;function q(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function r(a,b){function c(){}c.prototype=b.prototype;a.Pd=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Ld=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function ba(){};function ca(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}ca("error");ca("warn");ca("info");ca("log");ca("debug");var u={qa:function(a){u.Ib[a]={qa:u.wc(),end:NaN}},end:function(a){if(a=u.Ib[a])a.end=u.wc()},Md:function(a,b,c){var d=u.get(a),e=u.get(b);if(!d||!e)return NaN;d-=e;for(e=2;e<arguments.length;++e){var f=u.get(arguments[e]);if(!f)return NaN;d-=f}return d},get:function(a){return(a=u.Ib[a])&&a.end?a.end-a.qa:NaN}};u.wc=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now;u.Ib={};/*

 Copyright 2004-present Facebook. All Rights Reserved.

*/
function fa(a,b,c,d,e,f,g,h){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.streamInfoID=d;this.mimeType=e||"";this.codecs=f||"";this.channels=g||null;this.samplingRate=h||null;this.active=!1}q("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});var ga=VideoPlayerShakaGlobalConfig.getNumber("shaka_default_request_timeout_timescale",1E3),ha=Math.floor(VideoPlayerShakaGlobalConfig.getNumber("shaka_default_ajax_request_timeout_ms",0)/ga),ia=Math.floor(VideoPlayerShakaGlobalConfig.getNumber("shaka_default_ajax_request_timeout_ms",0)/ga),ja=Math.floor(VideoPlayerShakaGlobalConfig.getNumber("shaka_default_ajax_request_timeout_ms",0)/ga);function ka(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}ka.prototype.clone=function(){var a=new ka;a.maxHeight=this.maxHeight;a.minHeight=this.minHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};function la(){this.fontSize="100%";this.fontColor=ma;this.fontOpacity=oa;this.backgroundColor=pa;this.backgroundOpacity=oa;this.fontEdge=qa}q("shaka.player.TextStyle",la);
function ra(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+sa(a.fontColor,a.fontOpacity));b.push("background-color: "+sa(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){var e=a.fontEdge[d].slice(3,6);c.push(sa(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function sa(a,b){return"rgba("+a.concat(b).join(",")+")"}var ma=[255,255,255],pa=[0,0,0];
la.StandardColors={WHITE:ma,BLACK:pa,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var oa=1;la.StandardOpacities={OPAQUE:oa,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var qa=[];
la.EdgeStyles={NONE:qa,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function ta(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}q("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function ua(a,b,c,d,e,f,g,h,k,l,m,p,t){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.streamInfoID=e;this.fbQualityLabel=f;this.fbQualityClass=g;a=[];h&&(a=h.split(","));this.frameRate=k||"";this.mimeType=l||"";this.codecs=m||"";this.isHVQ=-1<a.indexOf("hvq");this.isInlineHVQ=-1<a.indexOf("hvq_www_inline");this.avoidOnPoorConnection=-1<a.indexOf("avoid_on_poor_connection");this.active=!1;this.playbackResolutionMos=p||null;this.playbackResolutionMosConfidenceLevel=t||null}
function va(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}q("shaka.player.VideoTrack.compare",va);function wa(a){for(var b=xa,c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};function ya(){return Date.now()+za}var za=0;function Ba(a){this.b=a;this.c=0==Ca;this.a=0}var Ca=1;function Da(a){return a.a<a.b.byteLength}function Ea(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function v(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function Fa(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function Ga(a){if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function Ha(a,b){if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function Ia(a){this.b=a;this.a=new Ba(a);Ja||(Ja=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var Ja;
function Ka(a){var b;b=La(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=La(a);a:{for(d=0;d<Ja.length;d++)if(Ma(c,Ja[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);Ha(a.a,c);return new Na(b,d)}function La(a){var b=Ea(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Ea(a.a);return d}function Na(a,b){this.id=a;this.a=b}
function Oa(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};var Pa={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function x(a){this.b=Math.exp(Math.log(.5)/a);this.yb=this.bb=this.a=0}q("shaka.util.EWMA",x);x.prototype.sample=function(a,b){var c=Math.pow(this.b,a);this.a=b*(1-c)+c*this.a;this.bb+=a;this.yb+=1};x.prototype.sample=x.prototype.sample;x.prototype.c=function(){return this.bb};x.prototype.getTotalWeight=x.prototype.c;x.prototype.getEstimate=function(){return this.a/(1-Math.pow(this.b,this.bb))};x.prototype.getEstimate=x.prototype.getEstimate;x.prototype.f=function(){this.yb=this.bb=this.a=0};
x.prototype.reset=x.prototype.f;var Qa=window.CustomEvent;"function"!==typeof Qa&&(Qa=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return c},Qa.prototype=window.Event.prototype);function y(a){var b=new Qa(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b||(b[c]=a[c]);return b}function A(a){return new Qa("error",{detail:a,bubbles:!0})};function Ra(a,b,c){Sa(b);Sa(c);return c==b||a>=Ta&&c==b.split("-")[0]||a>=Ua&&c.split("-")[0]==b.split("-")[0]?!0:!1}var Ta=1,Ua=2;function Sa(a){a=a.toLowerCase().split("-");var b=Va[a[0]];b&&(a[0]=b);return a.join("-")}
var Va={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function Wa(a){return Object.keys(a).map(function(b){return a[b]})}function B(a,b){return Xa(a,b,"boolean")}function C(a,b,c){a=Xa(a,b,"number");if(null==a)return null;if(isNaN(a)||a==Number.NEGATIVE_INFINITY||a==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(null!=c&&a<c)throw new RangeError("'"+b+"' must be >= "+c);return a}function Ya(a,b){return Xa(a,b,"string")}
function Xa(a,b,c){a=a[b];if(null==a)return null;if(typeof a!==c)throw new TypeError("'"+b+"' must be a "+c+".");return a}function Za(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function D(){this.a={}}D.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};D.prototype.set=function(a,b){this.a[a]=b};D.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function $a(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}D.prototype.remove=function(a,b){var c=this.a[a];if(c)for(var d=0;d<c.length;++d)c[d]==b&&(c.splice(d,1),--d)};function ab(a){var b=[],c;for(c in a.a)b.push(c);return b};function bb(){this.a=new D}bb.prototype.destroy=function(){db(this);this.a=null};function E(a,b,c,d){b=new eb(b,c,d);a.a.push(c,b)}bb.prototype.Va=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.Va(),this.a.remove(b,e))}};function db(a){for(var b=$a(a.a),c=0;c<b.length;++c)b[c].Va();a.a.a={}}function eb(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
eb.prototype.Va=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function F(a){this.Fb=new D;this.Ja=a}q("shaka.util.FakeEventTarget",F);n=F.prototype;n.addEventListener=function(a,b){this.Fb.push(a,b)};n.removeEventListener=function(a,b){this.Fb.remove(a,b)};
n.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return fb(this,
a)};n.oc=!1;n.La=function(a,b){return this.dispatchEvent(y({type:"debug/dashPlayerEvent",bubbles:!0,detail:{type:a,event:b}}))};function fb(a,b){b.currentTarget=a;for(var c=a.Fb.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){}}a.Ja&&b.bubbles&&fb(a.Ja,b);return b.defaultPrevented};function G(a){F.call(this,null);this.a={ob:{Xa:new x(VideoPlayerShakaGlobalConfig.getNumber("fast_moving_average_half_life",3)),xb:new x(VideoPlayerShakaGlobalConfig.getNumber("slow_moving_average_half_life",10))},eb:{Xa:new x(VideoPlayerShakaGlobalConfig.getNumber("aggressive_fast_moving_average_half_life",1E-4)),xb:new x(VideoPlayerShakaGlobalConfig.getNumber("aggressive_slow_moving_average_half_life",9.2335087917745))}};this.h=a||5E5;this.j=VideoPlayerShakaGlobalConfig.getNumber("min_sample_count",
1E4);this.b=0;this.c=[];this.i=VideoPlayerShakaGlobalConfig.getNumber("max_recent_bandwidth_samples",0)}r(G,F);q("shaka.util.EWMABandwidthEstimator",G);G.prototype.shouldExcludeSample=function(a,b){return VideoPlayerShakaGlobalConfig.getBool("change_abr_audio_exclusion_logic",!0)?!b:65536>a};
G.prototype.sample=function(a,b,c,d,e,f,g){if(this.shouldExcludeSample(b,c))e&&e.setEvent("unsampled").setReason("audio").log();else{if(VideoPlayerShakaGlobalConfig.getBool("use_resource_timing_entry_for_bandwidth",!0)){if(!d){e&&e.setEvent("unsampled").setReason("resource_timing_entry_missing").log();return}a=d.timeToLastByte;if(0>a){e&&e.setEvent("unsampled").setReason("resource_timing_entry_invalid").log();return}}a=Math.max(a,50);c=1E3*UnitConstants.BITS_IN_BYTE*b/a;var h=a/1E3;this.a.eb.Xa.sample(h,
c,d);this.a.eb.xb.sample(h,c,d);this.a.ob.Xa.sample(h,c,d);this.a.ob.xb.sample(h,c,d);g||this.dispatchEvent(y({type:"bandwidth"}));this.b=Date.now();d=parseInt(a,10);if(0<this.i)for(this.c.push([b,d]);this.c.length>this.i;)this.c.shift();e&&e.setEvent("sampled").setBytes(b).setDelayMs(d).log();f&&f.getEventLogger("bandwidth_sampled").setLength(b).setClientTimeBegin(this.b-d).setClientTimeEnd(this.b).log()}};
G.prototype.getBandwidth=function(a){a="aggressive"===a?this.a.eb:this.a.ob;return this.canTrustEstimate()?Math.min(a.Xa.getEstimate(),a.xb.getEstimate()):this.h};G.prototype.getFastMovingBandwidth=function(a){a="aggressive"===a?this.a.eb:this.a.ob;return this.canTrustEstimate()?a.Xa.getEstimate():this.h};G.prototype.getDataAge=function(){return(Date.now()-this.b)/1E3};G.prototype.canTrustEstimate=function(a){var b=this.a.eb.Xa;return b.bb>=(void 0===a?.5:a)||b.yb>=this.j};
G.prototype.supportsCaching=function(){return!1};G.prototype.setRepresentationID=function(){};G.prototype.flushABREvaluationSet=function(){return[]};G.prototype.getRecentSamples=function(){return this.c};/*

 Copyright 2015 Facebook Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function gb(a,b,c,d){G.call(this,d);this.g=a||0;this.f=void 0===b?Infinity:b;this.m=c}r(gb,G);q("shaka.util.EWMACacheBandwidthEstimator",gb);
gb.prototype.sample=function(a,b,c,d,e,f,g,h){var k=8E3*b/a;e&&e.setBytes(b).setDelayMs(parseInt(a,10));a<=this.g&&k>this.f&&!h?(e&&e.setEvent("unsampled").setReason("cached").log(),f&&!this.shouldExcludeSample(b,c)&&f.getEventLogger("bandwidth_sampled").setResult("aborted").setLength(b).setClientTimeBegin(Date.now()-parseInt(a,10)).setClientTimeEnd(Date.now()).log(),this.m()):G.prototype.sample.call(this,a,b,c,d,e,f,g)};gb.prototype.supportsCaching=function(){return Infinity!==this.f&&!!this.g};
gb.prototype.setRepresentationID=function(){};gb.prototype.flushABREvaluationSet=function(){return[]};function hb(){G.call(this)}r(hb,G);q("shaka.util.EWMASignedURLBandwidthEstimator",hb);hb.prototype.supportsCaching=function(){return!0};function I(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=I.prototype.destroy;return c}I.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function ib(a){a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function jb(){this.lb=new I;this.c=!1;this.Aa=null;this.a=[];this.b=null}function kb(a,b){if(a.c)throw Error("Cannot append to a running task!");a.a.push(b)}jb.prototype.start=function(){if(this.c)throw Error("Task already started!");this.c=!0;this.a.unshift(function(){});lb(this,void 0)};jb.prototype.abort=function(){if(this.Aa)return this.Aa;if(!this.c)return this.c=!0,Promise.resolve();this.b&&(this.f=this.b());return this.Aa=new I};jb.prototype.end=function(){this.a.splice(1)};
function lb(a,b){var c=a.a[0](b),d;c?(d=c[0],a.b=c[1]):(d=Promise.resolve(),a.b=null);d.then(J(a,function(a){this.Aa?(this.a=[],this.b=null,mb(this)):(this.a.shift(),this.a.length?lb(this,a):(this.lb.resolve(a),this.b=null))})).catch(J(a,function(a){this.a=[];this.b=null;this.Aa?mb(this):this.lb.reject(a)}))}
function mb(a){function b(){var a=Error("Task aborted.");a.type="aborted";this.lb.reject(a);setTimeout(function(){this.Aa.resolve();this.Aa=null}.bind(this),5)}a.f?a.f.then(function(){this.f=null;b.call(this)}.bind(a)):b.call(a)};function J(a,b){return b.bind(a)};function nb(a,b,c,d,e,f,g){MediaSource.isTypeSupported(c);F.call(this,e);e=b.addSourceBuffer(c);this.h=a;this.A=b;this.a=e;this.J=d;this.B=new bb;this.I=this.l=this.Y=this.i=null;this.R=!1;this.P=this.K=this.O=0;this.G=null;this.V=this.F=!1;this.Z=f;this.D=null;this.$=g?g:null;this.b=[];this.U=0;this.m=this.c=this.f=null;this.T=ja;this.o=this.u=0;this.w=this.S=!1;this.g=c&&c.charAt(0);E(this.B,this.a,"updateend",this.nd.bind(this));this.h.getBool("listen_for_async_append_buffer_errors",!0)&&E(this.B,
this.a,"error",this.ad.bind(this));this.j=null}r(nb,F);nb.prototype.Ba=function(){return{SourceBuffer:this.a}};function ob(a,b,c){a.oc&&a.La(b,{type:a.g.charAt(0),segment:c,sourceBuffer:a.a})}var pb=1/60;nb.prototype.destroy=function(){this.abort().catch(function(){});this.c&&this.c.destroy();this.b=this.f=this.c=null;this.B.destroy();this.A=this.a=this.D=this.B=null};function qb(a){var b=a.b.length;return 0<b?a.b[b-1]:null}
function rb(a,b){for(var c=a.a.buffered,d=0;d<c.length;++d){var e=c.start(d)-pb,f=c.end(d)+pb;if(b>=e&&b<=f)return c.end(d)-b}return 0}function sb(a,b,c){var d=b.endTime?b.endTime-b.startTime:1,e=new tb;e.Na=3;e.c=1E3*d;e.b=1E3*a.T;e.u=a.Y;e.j=c;e.da=a.Z;e.mimeType=a.g;e.h=a.$;e.o=b.isPredictive;return e}n=nb.prototype;
n.fetch=function(a,b,c,d,e,f,g,h){var k,l=f?"replacing_lower_quality_buffer":null;if(this.l){var m=this.b[this.b.length-1],p=null;m&&(p=1E3*(a.startTime-m.endTime));k=this.l.getOperationLogger("fetch").setReason(l).setResource(ub(a.url)).setType(vb(this)).setLength(Math.round(1E3*(a.endTime-a.startTime))).setSegmentStartTime(1E3*a.startTime).setSegmentEndTime(1E3*a.endTime).setSegmentTimeGap(p).start()}this.j=k;if(this.f){if(this.h.getBool("sbm_enable_concurrent_fetch_requests",!1)){var t=[].slice.call(arguments);
return this.f.lb.then(J(this,function(){return this.fetch.apply(this,t)}),function(a){throw a;})}m=Error("Cannot fetch ("+this.g+"): previous operation not complete.");this.u>=this.O?(m.type="stream",k&&k.setError(m).log(),this.u=0):(this.u++,m.type="aborted");return Promise.reject(m)}this.f=new jb;c!=this.a.timestampOffset&&(this.a.timestampOffset=c);var m=sb(this,a,e),p=this.h.getBool("enable_streaming_code_path",!0),w;w=p?a.url.stream(m,this.J,this.l,this.j,this.I,vb(this),l,g,h):a.url.fetch(m,
this.J,this.l,this.j,this.I,vb(this),l,g);ob(this,"SegmentFetching",a);var z=K.prototype.Ka.bind(a.url);this.G&&this.F&&(d=this.G);var H=0,da=null;d&&(this.G=d,this.F=!1,kb(this.f,function(){return[d.then(function(a){a.$a>H&&(H=a.$a);return wb(this,a,null)}.bind(this)),this.cb.bind(this)]}.bind(this)));var ea=function(a){a.$a>H&&(H=a.$a);da=a.byteLength;this.J.getBandwidth();this.S&&this.dispatchEvent(y({type:"cea608CaptionsBytesReceived",bubbles:!0,detail:{timescale:b,videoBytes:a}}))}.bind(this);
p?(h&&(m=h.getProgressTracker(),this.i!==m&&(this.i=m)),kb(this.f,J(this,function(){var b=null,c=Math.max(0,(a.url.endByte||0)-a.url.startByte),d=this.h.getNumber("streaming_append_per_segment",3),e=0===d?0:c/d;return[w.then(function(c){b=c;this.w=!1;return xb(this,c,a,e)}.bind(this)).then(function(a){b=null;return a}).then(ea).catch(function(a){this.h.getBool("abort_fetch_on_net_error",!1)&&h&&(this.a.abort(),this.w=!0);return Promise.reject(a)}.bind(this)),function(){ob(this,"SegmentFailed",a);
b&&(b.cancel("abort"),b=null,h&&(this.a.abort(),this.w=!0));z();return this.cb()}.bind(this)]}))):kb(this.f,J(this,function(){return[w.then(function(b){ob(this,"SegmentFetched",a);ea(b);return wb(this,b,a,l)}.bind(this)),function(){ob(this,"SegmentFailed",a);z();return this.cb()}.bind(this)]}));var Aa=0==this.a.buffered.length&&0==this.b.length,cb=null;kb(this.f,function(){if(0==this.a.buffered.length&&!this.V){var b=Error("Failed to buffer segment ("+this.g+").");b.type="stream";return[Promise.reject(b)]}this.a.buffered.length&&
Aa&&(b=a.startTime,cb=this.a.buffered.start(0)-b);b=yb(this.b,a.startTime);0<=b?this.b.splice(b+1,0,a):this.b.push(a)}.bind(this));this.u=0;return zb(this).then(function(){k&&k.log();return Promise.resolve({W:cb,Wc:H,H:a.endTime-a.startTime,Dc:da})}.bind(this),function(a){k&&k.setError(a).log();a=Ab(a,"task","An unknown task error occurred.");return Promise.reject(a)}.bind(this))};
function xb(a,b,c,d){var e=new ArrayBuffer(0),f=new ArrayBuffer(0),g=function(){return b.read().then(function(a){var b=a.value;a=a.done;if(this.w||a&&0===f.byteLength)return e;if(!a&&!b)return g();b&&(b instanceof Uint8Array&&(b=b.buffer),f=concatArrayBuffer(f,b));return f.byteLength>=d||a?(this.i&&this.i.notifyBytesConsumed(f.byteLength),ob(this,"SegmentFetched",c),e=concatArrayBuffer(e,f),b=f,f=new ArrayBuffer(0),wb(this,b,c).then(g)):g()}.bind(this))}.bind(a);return g()}
function Bb(a){if(a.f){var b=Error("Cannot clear ("+a.g+"): previous operation not complete.");a.o>=a.K?(b.type="stream",a.o=0):(a.o++,b.type="aborted");return Promise.reject(b)}a.f=new jb;kb(a.f,function(){var a;a:if(0==this.a.buffered.length)a=Promise.resolve();else{try{this.a.remove(0,this.A.duration)}catch(b){b=Ab(b,"clear_buffer","An error occured when clearing the buffer.");a=Promise.reject(b);break a}this.b=[];a=this.c=new I}return[a,this.cb.bind(this)]}.bind(a));a.o=0;return zb(a)}
function Cb(a,b){if(a.f){var c=Error("Cannot clearAfter ("+a.g+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.f=new jb;kb(a.f,function(){return[Db(this,b),this.cb.bind(this)]}.bind(a));return zb(a)}function Eb(a,b){a.c=new I;var c=b-5;if(0<c){try{a.a.remove(0,c)}catch(d){return d=Ab(d,"clear_buffer","An error occured when clearing the buffer."),Promise.reject(d)}c=Fb(a,c);0<c&&(a.b=a.b.slice(c,a.b.length))}else a.c.resolve();return a.c}
n.abort=function(){return this.f?this.f.abort():Promise.resolve()};function Gb(a){for(var b=a.currentTime,c=b,d=0;d<a.buffered.length;d++)if(b<=a.buffered.start(d)){c=a.buffered.start(d);break}return c}function Hb(a,b){for(var c=b.currentTime,d=0;d<b.buffered.length;d++)if(c>=b.buffered.start(d)&&c<=b.buffered.end(d)-a.P)return!1;return!0}
function zb(a){a.f.start();return a.f.lb.then(J(a,function(){this.f=null})).catch(J(a,function(a){this.f=null;a=Ab(a,"task","An unknown task error occurred.");return Promise.reject(a)}))}
function wb(a,b,c,d){var e;if(a.l){var f=c?ub(c.url):"init";e=a.l.getOperationLogger("append").setReason(d).setResource(f).setType(vb(a)).setLength(b.byteLength).start();null!==c&&(e=e.setSegmentStartTime(1E3*c.startTime).setSegmentEndTime(1E3*c.endTime));a.j&&(e=e.setParentLogger(a.j))}try{a.a.appendBuffer(b)}catch(g){return a.h.getBool("nuke_source_buffer_on_quota_exceeded_err",!0)&&g instanceof DOMException&&g.code===DOMException.QUOTA_EXCEEDED_ERR&&g.message.match(/^.*SourceBuffer.*full.*free\sspace.*$/)&&
(g.type="sourcebuffer_full"),e&&e.setError(g).log(),Promise.reject(g)}a.c=new I;a.m=c;return a.c.then(function(){e&&e.log()},function(a){e&&e.setError(a).log();return Promise.reject(a)})}n.ad=function(a){a=a.error||Error("Call to appendBuffer failed to append the segment.");a=Ab(a,"stream","Call to appendBuffer failed to append the segment.");this.c&&this.c.reject(a)};
function Db(a,b){if(0==a.a.buffered.length)return Promise.resolve();var c=Fb(a,b);if(-1==c||c==a.b.length-1)return Promise.resolve();try{a.a.remove(a.b[c+1].startTime,a.A.duration)}catch(d){return Promise.reject(d)}a.b=a.b.slice(0,c+1);a.c=new I;return a.c}n.cb=function(){if(this.c){if("open"==this.A.readyState){var a=Error("Previous operation aborted.");a.type="aborted";this.c.reject(a);this.a.abort();this.R&&(this.F=!0);this.c=new I}return this.c}return Promise.resolve()};
n.nd=function(){this.c&&(this.m&&(ob(this,"SegmentAppended",this.m),this.m=null),this.c.resolve(),this.c=null)};n.Dd=function(){return this.i};nb.prototype.getStreamProgressTracker=nb.prototype.Dd;function vb(a){return"v"===a.g.charAt(0)?"video":"a"===a.g.charAt(0)?"audio":null}function Ab(a,b,c){a||(a=Error(c));a.type||(a.type=b);a.message||(a.message=c);return a}
function Fb(a,b){if(a.h.getBool("sbm_use_segment_index_to_find_timestamps",!1)&&a.D){var c=a.D.find(b);if(c)return yb(a.b,c.startTime)}else return yb(a.b,b);return-1};function Ib(a){return String.fromCharCode.apply(null,a)}q("shaka.util.Uint8ArrayUtils.toString",Ib);function Jb(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}q("shaka.util.Uint8ArrayUtils.fromString",Jb);q("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(Ib(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function Kb(a){return Jb(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
q("shaka.util.Uint8ArrayUtils.fromBase64",Kb);q("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function Lb(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}q("shaka.util.Uint8ArrayUtils.toHex",Lb);function Ma(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function Mb(){this.i=this.a="";this.withCredentials=!1;this.o=this.f=null;this.j=this.h=!1;this.m=this.g="";this.c=null;this.b=[]}function Nb(a,b){var c=new Mb;c.a=a.a;c.i=a.i;c.withCredentials=a.withCredentials;c.f=a.f;c.o=a.o;c.h=a.h;c.j=a.j;c.g=a.g;c.m=a.m;c.c=a.c?new Uint8Array(a.c.buffer):null;Ob(c,a.b);Ob(c,b.b);return c}function Ob(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=wa(c)}
function xa(a,b){return a.initDataType==b.initDataType&&Ma(a.initData,b.initData)};function Pb(a,b,c,d){this.withCredentials=c;this.a=[];d&&this.a.push(d)}q("shaka.player.DrmSchemeInfo",Pb);Pb.DistinctiveIdentifier={OPTIONAL:0,REQUIRED:1};Pb.PersistentState={OPTIONAL:0,REQUIRED:1};Pb.createUnencrypted=function(){return new Pb(0,0,!1,null)};function Qb(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new Ba(new DataView(a.buffer));try{for(;Da(a);){var b=a.a,c=v(a),d=v(a);1==c?c=Fa(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)Ha(a,c-(a.a-b));else{var e=Ea(a);if(1<e)Ha(a,c-(a.a-b));else{Ha(a,3);var f=Lb(Ga(a)),g=[];if(0<e)for(var h=v(a),k=0;k<h;++k){var l=Lb(Ga(a));g.push(l)}var m=v(a);Ha(a,m);this.cencKeyIds.push.apply(this.cencKeyIds,g);this.systemIds.push(f);this.a.push({start:b,end:a.a-1});a.a!=b+c&&Ha(a,c-(a.a-b))}}}}catch(p){}}
;var Rb=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function L(a){var b;a instanceof L?(Sb(this,a.za),this.Wa=a.Wa,this.ha=a.ha,Tb(this,a.Za),this.ua=a.ua,Ub(this,a.a.clone()),this.Ma=a.Ma):a&&(b=String(a).match(Rb))?(Sb(this,b[1]||"",!0),this.Wa=Vb(b[2]||""),this.ha=Vb(b[3]||"",!0),Tb(this,b[4]),this.ua=Vb(b[5]||"",!0),Ub(this,b[6]||"",!0),this.Ma=Vb(b[7]||"")):this.a=new Wb(null)}n=L.prototype;n.za="";n.Wa="";n.ha="";n.Za=null;n.ua="";n.Ma="";
n.toString=function(){var a=[],b=this.za;b&&a.push(Xb(b,Yb,!0),":");if(b=this.ha){a.push("//");var c=this.Wa;c&&a.push(Xb(c,Yb,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.Za;null!=b&&a.push(":",String(b))}if(b=this.ua)this.ha&&"/"!=b.charAt(0)&&a.push("/"),a.push(Xb(b,"/"==b.charAt(0)?Zb:$b,!0));(b=this.a.toString())&&a.push("?",b);(b=this.Ma)&&a.push("#",Xb(b,ac));return a.join("")};
n.resolve=function(a){var b=this.clone();"data"===b.za&&(b=new L);var c=!!a.za;c?Sb(b,a.za):c=!!a.Wa;c?b.Wa=a.Wa:c=!!a.ha;c?b.ha=a.ha:c=null!=a.Za;var d=a.ua;if(c)Tb(b,a.Za);else if(c=!!a.ua){if("/"!=d.charAt(0))if(this.ha&&!this.ua)d="/"+d;else{var e=b.ua.lastIndexOf("/");-1!=e&&(d=b.ua.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],g=0;g<d.length;){var h=d[g++];"."==h?e&&g==d.length&&f.push(""):".."==
h?((1<f.length||1==f.length&&""!=f[0])&&f.pop(),e&&g==d.length&&f.push("")):(f.push(h),e=!0)}d=f.join("/")}}c?b.ua=d:c=""!==a.a.toString();c?Ub(b,a.a.clone()):c=!!a.Ma;c&&(b.Ma=a.Ma);return b};n.clone=function(){return new L(this)};function Sb(a,b,c){a.za=c?Vb(b,!0):b;a.za&&(a.za=a.za.replace(/:$/,""))}function Tb(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.Za=b}else a.Za=null}function Ub(a,b,c){b instanceof Wb?a.a=b:(c||(b=Xb(b,bc)),a.a=new Wb(b))}
function Vb(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function Xb(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,cc),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function cc(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Yb=/[#\/\?@]/g,$b=/[\#\?:]/g,Zb=/[\#\?]/g,bc=/[\#\?@]/g,ac=/#/g;function Wb(a){this.b=a||null}Wb.prototype.a=null;Wb.prototype.c=null;
function dc(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null,h=null;0<=f?(g=d[e].substring(0,f),h=d[e].substring(f+1)):g=d[e];g=decodeURIComponent(g.replace(/\+/g," "));h=h||"";dc(a,g,decodeURIComponent(h.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
Wb.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var a=[],b;for(b in this.a)for(var c=encodeURIComponent(b),d=this.a[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.b=a.join("&")};Wb.prototype.clone=function(){var a=new Wb;a.b=this.b;if(this.a){var b={},c;for(c in this.a)b[c]=this.a[c].concat();a.a=b;a.c=this.c}return a};function ec(a,b,c){var d=a.indexOf("<?xml");0<=d&&(a=a.substr(d));a=(new DOMParser).parseFromString(a,"text/xml");if(!a)return null;"string"===typeof b&&(b=[new L(b)]);b=b||[new L("")];c=c||[new L("")];return M({Ac:b,baseUrl:c},a,fc)}q("shaka.dash.mpd.parseMpd",ec);
function fc(){this.id=this.url=null;this.type="static";this.FBIsLiveTemplated=this.FBWasLive=this.manifestIsLiveStreaming=!1;this.FBManifestIdentifier="";this.FBMS=!1;this.u=this.baseUrl=this.Ac=null;this.j=this.i=this.h=0;this.b=null;this.m=5;this.f=this.c=this.g=null;this.o=1;this.lastVideoFrameTs=this.currentServerTimeMs=0;this.a=[]}function gc(){this.f=this.c=this.b=this.baseUrl=this.duration=this.start=this.id=null;this.a=[]}
function hc(){this.c=this.codecs=this.mimeType=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.f=!1;this.i=this.h=this.g=this.baseUrl=null;this.j=[];this.a=[];this.b=null}function ic(){this.value=null}function jc(){this.lang=this.a=null}function kc(){this.contentType=this.lang=this.id=null}function lc(){this.data=null}function mc(){this.data=null}
function nc(){this.a=this.b=this.f=this.i=this.baseUrl=this.j=this.frameRate=this.u=this.o=this.m=this.fbQualityClass=this.fbQualityLabel=this.h=this.g=this.codecs=this.mimeType=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function oc(){this.value=this.a=null}oc.prototype.clone=function(){var a=new oc;a.a=this.a;a.value=this.value;return a};oc.prototype.parse=function(a,b){this.a=N(b,"schemeIdUri",O,this.a);this.value=N(b,"value",O,this.value)};
function pc(){this.b=this.a=this.f=this.c=null}function qc(){this.parsedPssh=this.psshBox=null}function rc(){this.url=null}function sc(){this.url=null}function tc(){this.baseUrl=null;this.s=1;this.c=this.b=this.f=this.a=this.L=null}tc.prototype.clone=function(){var a=new tc;a.baseUrl=uc(this.baseUrl);a.s=this.s;a.L=this.L;a.a=vc(this.a);a.f=vc(this.f);a.b=vc(this.b);a.c=vc(this.c);return a};function wc(){this.a=this.url=null}
wc.prototype.clone=function(){var a=new wc;a.url=uc(this.url);a.a=vc(this.a);return a};function xc(){this.a=this.url=null}xc.prototype.clone=function(){var a=new xc;a.url=uc(this.url);a.a=vc(this.a);return a};function yc(){this.baseUrl=null;this.s=1;this.H=this.L=null;this.c=0;this.b=null;this.a=[];this.C=null}yc.prototype.clone=function(){var a=new yc;a.baseUrl=uc(this.baseUrl);a.s=this.s;a.L=this.L;a.H=this.H;a.c=this.c;a.b=vc(this.b);a.a=uc(this.a)||[];a.C=vc(this.C);return a};
function zc(){this.a=this.b=null}zc.prototype.clone=function(){var a=new zc;a.b=uc(this.b);a.a=vc(this.a);return a};function Ac(){this.s=1;this.H=this.L=null;this.b=0;this.C=this.c=this.a=this.f=null}Ac.prototype.clone=function(){var a=new Ac;a.s=this.s;a.L=this.L;a.H=this.H;a.b=this.b;a.f=this.f;a.a=this.a;a.c=this.c;a.C=vc(this.C);return a};function Bc(){this.b=this.a=null;this.N=[]}Bc.prototype.clone=function(){var a=new Bc;a.a=this.a;a.b=this.b;a.N=uc(this.N)||[];return a};
function Cc(){this.startSegmentIndex=this.repeat=this.duration=this.startTime=null}Cc.prototype.clone=function(){var a=new Cc;a.startTime=this.startTime;a.duration=this.duration;a.repeat=this.repeat;return a};function Dc(a,b){this.qa=a;this.end=b}Dc.prototype.clone=function(){return new Dc(this.qa,this.end)};fc.TAG_NAME="MPD";gc.TAG_NAME="Period";hc.TAG_NAME="AdaptationSet";ic.TAG_NAME="Role";jc.TAG_NAME="Accessibility";kc.TAG_NAME="ContentComponent";nc.TAG_NAME="Representation";pc.TAG_NAME="ContentProtection";
qc.TAG_NAME="cenc:pssh";rc.TAG_NAME="BaseURL";oc.TAG_NAME="AudioChannelConfiguration";sc.TAG_NAME="Location";tc.TAG_NAME="SegmentBase";wc.TAG_NAME="RepresentationIndex";lc.TAG_NAME="FBInitializationBinary";mc.TAG_NAME="FBSegmentIndexBinary";xc.TAG_NAME="Initialization";yc.TAG_NAME="SegmentList";zc.TAG_NAME="SegmentURL";Ac.TAG_NAME="SegmentTemplate";Bc.TAG_NAME="SegmentTimeline";Cc.TAG_NAME="S";
fc.prototype.parse=function(a,b){this.url=a.Ac;this.id=N(b,"id",O);this.type=N(b,"type",O)||"static";this.manifestIsLiveStreaming="dynamic"===this.type;this.FBWasLive=N(b,"FBWasLive",Ec)||!1;this.FBIsLiveTemplated=N(b,"FBIsLiveTemplated",Ec)||!1;this.FBManifestIdentifier=N(b,"FBManifestIdentifier",O)||"";this.FBMS=N(b,"FBMS",Ec)||!1;VideoPlayerShakaGlobalConfig.getBool("override_fb_is_live_templated",!1)&&(this.FBIsLiveTemplated=!1);this.b=N(b,"mediaPresentationDuration",Fc);this.m=N(b,"minBufferTime",
Fc,this.m);this.g=N(b,"minimumUpdatePeriod",Fc,this.g);this.c=N(b,"availabilityStartTime",Gc,this.c);this.f=N(b,"timeShiftBufferDepth",Fc,this.f);this.currentServerTimeMs=N(b,"currentServerTimeMs",P);N(b,"firstAvTimeMs",P);this.lastVideoFrameTs=N(b,"lastVideoFrameTs",P);this.f=null;this.o=N(b,"suggestedPresentationDelay",Fc,this.o);this.h=N(b,"loapStreamType",Hc,this.h);this.i=N(b,"usingASRCaptions",Hc,this.i);this.j=N(b,"isUsingAsrCaptionsEmployeeDogfooding",Hc,this.j);var c=a.baseUrl,d=Ic(this,
b,rc);this.baseUrl=Jc(c,d);if(d=M(this,b,sc))this.u=Kc(c,d.url);this.a=Ic(this,b,gc)};function Lc(a,b,c,d){if(0!==a.a.length){var e=new hc;e.contentType="text";e.lang=c||"en";e.f=!0;c=new nc;c.bandwidth=0;c.mimeType=d||"text/vtt";c.baseUrl=[new L(b)];e.a.push(c);a.a[0].a.push(e);Mc(a.a[0])}}
gc.prototype.parse=function(a,b){this.id=N(b,"id",O);this.start=N(b,"start",Fc);this.duration=N(b,"duration",Fc);var c=Ic(this,b,rc);this.baseUrl=Jc(a.baseUrl,c);this.b=M(this,b,tc);this.c=M(this,b,yc);this.f=M(this,b,Ac);this.a=Ic(this,b,hc);Mc(this)};function Mc(a){for(var b=[],c=0;c<a.a.length;++c){var d=a.a[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.a.length;++c)if(d=a.a[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
hc.prototype.parse=function(a,b){var c=M(this,b,kc)||{},d=M(this,b,ic);this.id=N(b,"id",O);this.group=N(b,"group",P);this.lang=N(b,"lang",O,c.lang);this.contentType=N(b,"contentType",O,c.contentType);this.width=N(b,"width",Q);this.height=N(b,"height",Q);this.mimeType=N(b,"mimeType",O);this.codecs=N(b,"codecs",O);this.c=N(b,"FBProjection",O);this.f=d&&"main"==d.value;this.lang&&(this.lang=Sa(this.lang));c=Ic(this,b,rc);this.baseUrl=Jc(a.baseUrl,c);this.j=Ic(this,b,pc);!this.contentType&&this.mimeType&&
(this.contentType=this.mimeType.split("/")[0]);this.g=a.b?Oc(this,b,a.b):M(this,b,tc);this.h=a.c?Oc(this,b,a.c):M(this,b,yc);this.i=a.f?Oc(this,b,a.f):M(this,b,Ac);this.a=Ic(this,b,nc);this.b=M(this,b,jc);!this.mimeType&&this.a.length&&(this.mimeType=this.a[0].mimeType,!this.contentType&&this.mimeType&&(this.contentType=this.mimeType.split("/")[0]))};ic.prototype.parse=function(a,b){this.value=N(b,"value",O)};jc.prototype.parse=function(a,b){this.a=N(b,"schemeIdUri",O);this.lang=N(b,"lang",O)};
kc.prototype.parse=function(a,b){this.id=N(b,"id",O);this.lang=N(b,"lang",O);this.contentType=N(b,"contentType",O);this.lang&&(this.lang=Sa(this.lang))};
nc.prototype.parse=function(a,b){this.id=N(b,"id",O);this.bandwidth=N(b,"bandwidth",Q);this.width=N(b,"width",Q,a.width);this.height=N(b,"height",Q,a.height);this.mimeType=N(b,"mimeType",O,a.mimeType);this.codecs=N(b,"codecs",O,a.codecs);this.fbQualityLabel=N(b,"FBQualityLabel",O);this.fbQualityClass=N(b,"FBQualityClass",O);this.m=N(b,"FBAbrPolicyTags",O);VideoPlayerShakaGlobalConfig.getBool("mpd_parse_mos_attributes",!1)&&(this.o=N(b,"FBPlaybackResolutionMos",MosUtils.parsePlaybackMos),this.u=N(b,
"FBPlaybackResolutionMosConfidenceLevel",O));VideoPlayerShakaGlobalConfig.getBool("mpd_parse_frame_and_audio_sampling_rate",!1)&&(this.frameRate=N(b,"frameRate",O),this.j=N(b,"audioSamplingRate",Q));this.lang=a.lang;var c=Ic(this,b,rc);this.baseUrl=Jc(a.baseUrl,c);VideoPlayerShakaGlobalConfig.getBool("add_inline_initialization_resources",!1)&&(this.g=M(this,b,lc),this.h=M(this,b,mc));this.c=Ic(this,b,pc);this.i=M(this,b,oc);this.f=a.g?Oc(this,b,a.g):M(this,b,tc);this.b=a.h?Oc(this,b,a.h):M(this,b,
yc);this.a=a.i?Oc(this,b,a.i):M(this,b,Ac);this.c=this.c.concat(a.j)};lc.prototype.parse=mc.prototype.parse=function(a,b){if(b&&b.firstChild){var c=Pc(b);null!=c&&(this.data=Kb(c).buffer)}};pc.prototype.parse=function(a,b){this.c=b;this.f=N(b,"schemeIdUri",O);var c=N(b,"cenc:default_KID",O);c&&(this.b=c.replace(/[-]/g,""));this.a=M(this,b,qc)};
qc.prototype.parse=function(a,b){var c=Pc(b);if(c){this.psshBox=Kb(c);try{this.parsedPssh=new Qb(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};rc.prototype.parse=function(a,b){var c=b.childNodes,d="";if(1==c.length)d=Pc(b);else for(var e=0;e<c.length;e++)c[e].nodeType==Node.TEXT_NODE&&(d+=c[e].nodeValue);this.url=d};sc.prototype.parse=function(a,b){this.url=Pc(b)};
tc.prototype.parse=function(a,b){this.baseUrl=a.baseUrl||this.baseUrl;this.s=N(b,"timescale",Q,this.s);this.L=N(b,"presentationTimeOffset",P,this.L);this.a=N(b,"indexRange",Qc,this.a);this.f=N(b,"FBFirstSegmentRange",Qc,this.f);this.b=M(this,b,wc)||this.b;this.c=M(this,b,xc)||this.c};wc.prototype.parse=function(a,b){var c=N(b,"sourceURL",O);this.url=Kc(a.baseUrl,c);this.a=N(b,"range",Qc,vc(a.a))};
xc.prototype.parse=function(a,b){var c=N(b,"sourceURL",O);this.url=Kc(a.baseUrl,c);this.a=N(b,"range",Qc)};
yc.prototype.parse=function(a,b){this.baseUrl=a.baseUrl||this.baseUrl;this.s=N(b,"timescale",Q,this.s);this.L=N(b,"presentationTimeOffset",P,this.L);this.H=N(b,"duration",Q,this.H);var c=N(b,"startNumber",Q);null!=c&&(this.c=c);this.b=M(this,b,xc)||this.b;this.a=(c=Ic(this,b,zc))&&0<c.length?c:this.a;this.C=M(this,b,Bc)||this.C;VideoPlayerShakaGlobalConfig.getBool("calculate_quick_dash_presentation_time_offset_from_timeline",!1)&&(c=VideoPlayerShakaGlobalConfig.getNumber("calculate_quick_dash_presentation_time_offset_epsilon_ms",
250),this.C&&this.C.N[0]&&(this.L=1E3<this.C.N[0].startTime?this.C.N[0].startTime-c:this.L))};zc.prototype.parse=function(a,b){var c=N(b,"media",O);this.b=Kc(a.baseUrl,c);this.a=N(b,"mediaRange",Qc)};
Ac.prototype.parse=function(a,b){this.s=N(b,"timescale",Q,this.s);this.L=N(b,"presentationTimeOffset",P,this.L);this.H=N(b,"duration",Q,this.H);var c=N(b,"startNumber",P);null!=c&&(this.b=c);this.f=N(b,"media",O,this.f);this.a=N(b,"index",O,this.a);this.c=N(b,"initialization",O,this.c);this.C=M(this,b,Bc)||this.C};Bc.prototype.parse=function(a,b){this.a=N(b,"FBPredictedMedia",O,this.a);this.b=N(b,"FBPredictedMediaEndNumber",Q);this.N=Ic(this,b,Cc)};
Cc.prototype.parse=function(a,b){this.startTime=N(b,"t",P);this.duration=N(b,"d",P);this.repeat=N(b,"r",Hc)};function Jc(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new L(e)):(e=Kc(a.slice(0,1),e),c.push(e[0]))}return c}function Kc(a,b){if(!b)return a;var c=new L(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function Oc(a,b,c){var d=vc(c);(b=Rc(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}
function M(a,b,c){var d=null;if(b=Rc(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}function Rc(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function Ic(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function Pc(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}
function uc(a){return a?a.map(function(a){return a.clone()}):null}function vc(a){return a?a.clone():null}function N(a,b,c,d){a=a.hasAttribute(b)?c(a.getAttribute(b)):null;return null!=a?a:void 0!==d?d:null}function Gc(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function Fc(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return null;a=0;var c=P(b[1]);c&&(a+=31536E3*c);(c=P(b[2]))&&(a+=2592E3*c);(c=P(b[3]))&&(a+=86400*c);(c=P(b[4]))&&(a+=3600*c);(c=P(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Qc(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=P(b[1]);if(null==a)return null;b=P(b[2]);return null==b?null:new Dc(a,b)}function Hc(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function Q(a){a=window.parseInt(a,10);return 0<a?a:null}function P(a){a=window.parseInt(a,10);return 0<=a?a:null}function Ec(a){switch(a.toLowerCase()){case "true":return!0;case "false":return!1;default:return null}}function O(a){return a};function Sc(a,b){this.url=a;this.b=b||new tb;this.j=0;this.g=-1;this.h=this.i=0;this.a=null;this.c=new I;this.f=null;this.o=this.b.i;this.l=this.b.m}q("shaka.util.AjaxRequest",Sc);
function tb(){this.body=null;this.Na=1;this.c=1E3;this.b=0;this.method="GET";this.responseType="arraybuffer";this.Qa={};this.g=this.withCredentials=!1;this.da=this.a=this.u=null;this.j=!1;this.h=this.m=this.i=this.mimeType=null;this.o=!1;this.w=/(.*)\.(xx|fna)\.fbcdn\.net/;this.f=/livestream-lookaside\.(facebook|workplace)\.com$/}var Tc=!0;function Uc(a){Vc(a);Wc(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}
function Wc(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}function Vc(a){-1!==a.g&&(clearTimeout(a.g),a.g=-1)}
Sc.prototype.m=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.responseType&&(b=Jb(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);Uc(this);return b}if(0==this.url.lastIndexOf("idb:",0))return this.u();this.j++;
this.i=performanceNow();this.h||(this.h=this.b.c);this.a=new XMLHttpRequest;var c=this.url,a=new L(c);Tc&&(this.f&&!this.f.supportsCaching()||this.b.g)&&dc(a.a,"_",Date.now());c=this.b.w.test(c);if(null!=this.b.a&&c){var d=this.b.a,e=a.a;null!=d.a&&(d.h=d.a.getSegmentsToPush(),d.f=d.a.getSegmentStartTime(),d.g=d.a.getSegmentOffset(),d.c=d.a.getPushVideoRepresentationID(),d.b=d.a.getPushAudioRepresentationID(),d.j=d.a.getUseLongCacheForManifest());null!=d.h&&dc(e,"_nc_p_n",d.h);null!=d.f?dc(e,"_nc_p_ts",
d.f):null!=d.g&&dc(e,"_nc_p_o",d.g);null!=d.c&&null!=d.b&&(dc(e,"_nc_p_rid",d.c),dc(e,"_nc_p_arid",d.b));d.i&&dc(e,"_nc_p_dbg","1");d.j&&dc(e,"_nc_nc","1")}1==this.b.j&&c&&dc(a.a,"_nc_playing",1);this.b.o&&dc(a.a,"_nc_sc",1);c=a.toString();a=this.b.f.test(a.ha);this.a.open(this.b.method,c,!0);this.a.responseType=this.b.responseType;this.a.timeout=this.b.b;this.a.withCredentials=this.b.withCredentials||a;setEventProperty(this.a,"onload",this.fd.bind(this));setEventProperty(this.a,"onreadystatechange",
this.ld.bind(this));setEventProperty(this.a,"onerror",this.dd.bind(this));setEventProperty(this.a,"ontimeout",this.qd.bind(this));setEventProperty(this.a,"onabort",this.$c.bind(this));for(b in this.b.Qa)this.a.setRequestHeader(b,this.b.Qa[b]);this.a.send(this.b.body);return this.c};Sc.prototype.send=Sc.prototype.m;
function Xc(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;VideoPlayerShakaGlobalConfig.getBool("enable_double_ingest",!1)&&(b.responseHeaders=parseHeaders(a.a.getAllResponseHeaders()));b.method=a.b.method;b.body=a.b.body;return b}n=Sc.prototype;n.abort=function(){Vc(this);if(this.a&&this.a.readyState!=XMLHttpRequest.DONE&&(this.a.abort(),!VideoPlayerShakaGlobalConfig.getBool("fix_shaka_util_ajax_request_abort",!0))){var a=Xc(this,"Request aborted.","aborted");this.c.reject(a);Uc(this)}};
n.$c=function(){if(VideoPlayerShakaGlobalConfig.getBool("fix_shaka_util_ajax_request_abort",!0)){var a=Xc(this,"Request aborted.","aborted");this.c.reject(a);Uc(this)}};
n.fd=function(a){if(this.f){var b=VideoPlayerResourceTimer.getResourceTimingEntry(this.url,this.i,performanceNow());this.f.sample(performanceNow()-this.i,a.loaded||this.a.response&&this.a.response.byteLength||0,this.b.mimeType?"v"===this.b.mimeType.charAt(0):!1,b,this.o,this.l,VideoPlayerShakaGlobalConfig.getBool("evaluate_abr_on_fetch_end",!1))}a=[403];200<=this.a.status&&299>=this.a.status?(VideoPlayerShakaGlobalConfig.getBool("enable_double_ingest",!1)&&null!=parseHeaders(this.a.getAllResponseHeaders())["x-fb-video-replica"]?
(a=Xc(this,"HTTP error.","net"),this.c.reject(a)):this.c.resolve(this.a),Uc(this)):!VideoPlayerShakaGlobalConfig.getBool("remove_ajax_resend_internal",!0)&&this.j<this.b.Na&&-1===a.indexOf(this.a.status)?Yc(this):(a=Xc(this,"HTTP error.","net"),this.c.reject(a),Uc(this))};
n.ld=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED&&(this.a.$a=Date.now()-this.i,this.b.a&&this.b.da&&this.b.da.addPushDataFromXHR(this.a),this.b.h&&this.b.h.handleXHR(this.a),VideoClientEdgeCooperation.updateFromXHR(this.a),this.b.g)){var a=Date.parse(this.a.getResponseHeader("Date"));a&&(za=a-Date.now())}};n.dd=function(){var a=Xc(this,"Network failure.","net");this.c.reject(a);Uc(this)};
n.qd=function(){if(!VideoPlayerShakaGlobalConfig.getBool("remove_ajax_resend_internal",!0)&&this.j<this.b.Na)Yc(this);else{var a=Xc(this,"Request timed out.","net");this.c.reject(a);Uc(this)}};function Yc(a){Wc(a);a.g=setTimeout(function(){this.g=-1;this.m()}.bind(a),a.h*(1+.5*(2*Math.random()-1)));a.h*=2};function K(a,b,c,d,e,f){this.c=b;this.startByte=c||0;this.baseUrl=this.toString();this.endByte=null!=d?d:null;this.isPredictive=e||!1;this.f=null;this.m=0;this.A=!1;this.Nc=this.g=null;this.o=a;this.i=null;this.j=this.u=!1;this.b=this.a=null;this.h=f||null}q("shaka.util.FailoverUri",K);K.prototype.w=function(a){this.A=a};K.prototype.setShouldReadXFbVideoBroadcastEndedHeader=K.prototype.w;K.prototype.D=function(){return this.m};K.prototype.getFbVideoBroadcastEndedResponseHeader=K.prototype.D;
K.prototype.F=function(){return this.startByte};K.prototype.getStartByte=K.prototype.F;K.prototype.B=function(){return this.endByte};K.prototype.getEndByte=K.prototype.B;function Zc(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}n=K.prototype;n.fetch=function(a,b,c,d,e,f,g,h){return this.f?this.f:this.f=$c(this,0,a||new tb,b,c,d,e,f,g,h)};n.stream=function(a,b,c,d,e,f,g,h,k){return ad(this,0,a||new tb,b,c,d,e,f,g,h,k)};
function $c(a,b,c,d,e,f,g,h,k,l){return ad(a,b,c,d,e,f,g,h,k,l).then(function(a){var b,c=function(){return a.read().then(function(a){var d=a.value;if(a.done)return b||new ArrayBuffer(0);d&&("string"===typeof d?b=(b||"")+d:b=concatArrayBuffer(b||new ArrayBuffer(0),d));return c()}.bind(this))}.bind(this);return c()})}
n.Ka=function(){this.g&&(this.a=this.f=null,this.g.abort(),this.i=this.g=null);this.Nc&&VideoPlayerShakaGlobalConfig.getBool("enable_p2p_support",!1)&&(this.G.abort(),this.G=null);this.b&&(this.b.abortRequest(bd(this)),VideoPlayerShakaGlobalConfig.getBool("fixing_scheduler_disable_leaks",!0)&&(this.b=null))};
function ad(a,b,c,d,e,f,g,h,k,l,m){a.b=l||null;var p;e&&(c.a&&(c.a.i=!0),l=0,c.da&&(l=c.da.getPushCountForUrl(a.c[b].toString())),(p=e.getOperationLogger("request"))&&p.setReason(k||null).setPushed(l).setType(h||null).setInitiator("shaka").start(),f&&(p=p.setParentLogger(f)));var t=performanceNow();a.a=null;g&&(c.i=g);e&&(c.m=e);var w=cd(a,a.c[b],c);k=null;a.j=!1;var z=VideoDashPrefetchCache.getCacheValue(w);z&&(k=z,a.j=!0,p&&(p.setConnectionQualityLevel(VideoDashPrefetchCache.getConnectionQualityLevel(w)),
p.setInitiator("prefetch")));if(!z&&m)return m.getStream(bd(a)).then(function(a){return a.getReader()}.bind(a));m=null;if(a.b&&!a.b.isDisabled()&&!k)try{(k=m=a.b.getPromise(bd(a)))?p=null:a.b.disable()}catch(H){e&&e.getEventLogger("request_info_not_found").setResource(w).log()}!k&&a.h&&a.h.createPromise&&(m=new L(w),m=c.f.test(m.ha),k=a.h.createPromise({url:w,responseType:c.responseType,Od:c.c,Kd:2,Na:c.Na,withCredentials:c.withCredentials||m,Qa:c.Qa},function(a){this.Nc=a;var b=performanceNow();
a.onload=function(f){if(d){var h=VideoPlayerResourceTimer.getResourceTimingEntry(w,b,performanceNow());d.sample(performanceNow()-b,f.loaded||a.response&&a.response.byteLength||0,c.mimeType?"v"===c.mimeType.charAt(0):!1,h,g,e,VideoPlayerShakaGlobalConfig.getBool("evaluate_abr_on_fetch_end",!1))}}}));k||(a.g=new Sc(w,c),a.m=0,d&&(a.g.f=d),k=a.g.m());p&&p.setResource(w);f&&f.setResource(w);var da=!1,ea=k.then(J(a,function(a){var c=this.h?this.h.onRequestSend:null;!c||"video"!=h&&"audio"!=h&&"manifest"!=
h||c(!0,h,a.response.byteLength);!this.b||this.b.isDisabled()||this.a?this.a||(this.a=VideoPlayerResourceTimer.getResourceTimingEntry(w,this.j?0:t,performanceNow())):this.a=this.b.getResourceTimingEntry(w);VideoPlayerShakaGlobalConfig.getBool("sample_prefetch_bandwidth",!1)&&z&&this.a&&0<this.a.timeToLastByte&&d&&d.sample(this.a.timeToLastByte,a.response.byteLength,"v"===h.charAt(0),this.a,g,e,!0);if(this.A)try{this.m=parseInt(a.getResponseHeader("x-fb-video-broadcast-ended"),10)}catch(f){}this.b=
this.i=this.g=this.f=null;a.a?(this.i=new L(a.a),this.u=!0):this.i=this.c[b];a.response.$a=a.$a;p&&(p=p.setLength(a.response.byteLength||a.response.length).setWasPrefetchCacheHit(this.j),null!=this.a&&(p=p.setTimeToLastByte(Math.round(this.a.timeToLastByte)).setTimeToFirstByte(Math.round(this.a.timeToFirstByte)).setTimeToRequestStart(Math.round(this.a.timeToRequestStart)),2E3<=this.a.timeToFirstByte&&-1<w.indexOf("akamaihd")&&logLongAkamaiRequest(a.getResponseHeader("Debug-Info")+", TTFB-> "+this.a.timeToFirstByte+
", TTRS-> "+this.a.timeToRequestStart)),p.log());return Promise.resolve({value:a.response,done:!1})})),ea=ea.catch(J(a,function(a){var e=this.h?this.h.onRequestSend:null;e&&e(!1,h,0);if(this.f&&b+1<this.c.length)return this.f=$c(this,b+1,c,d);this.b=this.a=this.f=this.g=null;p&&p.setError(a).log();return Promise.reject(a)}));return Promise.resolve({cancel:function(){},read:function(){return da?Promise.resolve({value:null,done:!0}):ea.then(function(a){da=!0;return a})}.bind(a)})}
function bd(a){return{baseUrl:a.toString(),isPredictive:a.isPredictive,startByte:a.startByte,endByte:a.endByte}}n.clone=function(){return new K(this.o,this.c.map(function(a){return a.clone()}),this.startByte,this.endByte,this.isPredictive,this.h)};n.getResourceTimingEntry=function(){return this.a};
function cd(a,b,c){var d=b.toString();if(a.startByte||a.endByte)b=b.ha,!b.endsWith("fbcdn.net")||b.startsWith("interncache")||b.endsWith("ak.fbcdn.net")?c&&(c.Qa.Range="bytes="+(a.startByte+"-"+(null!=a.endByte?a.endByte:""))):(d+="&bytestart="+a.startByte,d+=null!==a.endByte?"&byteend="+a.endByte:"");a.o&&c&&(d=a.o(d,c.Qa)||d);return d}function ub(a){return cd(a,a.c[0])}n.toString=function(){return this.c[0].toString()};function dd(a,b,c,d){this.a=new tb;b=null!=b?b:ia;this.a.responseType="text";this.a.Na=3;this.a.b=1E3*b;c&&(this.a.a=c);d&&(this.a.da=d);this.a.g=!0;this.a.withCredentials=this.a.f.test(a);this.b=a}
function ed(a,b){var c=a.b,d=VideoPlayerShakaGlobalConfig.getBool("detect_live_stream_ended_from_response_headers",!1);c.w(d);return c.fetch(a.a,null,b,null,null,"manifest").then(function(a){a instanceof ArrayBuffer&&(a=String.fromCharCode.apply(null,new Uint8Array(a)));var f=d&&!!c.m,g;b&&(g=b.getOperationLogger("parse_manifest").start());a=ec(a,c.c,[c.i]);g&&g.log();a&&"dynamic"===a.type&&f&&(a.type="static",b&&BanzaiODS.bumpEntityKey(2966,"videos.www.shaka","changed_manifest_to_dynamic_off_headers"));
if(a)return Promise.resolve(a);f=Error("MPD parse failure.");f.type="dash";return Promise.reject(f)})}function fd(a){this.a=null;this.h=a;this.c=this.g=this.f=null;this.i=!1;this.j=this.b=null};function gd(a,b){this.a=a;this.b=b||null}gd.prototype.destroy=function(){this.a&&(this.a.Ka(),this.a=null);this.b=null};gd.prototype.create=function(a,b){var c=null;b&&(c=new tb,c.da=b);return!this.b&&this.a?this.a.fetch(c,null,a,null,null,"init"):Promise.resolve(this.b)};gd.prototype.c=function(){return this.a};gd.prototype.getFailoverUri=gd.prototype.c;function hd(a,b){this.segmentOriginalEndTime=a;this.gapDistance=b}function id(a,b,c,d,e,f,g){this.startTime=a;this.endTime=b;this.url=c;this.unscaledStartTime=d;this.unscaledDuration=e;this.timescaledGapInfo=f||null;this.isPredictive=g||!1;this.debugInfo=this.timescaledGapInfo?{endTime:this.timescaledGapInfo.segmentOriginalEndTime,delta:this.timescaledGapInfo.gapDistance}:null}function jd(a,b,c){return new id(b,c,a.url,a.unscaledStartTime,a.unscaledDuration,a.timescaledGapInfo,a.isPredictive)}
function yb(a,b){if(VideoPlayerShakaGlobalConfig.getBool("use_binary_search_when_finding_segment_references",!1))return BinarySearch.findIndexInArray(a,b,function(a,b){return b>=a.startTime&&(null==a.endTime||b<a.endTime)?0:a.startTime-b});for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.startTime&&(null==d.endTime||b<d.endTime))return c}return-1}function kd(a,b){return a.map(function(a){return jd(a,a.startTime+b,null!=a.endTime?a.endTime+b:null)})};function ld(a,b,c,d){for(var e=b.a,f=[],g=0;g<d;++g){var h=g+c,k=(h-1)*e.H,l=k/e.s,m=(k+e.H)/e.s,h=md(a,b,e.b+h-1,k);if(!h)return null;f.push(new id(l,m,h,k,e.H||0))}return f}function md(a,b,c,d,e,f){if(!b.a)return null;e=e||!1;var g=b.a.f,h=b.a.C.a;if(!g)return b.baseUrl?new K(a,b.baseUrl,0,null,void 0,f):null;c=nd(e&&h?h:g,b.id,c,b.bandwidth,d);if(!c)return null;b=Zc(b.baseUrl,c);return new K(a,b,0,null,e,f)}
function nd(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};a=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(a,b,c){if("$$"==a)return"$";var d=f[b];if(null==d)return a;"RepresentationID"==b&&c&&(c=void 0);a=d.toString();c=window.parseInt(c,10)||1;c=Math.max(0,c-a.length);return Array(c+1).join("0")+a});try{return new L(a)}catch(g){if(g instanceof URIError)return null;throw g;}}
function od(a,b,c,d,e,f){var g=0,h=c*b;c=a.N;var k=d||0;d=[];var l=VideoPlayerShakaGlobalConfig.getNumber("live_rewind_templated_last_x_segments_only",0),m=VideoPlayerShakaGlobalConfig.getBool("templated_last_x_timeline",!1)&&e&&null!=f,p=e&&m?VideoPlayerShakaGlobalConfig.getNumber("templated_ingest_throttle",0):0;if(l||m){for(e=0;e<c.length;++e){if(!c[e].duration)return d;var t=c[e].startTime,t=null!=t?t:g,w=c[e].repeat||0;if(0>w)if(w=c[e].duration,e+1===c.length)var z=c[0].startTime+h-t,w=Math.ceil(z/
w)-1;else z=c[e+1].startTime,w=Math.ceil((z-t)/w)-1;c[e].startTime=t;c[e].repeat=w;g=c[e].startTime+c[e].duration*(c[e].repeat+1)}for(e=c.length-1;-1<e;--e)for(var H=0;H<=c[e].repeat;++H)if(t=c[e].startTime+c[e].duration*(c[e].repeat-H),g=t+c[e].duration,a=null,d.length&&g!=d[d.length-1].start&&(z=d[d.length-1].start-g,a=new hd(g/b,z/b),g=d[d.length-1].start),d.push({start:t,end:g}),a&&(d[d.length-1].timescaledGapInfo=a),l){if(d.length===l)return d=d.reverse()}else if(m&&d[d.length-1].start<=f)return d.pop(),
d=d.reverse(),0<p&&(d=d.slice(0,p)),d;return d.reverse()}for(e=0;e<c.length;++e){if(!c[e].duration)return d;t=c[e].startTime;t=null!=t?t:g;w=c[e].repeat||0;0>w&&(w=c[e].duration,e+1===c.length?(z=c[0].startTime+h-t,w=Math.ceil(z/w)-1):(z=c[e+1].startTime,w=Math.ceil((z-t)/w)-1));0<d.length&&t!=g&&(z=t-g,f=d[d.length-1],f.timescaledGapInfo=new hd(g/b,z/b),f.end=t);for(H=0;H<=w;++H)g=t+c[e].duration,d.push({start:t,end:g}),t=g}if(a.a&&0<c.length)for(b=c[0].duration,f=0;f<k;f++)d.push({start:t+f*b,end:t+
(f+1)*b,ud:a.b+f});return d};function pd(a,b,c,d,e){this.w=a;this.m=b;this.c=c;this.W=0;this.B=!0;this.s=c.s||0;this.A=!1;this.g=null;this.u=d;this.j=c.L||0;this.b=0;this.i=this.h=null;a:{b=c.C;var f=0;a=(a.duration||0)*this.s;c=b.N;for(d=0;d<c.length;++d){if(!c[d].duration){b.N=c.slice(0,d);break a}var g=c[d].startTime,f=null!=g?g:f,g=c[d].repeat||0;0>g&&(g=c[d].duration,g=d+1===c.length?Math.ceil((c[0].startTime+a-f)/g)-1:Math.ceil((c[d+1].startTime-f)/g)-1);c[d].startTime=f;c[d].repeat=g;f=c[d].startTime+c[d].duration*(c[d].repeat+
1)}}this.f=[];this.o=VideoPlayerShakaGlobalConfig.getNumber("timeline_segment_index_max_index_cache_length",0);this.b=ShakaTimelineSegmentIndexUtils.length(this.c.C.N);this.D=e||null}pd.prototype.destroy=function(){this.b=this.c=this.m=this.w=null;this.g=function(){};this.f=this.u=null};pd.prototype.length=function(){return this.b};function qd(a,b){for(var c=a.f.length-1;-1<c;c--)if(a.f[c].index===b){var d=a.f[c];a.f.splice(c,1);a.f.push(d);return d.xd}return null}
function rd(a,b,c){var d=[];if(a.o&&1===c-b){var e=qd(a,b);if(e)return[e]}var f=-a.j/a.s+a.W;ShakaTimelineSegmentIndexUtils.getSegments(b,c,a.c.C.N,function(a,e,k,l,m){if(l){var p=d[d.length-1];p&&(p.timescaledGapInfo=new hd(m/this.s,l/this.s),p.debugInfo={endTime:p.timescaledGapInfo.segmentOriginalEndTime,delta:p.timescaledGapInfo.gapDistance},d[d.length-1]=jd(p,p.startTime,a/this.s+f))}k=md(this.u,this.m,k+this.c.b,a,void 0,this.D);if(!k)throw a=Error("Failed to generate media URL."),a.type="dash",
a;a=new id(a/this.s+f,e/this.s+f,k,a,e-a,null);e=b+d.length;d.push(a);!this.o||0!==e&&e!==this.b-1&&1!==c-b||qd(this,e)||(this.f.length+1>this.o&&this.f.shift(),this.f.push({index:e,xd:a}))}.bind(a));return d}
function sd(a,b){var c=b.unscaledStartTime,d=b.unscaledEndTime,e=b.delta,f=b.previousEndTime;if(e)var g=new hd(f/a.s,e/a.s);e=md(a.u,a.m,b.segmentReplacement+a.c.b,c,void 0,a.D);if(!e)throw c=Error("Failed to generate media URL."),c.type="dash",c;f=-a.j/a.s+a.W;return new id(c/a.s+f,d/a.s+f,e,c,d-c,g||null)}pd.prototype.getSegments=function(){return rd(this,0,this.b)||[]};
pd.prototype.first=function(){if(!this.b)throw new RangeError("Index out of range.");if(VideoPlayerShakaGlobalConfig.getBool("optimize_common_segment_generations",!1)){if(this.h)return this.h;var a=ShakaTimelineSegmentIndexUtils.first(this.c.C.N,this.b);return this.h=sd(this,a)}return rd(this,0,1)[0]};
pd.prototype.last=function(){if(!this.b)throw new RangeError("Index out of range.");if(VideoPlayerShakaGlobalConfig.getBool("optimize_common_segment_generations",!1)){if(this.i)return this.i;var a=ShakaTimelineSegmentIndexUtils.last(this.c.C.N,this.b);return this.i=sd(this,a)}return rd(this,this.b-1,this.b)[0]};
pd.prototype.get=function(a){if(!this.b||0>a||a>=this.b)throw new RangeError("Index out of range.");return VideoPlayerShakaGlobalConfig.getBool("optimize_common_segment_generations",!1)?(a=ShakaTimelineSegmentIndexUtils.get(this.c.C.N,a,this.b),sd(this,a)):rd(this,a,a+1)[0]};
pd.prototype.find=function(a){if(VideoPlayerShakaGlobalConfig.getBool("fix_composited_time_index_calls",!1))return(a=ShakaTimelineSegmentIndexUtils.find(a,this.c.C.N,this.s,-this.j/this.s+this.W))?sd(this,a):null;a=this.findIndex(a);return VideoPlayerShakaGlobalConfig.getBool("optimize_common_segment_generations",!1)?0<=a?this.get(a):null:0<=a?rd(this,a,a+1)[0]:null};pd.prototype.findIndex=function(a){return ShakaTimelineSegmentIndexUtils.findIndex(a,this.c.C.N,this.s,-this.j/this.s+this.W)};n=pd.prototype;
n.Ta=function(a){var b=a.length(),c=b-this.b;if(0!==b&&(b!==this.b||0!==this.b&&a.last().endTime!==this.last().endTime)&&!(VideoPlayerShakaGlobalConfig.getBool("fix_integration_on_earlier_endtime",!1)&&a.last().endTime<=this.last().endTime))if(this.A=!1,b=a.last(),null!=b.endTime&&b.endTime<this.last().endTime&&b.endTime<this.first().startTime&&(this.A=!0),VideoPlayerShakaGlobalConfig.getBool("integrate_segment_timeline_time_points",!1)?this.c.C.N=ShakaTimelineSegmentIndexUtils.integrateTimePoints(this.c.C.N,
a.c.C.N):(this.w=a.w,this.m=a.m,this.c=a.c,this.j=this.c.L||0,this.s=this.c.s||0),this.f=[],this.i=this.h=null,this.b=ShakaTimelineSegmentIndexUtils.length(this.c.C.N),this.first(),this.last(),VideoPlayerShakaGlobalConfig.getBool("templated_call_on_segments_updated_with_delta_segments",!1)){var d=[],c=this.b-c;for(VideoPlayerShakaGlobalConfig.getBool("templated_dynamic_include_previous_last_segment_in_updates",!1)&&0<c&&c--;c<this.b;++c)d.push(this.get(c));this.g&&this.g(d)}else c=!VideoPlayerShakaGlobalConfig.getBool("no_provide_segments_to_on_segments_updated_listeners",
!1),this.g&&(c&&(d=this.getSegments()),this.g(d))};n.hb=function(a){var b=a-this.W;if(0==b)return 0;this.W=a;this.i=this.h=null;this.f=[];return b};n.ib=function(){return this.b?{start:this.first().startTime,end:this.last().endTime}:{start:0,end:0}};n.getSeekRangeGaps=function(){return ShakaTimelineSegmentIndexUtils.getSeekRangeGaps(this.c.C.N,this.s,-this.j/this.s+this.W)};n.rb=function(){return this.A};n.Gc=function(a){this.g=a};n.Fc=function(){this.g=null};n.Ia=function(){};function td(){}
td.prototype.parse=function(a,b,c,d,e){var f=null;try{a:{var g=[],h=new Ba(a),k=v(h);if(1936286840!=v(h))f=null;else{1==k&&(k=Fa(h));var l=Ea(h);Ha(h,3);Ha(h,4);var m=v(h);if(0==m)f=null;else{var p,t;0==l?(p=v(h),t=v(h)):(p=Fa(h),t=Fa(h));Ha(h,2);var w=h.b.getUint16(h.a,h.c);h.a+=2;a=p;b=b+k+t;for(t=k=0;t<w;t++){var z=v(h);p=(z&2147483648)>>>31;var l=z&2147483647,H=v(h);v(h);if(1==p){f=null;break a}var da;da=0==t&&e?e:new K(d,c,b,b+l-1);p=a/m;var ea=(a+H)/m;0===t&&(k=p);g.push(new id(p-k,ea-k,da,
a,H));a+=H;b+=l}g.s=m;f=g}}}}catch(Aa){if(!(Aa instanceof RangeError))throw Aa;}return f};function R(a){this.a=a;this.s=this.a.s;this.K=this.a.B;this.g=[]}R.prototype.J=function(){return!!this.g[this.g.length-1]};R.prototype.lastPollHadChanges=R.prototype.J;R.prototype.I=function(){var a=this.g,b=a.lastIndexOf(!0);if(1>b)return 0;a=a.lastIndexOf(!0,b-1);return 0>a?0:b-a-1};R.prototype.getFetchesBetweenRecentChanges=R.prototype.I;R.prototype.u=function(){return Math.floor((this.g.length-1-this.g.lastIndexOf(!0))/2)};R.prototype.getConsecutiveUpdatesWithoutChanges=R.prototype.u;
R.prototype.G=function(){return this.g.length-1-this.g.lastIndexOf(!1)};R.prototype.getConsecutiveUpdatesWithChanges=R.prototype.G;R.prototype.destroy=function(){this.a.destroy();this.a=null};R.prototype.length=function(){return this.a.length()};R.prototype.getSegments=function(){return this.a.getSegments()};R.prototype.getSegments=R.prototype.getSegments;R.prototype.first=function(){return this.a.first()};R.prototype.last=function(){return this.a.last()};R.prototype.last=R.prototype.last;
R.prototype.get=function(a){return this.a.get(a)};R.prototype.find=function(a){return this.a.find(a)};R.prototype.findIndex=function(a){return this.a.findIndex(a)};R.prototype.B=function(a){this.a.Ta(a.a);return!0};R.prototype.Ua=function(a){return this.a.hb(a)};R.prototype.A=function(){return this.a.ib()};R.prototype.getSeekRangeGaps=function(){return this.a.getSeekRangeGaps()};R.prototype.getSeekRangeGaps=R.prototype.getSeekRangeGaps;R.prototype.rb=function(){return this.a.rb()};
function ud(a,b){a.a.Gc(b)};function S(a,b,c,d){R.call(this,a);this.i=b;this.F=c;this.h=d;this.duration=this.i.b||this.i.a.reduce(function(a,b){return null==b.duration?NaN:a+b.duration},0)||0;this.b=this.o=this.f=null;yd(this)}r(S,R);S.prototype.destroy=function(){this.F=this.i=null;R.prototype.destroy.call(this)};S.prototype.find=function(a){zd(this,ya()/1E3);return R.prototype.find.call(this,a)};
S.prototype.B=function(a){if(!(a instanceof S))return!1;this.a.Ta(a.a);this.duration=Math.max(this.duration,a.duration);null==this.f?(this.h=a.h,yd(this)):Ad(this);return!0};function yd(a){Ad(a);if(0!=a.length()){a.length();var b=null!=a.last().endTime?a.last().endTime:a.last().startTime;if(a.i.c>a.h)a.f=b;else{var c=a.h-(a.i.c+a.F.start);0>c?a.f=b:c<Math.max(a.last().startTime,a.last().endTime||0)?(a.last(),a.f=b):a.f=c}a.o=a.last().startTime;a.b=a.first().startTime}}
S.prototype.Ua=function(a){a=R.prototype.Ua.call(this,a);VideoPlayerShakaGlobalConfig.getBool("no_correct_delta_warning",!1)||Math.min.apply(null,this.getSegments().filter(function(a){return null!=a.endTime}).map(function(a){return a.endTime-a.startTime}));null!=this.f&&(this.o+=a,this.b+=a,this.f+=a);return a};S.prototype.A=function(){return Bd(this,ya()/1E3)};
function Bd(a,b){zd(a,b);if(null==a.f||null==a.o||null==a.b)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.duration&&(c=a.duration);var d=b-a.h,e=a.f+d;null!=a.i.f&&(e=e-a.b-a.i.f,0<e&&(a.b+=e));a.b=Math.min(a.b,c);d=a.o+d;if(d<a.b)return{start:a.b,end:a.b};d=0<a.length()?null!=a.last().endTime?Math.min(d,a.last().endTime):d:a.b;d=Math.max(d,a.b);d=Math.min(d,c);return{start:a.b,end:d}}
function zd(a,b){if(a.a.a&&(Ad(a),null!=a.i.f))if(null==a.f)a.length();else{for(var c=a.f+(b-a.h),d=0,e=0;e<a.a.a.length;++e){var f=null;e<a.a.a.length-1?f=a.a.a[e+1].endTime:(f=a.a.a[e],f=null!=f.endTime?f.endTime+(f.endTime-f.startTime):null);if(null!=f&&f<c-a.i.f)++d;else break}0<d&&a.a.a.splice(0,d)}}function Ad(a){if(a.duration&&a.a.a){for(var b=0,c=a.a.a.length-1;0<=c;--c)if(a.a.a[c].startTime>a.duration)++b;else break;0<b&&a.a.a.splice(-b)}};function T(a,b,c){var d=VideoPlayerShakaGlobalConfig.getNumber("templated_quarantine_idle_references_threshold",0);this.i=[];if(0<d){var e=a;a=e.splice(-d);this.i=e}this.a=a;this.W=0;this.s=b;this.f=!1;this.h=function(){};this.B=c||!1}T.prototype.destroy=function(){this.a=null};T.prototype.length=function(){return this.a.length};T.prototype.getSegments=function(){return(this.a||[]).slice()};T.prototype.getSegments=T.prototype.getSegments;
T.prototype.first=function(){if(0==this.a.length)throw new RangeError("SegmentIndexBase: There is no first SegmentReference.");return this.a[0]};T.prototype.last=function(){if(0==this.a.length)throw new RangeError("SegmentIndexBase: There is no last SegmentReference.");return this.a[this.a.length-1]};T.prototype.last=T.prototype.last;T.prototype.get=function(a){if(0>a||a>=this.a.length)throw new RangeError("SegmentIndexBase: The specified index is out of range.");return this.a[a]};
T.prototype.find=function(a){a=this.findIndex(a);return 0<=a?this.a[a]:null};T.prototype.findIndex=function(a){return yb(this.a,a)};
T.prototype.Ta=function(a){this.W!=a.W&&(a=new T(kd(a.a,this.W-a.W),a.s));if(0==this.length())this.a=a.a.slice(0),this.Ia();else if(0!=a.length()&&null!=this.last().endTime)if(null!=a.last().endTime&&a.last().endTime<this.last().endTime)VideoPlayerShakaGlobalConfig.getBool("fix_manifest_wrapped",!0)?a.last().endTime<this.first().startTime&&(this.f=!0):this.f=!0;else{this.f=!1;if(this.last().endTime<=a.first().startTime){var b=jd(this.last(),this.last().startTime,a.first().startTime),c=this.last().unscaledStartTime+
this.last().unscaledDuration;VideoPlayerShakaGlobalConfig.getBool("calculate_missed_segment_gap_info_on_merge",!1)&&c<a.first().unscaledStartTime&&null===this.last().timescaledGapInfo&&(b.timescaledGapInfo=new hd(c/this.s,(a.first().unscaledStartTime-c)/this.s));if(VideoPlayerShakaGlobalConfig.getBool("templated_optimize_merge_target_algos",!1))for(this.a.pop(),this.a.push(b),c=0;c<a.a.length;++c)this.a.push(a.a[c]);else b=this.a.slice(0,-1).concat([b]),this.a=b.concat(a.a)}else{for(c=0;c<this.a.length&&
!(this.a[c].endTime>=a.first().startTime);++c);this.a[c].startTime<a.first().startTime?(b=jd(this.a[c],this.a[c].startTime,a.first().startTime),b=this.a.slice(0,c).concat([b])):(this.first().startTime>a.first().startTime||a.first(),b=this.a.slice(0,c));this.a=b.concat(a.a)}this.h(a.a);this.Ia()}};T.prototype.hb=function(a){var b=a-this.W;if(0==b)return 0;this.a=kd(this.a,b);this.Ia();this.W=a;return b};
T.prototype.ib=function(){return 0<this.length()?{start:this.first().startTime,end:this.last().endTime}:{start:0,end:0}};T.prototype.getSeekRangeGaps=function(){return getSeekRangeGapsFromShakaReferences(this.a,this.s)};T.prototype.getSeekRangeGaps=T.prototype.getSeekRangeGaps;T.prototype.rb=function(){return this.f};T.prototype.Gc=function(a){this.h=a};T.prototype.Fc=function(){this.h=function(){}};T.prototype.Ia=function(){};T.prototype.getIdleReferences=function(){return this.i};function Cd(a,b,c,d,e){var f=1,g=0,h;if(a.c>d)h=null;else{var k=a.o||0,l=a.f||0;h=c.a;h=h.H/h.s;var m=d-(a.c+b.start);0>m?h=null:(l=m-2*h-l,0>l&&(l=0),l=Math.ceil(l/h)*h,m-=h,0>m?h=null:(k=Math.floor(m/h)*h-k,0>k&&(k=0),k=Math.floor(k/h)*h,h={tc:l/h+1,current:(k>=l?k:l)/h+1}))}h&&(f=h.tc,g=h.current-h.tc+1);f=ld(e,c,f,g);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;f=new T(f,c.a.s||1);S.call(this,f,a,b,d);this.w=c;this.m=this.c=0<this.length()?a.c+b.start+this.last().endTime:
null;this.j=h?h.current+1:null;this.D=e}r(Cd,S);Cd.prototype.destroy=function(){this.D=this.w=null;S.prototype.destroy.call(this)};Cd.prototype.find=function(a){var b=ya()/1E3;Dd(this,b);zd(this,b);return R.prototype.find.call(this,a)};Cd.prototype.B=function(a){if(null!=this.c||!(a instanceof Cd)||null==a.c)return!1;this.c=a.c;this.m=a.m;this.j=a.j;this.h=a.h;this.duration=a.duration;this.a.Ta(a.a);Dd(this,ya()/1E3);yd(this);return!0};
Cd.prototype.Ua=function(a){a=S.prototype.Ua.call(this,a);null!=this.c&&(this.c+=a,this.m+=a);return a};Cd.prototype.A=function(){var a=ya()/1E3;Dd(this,a);return Bd(this,a)};function Dd(a,b){if(null!=a.c&&null!=a.m&&null!=a.j){var c=a.w.a,c=c.H/c.s,d=Math.floor((a.m+(b-a.h)-a.c)/c);if(0!=d){var e=ld(a.D,a.w,a.j,d);Array.prototype.push.apply(a.a.a,kd(e,a.a.W));a.a.Ia();a.c+=d*c;a.j+=d}}};function Ed(a,b,c,d,e){this.g=a;this.f=b;this.b=c;this.i=d;this.a=null;this.h=e}Ed.prototype.destroy=function(){this.h=this.b=this.f=this.g=null;this.a&&(this.a.destroy(),this.a=null)};
Ed.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.g.type)try{this.a=new Cd(this.g,this.f,this.b,this.i,this.h)}catch(a){return Promise.reject(a)}else{var b;b=this.b.a;if(b=ld(this.h,this.b,1,Math.ceil(this.f.duration/(b.H/b.s)))){if(0<b.length){var c=b[b.length-1];b[b.length-1]=jd(c,c.startTime,this.f.duration)}b=new T(b,this.b.a.s||1);b=new R(b)}else b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};
Ed.prototype.c=function(){return this.a};function Fd(a,b,c,d,e,f){this.f=a;this.b=b;this.h=c;this.a=null;this.i=d;this.g=e;this.j=f||null}Fd.prototype.destroy=function(){this.g=this.h=this.b=this.f=null;this.a&&(this.a.destroy(),this.a=null)};
Fd.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.h.b,b=[];a.C&&(b=od(a.C,a.s||1,this.b.duration||0));var c=0;a.H&&a.c?c=(a.c-1)*a.H:0<b.length&&(c=b[0].start-(a.L||0));var d=c,e=a.a.length;0<b.length&&b.length!=a.a.length&&(e=Math.min(b.length,a.a.length));for(var f=[],g=0;g<e;++g){var h=a.a[g],k=c,l=k/a.s,m=c=null,p;a.H?(c=k+a.H,m=c/a.s):0<b.length?(p=b[g].timescaledGapInfo,c=b[g].end-(a.L||0),m=c/a.s):(m=l+this.b.duration,c=m*a.s);var t=0,w=null;h.a&&(t=h.a.qa,
w=h.a.end);m=Math.min(this.b.duration+d/a.s,m);f.push(new id(l,m,new K(this.g,h.b,t,w,void 0,this.j),k,p||null))}a=new T(f,a.s||1);"dynamic"==this.f.type?this.a=new S(a,this.f,this.b,this.i):this.a=new R(a);return Promise.resolve(this.a)};Fd.prototype.c=function(){return this.a};function Gd(a,b,c){T.call(this,a,c);this.g=b;this.b=!1;this.j=VideoPlayerShakaGlobalConfig.getString("templated_perf_test_methods_under_test_csv_string","all").split(",")}r(Gd,T);function Hd(a,b){if(!(-1<a.j.indexOf("all")||-1<a.j.indexOf(b))||a.b)return null;var c=a.a;a.a=a.g;a.b=!0;return c}function Id(a,b){a.b&&(a.g=a.a,a.a=b)}Gd.prototype.destroy=function(){T.prototype.destroy.call(this);this.g=null};
Gd.prototype.length=function(){var a=Hd(this,"length"),b=T.prototype.length.call(this);a&&(Id(this,a),b=T.prototype.length.call(this),this.b=!1);return b};Gd.prototype.getSegments=function(){var a=Hd(this,"getSegments"),b=T.prototype.getSegments.call(this);a&&(Id(this,a),b=T.prototype.getSegments.call(this),this.b=!1);return b};Gd.prototype.first=function(){var a=Hd(this,"first"),b=T.prototype.first.call(this);a&&(Id(this,a),b=T.prototype.first.call(this),this.b=!1);return b};
Gd.prototype.last=function(){var a=Hd(this,"last"),b=T.prototype.last.call(this);a&&(Id(this,a),b=T.prototype.last.call(this),this.b=!1);return b};Gd.prototype.get=function(a){var b=Hd(this,"get"),c;c=b?T.prototype.get.call(this,a+(this.a.length-b.length)):T.prototype.get.call(this,a);b&&(Id(this,b),c=T.prototype.get.call(this,a),this.b=!1);return c};Gd.prototype.find=function(a){var b=Hd(this,"find"),c=T.prototype.find.call(this,a);b&&(Id(this,b),c=T.prototype.find.call(this,a),this.b=!1);return c};
Gd.prototype.findIndex=function(a){var b=Hd(this,"findIndex"),c=T.prototype.findIndex.call(this,a);b&&(Id(this,b),c=T.prototype.findIndex.call(this,a),this.b=!1);return c};n=Gd.prototype;n.Ta=function(a){var b=Hd(this,"merge"),c=T.prototype.Ta.call(this,a);b&&(Id(this,b),c=T.prototype.Ta.call(this,a),this.b=!1);return c};n.hb=function(a){var b=Hd(this,"correct"),c=T.prototype.hb.call(this,a);b&&(Id(this,b),c=T.prototype.hb.call(this,a),this.b=!1);return c};
n.ib=function(){var a=Hd(this,"getSeekRange"),b=T.prototype.ib.call(this);a&&(Id(this,a),b=T.prototype.ib.call(this),this.b=!1);return b};n.getSeekRangeGaps=function(){var a=Hd(this,"getSeekRangeGaps"),b=T.prototype.getSeekRangeGaps.call(this);a&&(Id(this,a),b=T.prototype.getSeekRangeGaps.call(this),this.b=!1);return b};n.Ia=function(){var a=Hd(this,"assertCorrectReferences");T.prototype.Ia.call(this);a&&(Id(this,a),T.prototype.Ia.call(this),this.b=!1)};function Jd(a,b,c,d,e,f,g,h){this.m=a;this.a=b;this.g=c;this.f=d;this.o=e;this.b=null;this.i=f;this.h=null;this.j=h||null}Jd.prototype.destroy=function(){this.i=this.f=this.g=this.a=null;this.b&&(this.b.destroy(),this.b=null)};
Jd.prototype.create=function(){if(this.b)return Promise.resolve(this.b);var a=VideoPlayerShakaGlobalConfig.getBool("fbls_use_timeline_segment_index",!1);if(VideoPlayerShakaGlobalConfig.getBool("use_timeline_segment_index",!1)&&(this.a.FBIsLiveTemplated||this.a.FBWasLive||a))a=new pd(this.g,this.f,this.f.a,this.i,this.j);else{for(var a=this.f.a,b=od(a.C,a.s||1,this.g.duration||0,this.m.getNumber("num_predictive_segments",0),this.a.FBIsLiveTemplated||this.a.FBWasLive,this.h),c=[],d=0;d<b.length;++d){var e=
b[d].start,f=b[d].end,g=b[d].ud||0,h=b[d].timescaledGapInfo,k=e/a.s,l=f/a.s,m=d+a.b,p=e,m=md(this.i,this.f,0<g?g:m,p,0<g?!0:!1,this.j);if(!m)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);var t=(a.L||0)/a.s;c.push(new id(k-t,l-t,m,p,f-e,h||null,0<g))}b=this.a.FBIsLiveTemplated||this.a.FBWasLive;VideoPlayerShakaGlobalConfig.getNumber("templated_use_perf_test_segment_index_base_int",0)&&null==this.h&&this.a.FBIsLiveTemplated?(b=c,c=b.slice(-VideoPlayerShakaGlobalConfig.getNumber("templated_use_perf_test_segment_index_base_int",
0)),a=new Gd(c,b,a.s||1)):a=new T(c,a.s||1,b)}this.a.manifestIsLiveStreaming?this.b=new S(a,this.a,this.g,this.o):this.b=new R(a);return Promise.resolve(this.b)};Jd.prototype.c=function(){return this.b};Jd.prototype.Ec=function(a){this.h=a};function Kd(){this.X=Ld++;this.id=this.aa=this.M=null;this.a=0;this.height=this.width=this.bandwidth=null;this.codecs=this.mimeType="";this.f=this.fbQualityClass=this.fbQualityLabel=null;this.frameRate="";this.switchReason=this.h=this.g=this.c=null;this.b=[];this.oa=!1;this.fa=!0}var Ld=0;Kd.prototype.destroy=function(){this.M&&(this.M.destroy(),this.M=null);this.aa&&(this.aa.destroy(),this.aa=null)};function Md(a){return a.mimeType.split("/")[0]}
function Nd(a){var b=a.mimeType||"";a.codecs&&(b+='; codecs="'+a.codecs+'"');return b}function Od(){this.X=Pd++;this.id=null;this.contentType=this.lang="";this.f=this.b=!1;this.c=null;this.v=[];this.a=[]}var Pd=0;Od.prototype.destroy=function(){for(var a=0;a<this.v.length;++a)this.v[a].destroy();this.a=this.v=null};function Qd(a){for(var b=[],c=0;c<a.a.length;++c){var d=new Rd;d.id=a.X;d.a=a.a[c];d.contentType=a.contentType;d.b=a.v.length?Nd(a.v[0]):"";b.push(d)}return b}
function Sd(){this.id=null;this.start=0;this.duration=null;this.a=[]}Sd.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Td(){this.A=this.f=this.b=!1;this.o=this.m=this.B=0;this.j=this.i=this.c=null;this.g=0;this.a=[];this.h=!1;this.w="none";this.u=null}Td.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Rd(){this.id=0;this.a=null;this.b=this.contentType=""};function U(a,b,c,d,e,f,g,h,k,l,m,p,t,w){F.call(this,a);this.b=b;this.a=c;this.c=new nb(c,d,e,f,this,h,w);this.Pa=h;this.o={};this.ra=f;this.ya=0;this.ma=this.f=this.g=null;this.ta=!1;this.w=this.ca=null;this.S=!1;this.ja=0;this.ka=!1;this.D=null;this.Z=this.ea=this.h=!1;this.O=new I;this.G=this.T=this.B=!1;this.R=0;this.ga=15;this.Ga=this.va=this.U=!1;this.na=1;this.$=g;this.xa=!1;this.l=null;this.Ha=!1;this.I=this.J=this.K=null;this.V=!1;this.u=m||null;this.F=p||null;this.j=t||null;this.Y=null;this.ba=
!1;this.Da={};this.Fa=k;this.i=null;this.ia=!1;this.Ea=0;this.Ca=e?e.split(";")[0]:"";this.P=!1;this.wa=0;this.sa=l;this.A=this.m=null}r(U,F);U.prototype.Ba=function(){return{SourceBufferManager:this.c}};U.prototype.getDebug=U.prototype.Ba;function Ud(a,b){return new VideoPlayerBitrateEstimator(new x(a.a.getNumber("live_bitrate_estimates_half_life",2)),b,a.a.getNumber("live_bitrate_estimates_minimum_sample_count",1),a.a.getNumber("live_bitrate_estimates_large_sample_weight_factor",10))}
U.prototype.pa=function(a){null!=a.initialStreamBufferSize&&(this.R=Number(a.initialStreamBufferSize));var b=this.a.getNumber("initial_stream_buffer_size_for_video_stream",0);0<b&&-1!==this.Ca.indexOf("v")&&(this.R=b);null!=a.dynamicStreamBufferSize&&(this.ja=Number(a.dynamicStreamBufferSize));null!=a.smartBufferAdjustmentParams&&(this.Da=a.smartBufferAdjustmentParams);null!=a.smartBufferAdjustmentEnabled&&(this.ba=Boolean(a.smartBufferAdjustmentEnabled));null!=a.streamBufferSize&&(this.ga=Number(a.streamBufferSize));
null!=a.fixBufferingGoalDetermination&&(this.U=Boolean(a.fixBufferingGoalDetermination));null!=a.addCdnDebugQueryParameters&&(this.va=Boolean(a.addCdnDebugQueryParameters));null!=a.useInitialBufferSizeWhenPaused&&(this.Ga=Boolean(a.useInitialBufferSizeWhenPaused));null!=a.segmentRequestTimeout&&(this.c.T=Number(a.segmentRequestTimeout));null!=a.resolveVideoTimeUpdateOnFragmentedTimeRanges&&(this.xa=Boolean(a.resolveVideoTimeUpdateOnFragmentedTimeRanges));null!=a.performanceLogger&&(this.l=this.o.performanceLogger=
a.performanceLogger);null!=a.abrLogger&&(this.o.abrLogger=a.abrLogger);null!=a.reappendInitSegmentAfterAbort&&(this.o.reappendInitSegmentAfterAbort=Boolean(a.reappendInitSegmentAfterAbort));null!=a.liveDataFetchMaxRetries&&(this.o.liveDataFetchMaxRetries=Number(a.liveDataFetchMaxRetries));null!=a.liveSourceBufferClearMaxRetries&&(this.o.liveSourceBufferClearMaxRetries=Number(a.liveSourceBufferClearMaxRetries));null!=a.skipEmptySegments&&(this.o.skipEmptySegments=Boolean(a.skipEmptySegments));null!=
a.playheadFragmentedGapDiffAllowance&&(this.o.playheadFragmentedGapDiffAllowance=Number(a.playheadFragmentedGapDiffAllowance));null!=a.useMicroTaskTimeouts&&(this.Ha=Boolean(a.useMicroTaskTimeouts));a=this.c;b=this.o;null!=b.reappendInitSegmentAfterAbort&&(a.R=Boolean(b.reappendInitSegmentAfterAbort));null!=b.performanceLogger&&(a.l=b.performanceLogger);null!=b.abrLogger&&(a.I=b.abrLogger);null!=b.liveDataFetchMaxRetries&&(a.O=b.liveDataFetchMaxRetries);null!=b.liveSourceBufferClearMaxRetries&&(a.K=
b.liveSourceBufferClearMaxRetries);null!=b.playheadFragmentedGapDiffAllowance&&(a.P=b.playheadFragmentedGapDiffAllowance);null!=b.skipEmptySegments&&(a.V=b.skipEmptySegments)};U.prototype.destroy=function(){Vd(this);this.O.destroy();this.ra=this.g=this.O=null;this.c.destroy();this.b=this.c=null;this.a.getBool("fixing_scheduler_disable_leaks",!0)&&(this.u=null);this.Ja=null};n=U.prototype;n.Ya=function(){return this.g};n.Gb=function(){return this.f};
n.Kc=function(a){this.B||a.then(function(){this.B=!0;this.w||V(this,0)}.bind(this)).catch(function(){});return this.O};n.Db=function(){this.G=!0;Wd(this)};n.gb=function(){return this.G};
n.jb=function(a,b,c,d,e){if(a!=this.g){var f=1;this.a.getBool("use_live_bitrate_estimates",!1)&&null!==this.m&&0<this.g.bandwidth&&(f=this.m.getEstimate()/this.g.bandwidth);var g=a.aa;g&&(this.ma=g.create(this.l,this.Pa));this.Z=!0;a.M.create().then(J(this,function(g){if(this.b){this.Z=!1;var k=this.g;this.g=a;this.a.getBool("use_live_bitrate_estimates",!1)&&(this.m=Ud(this,(a.bandwidth||0)*f));var l=this.f;this.f=g;this.c.D=this.f;l&&l.a.Fc();ud(this.f,function(a){var b=a;this.j&&this.j.setSegments(this.f.getSegments());
this.u&&(a=a&&this.a.getBool("optimize_stream_get_segments_calls",!1)?a:this.f.getSegments(),this.a.getBool("templated_update_srm_by_delta_of_changed_references_bool",!1)&&this.f.K&&b.length<this.f.getSegments().length&&(a=this.f.getSegments().slice(-(b.length+1))),Xd(this,this.g.id||"",a))}.bind(this));this.j&&this.j.setSegments(this.f.getSegments());if(this.u){var l=[],m=this.a.getNumber("templated_chunked_segment_update_limit_int",0);if(m){g=this.f.length();for(var m=Math.min(g,m),p=1;p<=m;++p)l.push(this.f.get(g-
p))}else l=g.getSegments();Xd(this,a.id||"",l)}this.ta=!0;this.ca=d?d:null;this.S||(this.a.getBool("make_early_track_selection",!1)&&this.h&&!this.P&&!this.w?V(this,0):k?b?Yd(this,!0,c):e&&Yd(this,!1):V(this,0))}})).catch(J(this,function(a){this.Z=!1;"aborted"!=a.type&&(this.B?(a=A(a),this.dispatchEvent(a)):this.O.reject(a))}))}};n.Cc=function(a){return Yd(this,!!a)};n.Hc=function(){this.ka=!0};n.Jc=function(a){this.Ea=a};
function Xd(a,b,c){a.a.getNumber("templated_chunked_segment_update_limit_int",0)&&a.u.updateSegmentIndex(b,a.f);a.a.getBool("use_update_segments_by_shaka_reference",!0)&&a.u.updateSegmentsByShakaReferences(b,c)}
function Yd(a,b,c){a.g&&!a.S&&(a.S=!0,Vd(a),a.T=!1,null!==a.A&&a.A.reset(),a.c.abort().then(J(a,function(){var a=this.b.currentTime;this.a.getBool("set_current_time_in_resync",!1)&&0==a?(this.l&&BanzaiODS.bumpEntityKey(2966,"videos.www.shaka","set_current_time_in_resync"),a=this.f.first().startTime):this.a.getBool("better_set_current_time_in_resync",!1)&&a<this.f.first().startTime&&(BanzaiODS.bumpEntityKey(2966,"videos.www.shaka","set_current_time_in_resync"),a=this.f.first().startTime+this.a.getNumber("resync_set_current_time_fudge_factor",
0));if(!b&&0<rb(this.c,a)&&0<=Fb(this.c,a))return Promise.resolve();if(c)return Cb(this.c,this.b.currentTime+c);this.ia=!0;return Bb(this.c)})).then(J(a,function(){this.S=!1;V(this,0)})).catch(J(a,function(a){this.S=!1;"aborted"!=a.type&&(this.B?(a=A(a),this.dispatchEvent(a)):this.O.reject(a))})))}n.Ic=function(a){return 0<rb(this.c,a)&&0<=Fb(this.c,a)};n.vb=function(){};n.Eb=function(){return!0};
function Zd(a){a.ea=a.ea||!a.b.paused;a.b.paused||a.ba||(a.Y=Date.now(),a.ba=!0);var b=a.Da,c=null;if(b.inExperiment)if(b.useSmartBuffering){if(a.ba&&a.Y){var c=(Date.now()-a.Y)/1E3,d=null;1>c?c=null:(d=3>c?b.bufferSize_00_to_03:10>c?b.bufferSize_03_to_10:30>c?b.bufferSize_10_to_30:60>c?b.bufferSize_30_to_60:b.bufferSize_above_60,c=Math.min(d,a.b.duration))}}else a.Y&&(c=b.nonSmartBufferSize);c||(c=a.Ga&&a.b.paused?a.R:a.ga,a.b.paused&&1<a.na&&(c*=a.na),a.ja&&!a.b.paused&&(c=Math.max(Math.min(a.f.last().endTime-
a.b.currentTime,a.ja),a.ga)));c=(a.U?a.h&&a.ea:a.h)?Math.max(a.R,c):a.R;0<a.a.getNumber("audio_video_buffer_diff_threshold",14400)&&(b=a.b.buffered.length?a.b.buffered.end(a.b.buffered.length-1):0,b=Math.max(0,b-a.b.currentTime),c=Math.min(c,b+a.a.getNumber("audio_video_buffer_diff_threshold",14400)));return c}
function $d(a){var b=a.a.getNumber("start_stream_buffer_size",1),c=a.a.getNumber("low_start_stream_buffer_size",1);if(b!==c){var d=a.a.getNumber("low_bandwidth_start_stream_buffer_size_threshold",0),e=a.a.getNumber("scheduled_videos_start_stream_buffer_size_threshold",0);if(0<d&&a.ra.getBandwidth()<d&&VideoStreamingTaskQueueProvider.getQueueSize("video")>=e)return c}return b}function ae(a,b){return rb(a.c,a.h?b:b+(a.D||0))}
function be(a){if(a.h&&!a.B||a.a.getBool("make_early_track_selection",!1)&&a.Z||a.a.getBool("prevent_fetch_while_fetching_in_stream",!1)&&a.P)return a.w=null,Promise.resolve();var b;if(b=a.B&&!a.G)b=1<a.c.a.buffered.length?!0:!1;if(b&&(a.ka||Hb(a.c,a.b)))return a.xa&&(a.b.currentTime=Gb(a.b)),null===a.K&&(a.ka=!1,Yd(a,!0)),Promise.resolve();a.a.getNumber("decouple_stream_on_update_loop_from_request_loop_int",0)||(a.w=null);b=a.g;var c=a.f,d=a.b.currentTime;a.a.getBool("use_pending_seek_position_for_reference",
!1)&&0===a.b.readyState&&!d&&a.J&&(d=a.J);if(a.U&&!a.h&&ae(a,d)>=$d(a))return a.a.getBool("fix_chrome_mse_regression",!1)&&1===a.b.readyState&&0<a.b.buffered.length&&(a.b.currentTime=a.b.currentTime),ce(a),V(a,0),Promise.resolve();var e=null,f=[];null!==a.K&&(d=a.K);if(ae(a,d)>=Zd(a))if(a.T=!0,null!==a.I&&a.I.resolve(),a.U||ce(a),f=de(a)?je(a,d):[],0<f.length)e=f[0];else return V(a,1E3/(5*(Math.abs(a.b.playbackRate)||1))),Promise.resolve();else{var g=1;a.j&&(g=a.j.getNumberOfSegments());var h=qb(a.c);
a.V&&(h=null,null!==a.K&&(a.V=!1));a.a.getBool("find_last_inserted_segment_in_segment_index",!1)&&h&&!c.a.a&&(h=c.find(h.startTime));a.a.getBool("set_pending_seek_on_set_current_time_failure",!1)&&null!=a.J&&(d=a.J,a.J=null);g=ke(a,d,c,g,h);e=g[0];a.j&&(a.j.setFutureSegments(g),a.j.setBufferingGoal(Zd(a)-ae(a,d)));!e&&de(a)&&(f=je(a,d),0<f.length&&(e=f[0]))}if(!e)return ce(a),a.B&&!a.G&&(a.G=!0,Wd(a)),V(a,200),Promise.resolve();a.a.getBool("create_own_segment_reference_for_sbm",!1)&&(e=jd(e,e.startTime,
e.endTime));le(a,me(a,d,f),b.id||"");ne(a,me(a,d,f));a.a.getBool("refresh_segment_reference_failover_uri",!0)&&(e.url=e.url.clone());a.P=!0;a.wa=Date.now();"video"===b.mimeType.split("/")[0]&&a.ra.setRepresentationID(b.id);c=a.c.fetch(e,c.s,b.a+a.Ea,a.ma,a.va&&!a.b.paused,0<f.length,a.u,a.F);c=c.then(J(a,function(a){this.a.getBool("updates_priority_on_fetch_complete",!1)&&ne(this,me(this,d,[]));this.sa.informNetworkResumed();return a}));a.$&&"video"===b.mimeType.split("/")[0]&&a.$.add(e.startTime||
0,e.endTime||0,{id:b.id,reason:a.ca,performanceLogger:a.l?a.l.getOperationLogger("stream_switch"):null});a.ma=null;a.ta&&(a.ta=!1,f=a.ca,a.ca=null,oe(a,b,f,a.la()));a.G=!1;return c.then(J(a,function(a){return this.a.getBool("clear_old_buffer",!1)?Eb(this.c,this.b.currentTime).then(function(){return a}):a})).then(J(a,function(a){var b=a.W,c=a.Wc;this.h||(this.ya=c);this.a.getBool("use_live_bitrate_estimates",!1)&&null!=a&&0<a.Dc&&0<a.H&&(null===this.m&&(this.m=Ud(this,this.g.bandwidth||0)),this.m.sample(8*
a.Dc,a.H));a=this.a.getNumber("buffer_velocity_time_in_past_to_consider",0);0<a&&null!==this.g&&"video"===Md(this.g)&&(null===this.A&&(this.A=new BufferVelocity(a)),this.A.recordBufferAhead(rb(this.c,this.b.currentTime)));this.P=!1;"video"===(this.g?this.g.mimeType.split("/")[0]:null)&&this.dispatchEvent(y({type:"fetch_end",bubbles:!0,detail:{stream_fetch_time_ms:Date.now()-this.wa,segment_length_ms:1E3*(e.endTime-e.startTime)}}));null==this.D&&(this.D=b);this.ia&&0<rb(this.c,d)&&(this.ia=!1,this.a.getBool("disable_nudge",
!1)||(b=y({type:"should_nudge"}),this.dispatchEvent(b)));V(this,0)})).catch(J(a,function(a){this.P=!1;return Promise.reject(a)}))}function me(a,b,c){var d=a.h?b:b+(a.D||0);return{additionalSegmentsRequired:c,playhead:b,bufferStart:d,bufferEnd:ae(a,b)+d,bufferingGoal:Zd(a),isPlaying:!a.b.paused}}function le(a,b,c){a.u&&a.u.updatePlayerState(c,b)}function ne(a,b){a.F&&a.F.updatePlayerState(b)}
function pe(a,b,c){var d=null!==a.i&&-1<a.i&&a.i<c.length()-1?c.get(a.i):null,e=null;if(null===a.i||!d||d.startTime>b)return e=c.findIndex(b),a.i=e;for(d=a.i;d<=a.i+1;d++)if(e=c.get(d),e.startTime<=b&&e.endTime>b)return a.i=d;e=c.findIndex(b);return(a.i=e)||-1}function de(a){return a.a.getBool("replace_lower_quality_buffer",!1)&&null===a.F&&a.ea&&null!==a.$&&"video"===Md(a.g)&&null!==a.f}
function je(a,b){if(!a.Fa||!a.g.id||!a.f)return[];var c=pe(a,b,a.f);return-1===c?[]:BufferReplacementHelper.getSegmentsToReplaceLowerQuality(a.f.getSegments(),b,c,a.g.id,a.Fa,a.$,{thresholdBefore:a.a.getNumber("buffer_replacement_behind_threshold",5),thresholdAfter:a.a.getNumber("buffer_replacement_ahead_threshold",15),wrapReplacementPastEnd:a.a.getBool("wrap_replacement_past_end",!1)})}
n.zc=function(){var a;if(this.l){var b=this.a.getNumber("stream_onupdate_sampling",0);b&&0===Math.floor(Math.random()*b)&&(a=this.l.getOperationLogger("stream_onupdate").start())}var c;this.a.getNumber("decouple_stream_on_update_loop_from_request_loop_int",0)&&V(this,this.a.getNumber("decouple_stream_on_update_loop_from_request_loop_int",0));if(this.a.getBool("catch_stream_update_sync_code_error",!1))try{c=be(this)}catch(d){d.type="uncaught",a&&a.setError(d),c=Promise.reject(d)}else c=be(this);c.catch(J(this,
function(a){if("aborted"!=a.type){if("sourcebuffer_full"===a.type)return Bb(this.c).then(J(this,function(){V(this,0)}));var b=[0,404,410,502,503,504];this.a.getBool("enable_double_ingest",!1)&&b.push(417,200);b=-1===b.indexOf(a.status);if("net"===a.type&&!b&&this.g)if(this.a.getBool("allow_infinite_retry_on_net_err",!0))switch(a.status){case 404:V(this,2E3);break;case 410:this.a.getBool("end_all_streams_on_410",!1)?qe(this):this.Db();break;case 417:case 200:a.responseHeaders&&null!=a.responseHeaders["x-fb-video-replica"]?
this.dispatchEvent(y({type:"replicaswitch",bubbles:!0,replica:a.responseHeaders["x-fb-video-replica"],url:a.url,status:a.status})):b=!0;break;default:V(this,1E3)}else V(this,1E3),b=!0;0===a.status?this.sa.informNetworkInterrupted():this.sa.informNetworkResumed();if(!this.a.getBool("allow_infinite_retry_on_net_err",!0)||b)b=A(a),this.dispatchEvent(b),this.l&&setTimeout(function(){var b=this.l.getEventLogger("stream_error_fallback").setError(a).setType(this.Ca.split("/")[0]);this.b?b.setResult("failed"):
b.setResult("success");b.log()}.bind(this),0)}}));a&&a.log()};function ke(a,b,c,d,e){var f=-1;if(a.a.getBool("templated_faster_stream_get_next_n",!1)&&1===d&&null!=e&&null!=e.endTime)return(c=c.find(e.endTime))?[c]:[];null!=e?f=null!=e.endTime?c.findIndex(e.endTime):-1:(f=pe(a,b,c),0>f&&(f=c.length()?c.length()-1:-1));a=[];if(0<=f)for(b=f;b<f+d&&b<c.length();b++)a.push(c.get(b));return a}
function ce(a){if(!a.h&&null!=a.D){a.h=!0;var b=a.c,c=a.D,d=c-b.U;0!=d&&(b.b=kd(b.b,d),b.U=c);a.O.resolve(a.D)}}n.Ed=function(){return this.h};U.prototype.hasStarted=U.prototype.Ed;U.prototype.kb=function(){return this.T};U.prototype.hasHitBufferingGoal=U.prototype.kb;U.prototype.la=function(){return null===this.m?null:this.m.getEstimate()};U.prototype.getBitrateEstimate=U.prototype.la;U.prototype.qb=function(){return null===this.A?null:this.A.getVelocity()};U.prototype.getBufferVelocity=U.prototype.qb;
function oe(a,b,c,d){var e=b.mimeType.split("/")[0];b=y({type:"adaptation",id:b.id,bubbles:!0,contentType:e,size:"video"!=e?null:{width:b.width,height:b.height},bandwidth:d||b.bandwidth,reason:c});a.dispatchEvent(b)}function qe(a){var b=y({type:"should_end_all_streams"});a.dispatchEvent(b)}function Wd(a){var b=y({type:"ended"});a.dispatchEvent(b)}U.prototype.Oa=function(){return this.F};U.prototype.getVideoStreamingManager=U.prototype.Oa;
function V(a,b){Vd(a);!b&&a.Ha?Promise.resolve().then(a.zc.bind(a)):a.w=setTimeout(a.zc.bind(a),b)}function Vd(a){null!=a.w&&(clearTimeout(a.w),a.w=null)}U.prototype.sb=function(){return this.ya};U.prototype.Ra=function(){return this.c.i};U.prototype.getStreamProgressTracker=U.prototype.Ra;function re(a,b){a.K=b;a.V=!0;a.I||(a.I=new I);return a.I};function se(a){this.b=a;this.a=null}se.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};se.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new id(0,null,this.b,0,0),a=new T([a],1);this.a=new R(a);return Promise.resolve(this.a)};se.prototype.c=function(){return this.a};function te(a,b){F.call(this,a);this.b=b;this.j=!0;this.m=this.g=null;this.f=new I;this.a=null}r(te,F);te.prototype.pa=function(){};te.prototype.destroy=function(){this.a&&this.b.removeChild(this.a);this.f.destroy();this.Ja=this.b=this.g=this.m=this.a=this.f=null};n=te.prototype;n.Ya=function(){return this.g};n.Gb=function(){return this.m};n.Kc=function(){return this.f};n.gb=function(){return!0};n.Db=function(){};
n.jb=function(a){a.M.create().then(J(this,function(b){if(this.b){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.g;this.g=a;this.m=b;b=b.first().url.c[0].toString();var d=this.Eb();this.a&&(this.vb(!1),this.b.removeChild(this.a));this.a=document.createElement("track");this.b.appendChild(this.a);this.a.src=b;this.vb(d);b=y({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.f.resolve(0)}}))};n.Cc=function(){};
n.Hc=function(){};n.Ic=function(){return!0};n.vb=function(a){this.j=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};n.Eb=function(){this.a&&(this.j="showing"==this.a.track.mode);return this.j};n.sb=function(){return 0};n.Jc=function(){};function ue(){}
ue.prototype.parse=function(a,b,c,d){var e=null;try{var f;var g=new Ia(b);if(440786851!=Ka(g).id)f=null;else{var h=Ka(g);if(408125543!=h.id)f=null;else{var k=h.a.byteOffset,l;var m=new Ia(h.a);for(b=null;Da(m.a);){var p=Ka(m);if(357149030==p.id){b=p;break}}if(b){for(var t=new Ia(b.a),p=1E6,m=null;Da(t.a);){var w=Ka(t);if(2807729==w.id)p=Oa(w);else if(17545==w.id)if(b=w,4==b.a.byteLength)m=b.a.getFloat32(0);else if(8==b.a.byteLength)m=b.a.getFloat64(0);else throw new RangeError("EbmlElement: floating point numbers must be 4 or 8 bytes.");}null==
m?l=null:(t=p/1E9,l={Hb:t,duration:m*t})}else l=null;f=l?{Ad:k,Hb:l.Hb,duration:l.duration}:null}}if(f){var z=Ka(new Ia(a));if(475249515!=z.id)e=null;else{var H=f.Ad,da=f.Hb,ea=f.duration;a=[];for(var Aa=new Ia(z.a),k=f=z=-1;Da(Aa.a);){var cb=Ka(Aa);if(187==cb.id){var na;var vd=new Ia(cb.a),wd=Ka(vd);if(179!=wd.id)na=null;else{var Ye=Oa(wd),xd=Ka(vd);if(183!=xd.id)na=null;else{var ee=new Ia(xd.a);for(l=0;Da(ee.a);){var fe=Ka(ee);if(241==fe.id){l=Oa(fe);break}}na={zb:Ye,yd:l}}}if(na){var ge=da*na.zb,
he=H+na.yd;if(0<=z){var Nc=new K(d,c,k,he-1),Af=na.zb-f;a.push(new id(z,ge,Nc,na.zb,Af))}z=ge;f=na.zb;k=he}}}0<=z&&(Nc=new K(d,c,k,null),a.push(new id(z,ea,Nc,f,ea/da-f)));e=a}}else e=null}catch(ie){if(!(ie instanceof RangeError))throw ie;}return e};function ve(a,b,c,d,e,f,g,h,k,l,m){this.h=a;this.o=b;this.b=c;this.m=l||null;this.j=m||null;this.a=d;this.g=e;this.f=f;this.w=g;this.Sa=null;this.i=h;this.l=k||null;this.u=null}ve.prototype.destroy=function(){this.i=this.o=this.h=null;this.a.Ka();this.a=null;this.f&&(this.f.Ka(),this.f=null);this.g&&(this.g.Ka(),this.g=null);this.Sa=null};ve.prototype.Qc=function(){return this.Sa};ve.prototype.create=function(){return we(this)};ve.prototype.pb=function(){return we(this)};
function we(a){if(a.Sa)return a.Sa;var b=null;a.l&&(b=a.l.getOperationLogger("create_container_segment_index_source").start());if(null!==a.m&&(null!==a.j||"webm"!==a.b))return xe(a,a.m,a.j,b);var c=[a.a.fetch(null,null,a.l,b)];"webm"==a.b&&c.push(a.g.fetch(null,null,a.l,b));a.Sa=Promise.all(c).then(J(a,function(a){return xe(this,a[0],a[1]||null,b)}));return a.Sa}
function xe(a,b,c,d){var e=null;"mp4"==a.b?(e=new td,e=e.parse(new DataView(b),a.a.startByte,a.a.c,a.i,a.f)):"webm"==a.b&&(e=new ue,e=e.parse(new DataView(b),new DataView(c),a.a.c,a.i));if(!e)return a=Error("Failed to parse SegmentReferences from "+a.a.toString()+" (or one of its fallbacks)."),a.type="stream",Promise.reject(a);b=new T(e,e.s);var f;"dynamic"==a.h.type?f=new S(b,a.h,a.o,a.w):f=new R(b);d&&d.log();a.u=f;return Promise.resolve(f)}ve.prototype.c=function(){return this.u};function ye(a,b,c,d){this.c=a;this.b=b;this.l=c||null;this.a=d||null}
function ze(a,b,c){for(var d=ya()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],g=0;g<f.a.length;++g){var h=f.a[g];if("text"!=h.contentType)for(var k=0;k<h.a.length;++k){var l=h.a[k],m=0,m=m+(l.f?1:0),m=m+(l.b?1:0),m=m+(l.a?1:0);0==m?(h.a.splice(k,1),--k):1!=m&&(l.f?(l.b=null,l.a=null):l.b&&(l.a=null))}}Ae(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],g=0;g<f.a.length;++g){k=h=f.a[g];l=null;for(m=0;m<k.a.length;++m){var p=k.a[m].mimeType||"";l?p!=l&&(k.a.splice(m,1),--m):l=p}0==h.a.length&&(f.a.splice(g,1),
--g)}b.manifestIsLiveStreaming&&null==b.c&&(b.c=d);e=new Td;"dynamic"==b.type&&(e.b=!0,e.c=b.g,e.i=new K(c,b.u||b.url,void 0,void 0,void 0,a.a),e.j=b.c);e.B=b.h||0;e.m=b.i||0;e.o=b.j||0;e.g=b.m||5;for(f=0;f<b.a.length;++f){g=b.a[f];if(null==g.start)break;g=Be(a,b,g,d,c);e.a.push(g)}e.f=b.FBIsLiveTemplated;a.l&&a.l.setIsTemplatedManifest(b.FBIsLiveTemplated);e.A=b.FBWasLive;a=null;c="none";for(f=0;f<b.a.length;f++)for(g=b.a[f],d=0;d<g.a.length;d++)for(h=g.a[d],k=0;k<h.a.length;k++)l=h.a[k].i,null!=
l&&null!=l.value&&(a=c=l.value,"urn:mpeg:dash:23003:3:audio_channel_configuration:2011"===l.a&&("1"===a?c="mono":"2"===a&&(c="stereo")));e.w=c;a=parseInt(a,10);e.u=0<a?a:null;return e}
function Ae(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};a.manifestIsLiveStreaming&&(a.b=null);b(a.b)&&1==a.a.length&&!b(a.a[0].duration)&&(a.a[0].duration=a.b);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],g=a.a[e],h=a.a[e+1]||{start:a.b};!b(g.start)&&f&&b(f.start)&&b(f.duration)&&(g.start=f.start+f.duration);!b(g.duration)&&b(h.start)&&(g.duration=h.start-g.start);null!=g.start&&null!=g.duration?c+=g.duration:d=!1}b(a.b)||(e=a.a[a.a.length-1],
d?a.b=c:b(e.start)&&b(e.duration)?a.b=e.start+e.duration:a.manifestIsLiveStreaming||(a.b=c))}}
function Be(a,b,c,d,e){var f=new Sd;f.id=c.id;f.start=c.start;f.duration=c.duration;var g=new D;c.a.forEach(function(a){g.push(a.contentType||"",a)});for(var h=ab(g),k=0;k<h.length;++k){var l=new D;g.get(h[k]).forEach(function(a){l.push(a.group,a)});for(var m=ab(l),p=0;p<m.length;++p){var t=new D;l.get(m[p]).forEach(function(a){t.push(a.lang,a)});for(var w=ab(t),z=0;z<w.length;++z){var H=t.get(w[z]),H=Ce(a,b,c,H,d,e);f.a.push(H)}}}return f}
function Ce(a,b,c,d,e,f){ba(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var g=new Od,h=d.filter(function(a){return null!=a.id});h.length==d.length&&(g.id=h.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));g.b=!(!d[0].b||"urn:scte:dash:cc:cea-608:2015"!==d[0].b.a);g.lang=d[0].lang||"";g.contentType=d[0].contentType||"";g.f=d.some(function(a){return a.f});for(var h={},k=0;k<d.length;++k){var l=
d[k];l.c&&(g.c=l.c);for(var m=0;m<l.a.length;++m){var p=l.a[m],t=De(a,p),w=g.a.slice(0);Ee(t,w);0==w.length&&0<g.a.length||!(p=Fe(a,b,c,p,e,f))||(g.v.push(p),g.a=w,h[p.X]=l)}}if(g.a.some(function(a){return""==a.a}))return g.v.forEach(function(a){a.oa=!0}),g;a=Ge(d);for(k=0;k<g.v.length;++k)p=g.v[k],l=h[p.X],l==a&&(p.oa=!0);return g}
function Ge(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.a.length;++f){var g=e.a[f],g=(g.width||1)*(g.height||1)*(g.bandwidth||1);if(null==b||g<b)b=g,c=e}return c}function Ee(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e){var f=b[c],g=a[e];if(f.a==g.a&&f.i==g.i&&f.withCredentials==g.withCredentials&&f.h==g.h&&f.j==g.j&&f.g==g.g&&f.m==g.m&&Ma(f.c,g.c)){d=!0;Ob(b[c],a[e].b);break}}d||(b.splice(c,1),--c)}}
function De(a,b){var c=[];if(0==b.c.length)c.push(new Mb);else if(a.b)for(var d=0;d<b.c.length;++d)c.push.apply(c,He(a,b.c[d]));return c}
function He(a,b){var c=[];if(2!=a.b.length)return[];var d=a.b(b.f||"",b.c);if(!(d&&d instanceof Array))return[];for(var e=0;e<d.length;++e){var f;var g=d[e];f=new Mb;if(g){var h=Ya(g,"keySystem");if(null!=h)f.a=h;else throw Error("'keySystem' cannot be null.");var k=Ya(g,"licenseServerUrl");if(null!=k)f.i=k;else if(h)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");h=B(g,"withCredentials");null!=h&&(f.withCredentials=h);h=Za(g,"licensePostProcessor",Function);
null!=h&&(f.f=h);h=Za(g,"licensePreProcessor",Function);null!=h&&(f.o=h);h=B(g,"distinctiveIdentifierRequired");null!=h&&(f.h=h);h=B(g,"persistentStateRequired");null!=h&&(f.j=h);h=Ya(g,"audioRobustness");null!=h&&(f.g=h);h=Ya(g,"videoRobustness");null!=h&&(f.m=h);h=Za(g,"serverCertificate",Uint8Array);null!=h&&(f.c=h);if(h=Za(g,"initData",Object)){g=Za(h,"initData",Uint8Array);if(null==g)throw Error("'initData.initData' cannot be null.");h=Ya(h,"initDataType");if(null==h)throw Error("'initData.initDataType' cannot be null.");
f.b.push({initData:new Uint8Array(g.buffer),initDataType:h})}}0==f.b.length&&b.a&&b.a.psshBox&&Ob(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function Fe(a,b,c,d,e,f){if(!d.baseUrl||0===d.baseUrl.length)return null;var g=null,h=1,k=0;if(d.f){g=d.mimeType.split("/")[1];if("mp4"!=g&&"webm"!=g)g=null;else{var l=d.f;if("webm"!=g||l.c)if(l.a||l.b&&l.b.a){h=l.b;h||(h=new wc,h.url=d.baseUrl,h.a=l.a?l.a.clone():null);k=Ie(a,h,f);h=l.c?Ie(a,l.c,f):null;l.f?(l=l.f,l=new K(f,d.baseUrl,l.qa,l.end,void 0,a.a)):l=null;var m=l,p=VideoPlayerShakaGlobalConfig.getBool("add_inline_initialization_resources",!1)&&d.h&&d.h.data?d.h.data:null,l=VideoPlayerShakaGlobalConfig.getBool("add_inline_initialization_resources",
!1)&&d.g&&d.g.data?d.g.data:null;a=new ve(b,c,g,k,h,m,e,f,a.l,p,l);b=new gd(h,l);c=new Kd;c.M=a;c.aa=b;g=c}else g=null;else g=null}h=d.f.s;k=d.f.L}else if(d.b)g=d.b,!g.H&&!g.C&&1<g.a.length?g=null:g.H||c.duration||g.C||1!=g.a.length?g.C&&0===g.C.N.length?g=null:(g=g.b?Ie(a,g.b,f):null,a=new Fd(b,c,d,e,f,a.a),b=new gd(g),c=new Kd,c.M=a,c.aa=b,g=c):g=null,h=d.b.s,k=d.b.L;else if(d.a){a:if(g=d.a,h=0+(g.a?1:0),h+=g.C?1:0,h+=g.H?1:0,0==h?h=!1:(1!=h&&(g.a?(g.C=null,g.H=null):g.C&&(g.H=null)),h=!0),h){h=
null;if(g.c&&(h=(g=d.a.c)?Je(d,g,xc):null,!h)){g=null;break a}g=h?Ie(a,h,f):null;h=d.a;h.a?(h=d.mimeType.split("/")[1],"mp4"!=h&&"webm"!=h?a=null:"webm"!=h||g?md(f,d,1,0,void 0,a.a)?(k=(k=d.a.a)?Je(d,k,wc):null)?(k=Ie(a,k,f),a=new ve(b,c,h,k,g,null,e,f,a.l)):a=null:a=null:a=null):a=h.f?h.C?new Jd(a.c,b,c,d,e,f,0,a.a):h.H?b.manifestIsLiveStreaming||null!=c.duration?new Ed(b,c,d,e,f):null:null:null;a?(b=new gd(g),c=new Kd,c.M=a,c.aa=b,g=c):g=null}else g=null;h=d.a.s;k=d.a.L}else"text"==d.mimeType.split("/")[0]&&
(g=new Kd,g.M=new se(new K(f,d.baseUrl)));if(!g)return null;g.id=d.id;k&&(g.a=-1*k/h);g.bandwidth=d.bandwidth;g.width=d.width;g.height=d.height;g.mimeType=d.mimeType||"";g.codecs=d.codecs||"";g.g=d.o||null;g.h=d.u||null;g.fbQualityLabel=d.fbQualityLabel||null;g.fbQualityClass=d.fbQualityClass||null;g.f=d.m||null;g.frameRate=d.frameRate||"";g.c=d.j||null;for(a=0;a<d.c.length;++a)b=d.c[a],b.b&&g.b.push(b.b);return g}
function Je(a,b,c){b=nd(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=Zc(a.baseUrl,b);return c}function Ie(a,b,c){var d=b.url,e=0,f=null;b.a&&(e=b.a.qa,f=b.a.end);return new K(c,d,e,f,void 0,a.a)};function Ke(a,b,c,d,e,f,g){this.b=new K(null,[new L(a)]);this.l=e;this.f=b;this.c=1;this.g=a;this.a=new tb;this.a.body=b;this.a.method=c;this.a.Na=3;this.a.withCredentials=d;this.a.b=1E3*(null!=g?g:ha);a=f||{};for(var h in a)this.a.Qa[h]=a[h]}
function Le(a){return a.b.fetch(a.a).then(function(a){return this.b.u&&0<this.c?(this.c--,null!==this.l&&null!==this.b.i&&this.l.setReason("Redirected to URL: "+this.b.i.toString()),this.b=new K(null,[new L(this.g)]),this.a.body=this.f,Le(this)):Promise.resolve(new Uint8Array(a))}.bind(a))};function Me(a,b,c,d){F.call(this,a);this.c=b;this.j=c;this.a=this.h=null;this.i=new bb;this.b=[];this.f=[];this.m=0;this.g=new I;this.o=null;this.A=ha;this.l=d}r(Me,F);Me.prototype.destroy=function(){this.Ja=null;for(var a=0;a<this.f.length;++a)this.f[a].close().catch(function(){});this.f=[];this.b=this.a=this.h=null;this.g.destroy();this.g=null;this.i.destroy();this.i=null;this.o&&(clearTimeout(this.o),this.o=null);this.c=this.j=null};
Me.prototype.initialize=function(){for(var a=new D,b=Ne(this.j),c=0;c<b.length;++c){var d=b[c];d.a.a||d.b&&!Oe(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var g=f.a.a,h=c[g];h||(h=f.a,h={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:h.h?"required":"optional",persistentState:h.j?"required":"optional",sessionTypes:["temporary"]},c[g]=h);if(f.b&&(g=f.contentType+"Capabilities",
g in h)){d=!0;h[g]||(h[g]=[]);var k;"audio"==f.contentType?k=f.a.g:"video"==f.contentType&&(k=f.a.m);h[g].push({contentType:f.b,robustness:k})}}}if(!d)if(b.length)this.a=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return Pe(this.j,a),this.g.resolve(),Promise.resolve();k=new I;c=Qe(c,k);c=c.then(this.w.bind(this,b,a));k.reject(null);this.l&&this.l.getEventLogger("eme_init").log();return c};
function Qe(a,b){for(var c in a)b=b.catch(function(a,b){return navigator.requestMediaKeySystemAccess(a,[b])}.bind(null,c,a[c]));return b}
Me.prototype.w=function(a,b,c){if(!this.c)return Re();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],g=0;g<f.length;++g){var h=f[g];if(!b.a.hasOwnProperty(h)){var k=e[h+"Capabilities"];if(k){for(var k=k[0],l=[],m={},p=0;p<a.length;++p){var t=a[p],w=k?t.b==k.contentType:t.contentType==h;t.a.a!=d||!w||t.id in m||(l.push(t),m[t.id]=!0,this.a=this.a?Nb(this.a,t.a):t.a)}b.set(h,l)}}}Pe(this.j,b);if(this.c.mediaKeys)this.h=this.c.mediaKeys;else return c.createMediaKeys().then(function(a){this.h=
a}.bind(this))};function Se(a){return a.c?a.h?a.c.setMediaKeys(a.h).then(J(a,function(){return this.c?this.a.c?this.h.setServerCertificate(this.a.c):Promise.resolve():Re()})).then(J(a,function(){if(!this.c)return Re();for(var a=0;a<this.a.b.length;++a){var c=this.a.b[a];this.u({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==this.a.b.length&&E(this.i,this.c,"encrypted",this.u.bind(this))})):Promise.resolve():Re()}
function Re(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
Me.prototype.u=function(a){var b=new Uint8Array(a.initData);this.l&&this.l.getEventLogger("encrypted_sample").log();for(var c=0;c<this.b.length;++c)if(Ma(b,this.b[c].data))return;try{var d=Te(this)}catch(e){b=A(e);this.dispatchEvent(b);this.l&&this.l.getEventLogger("eme_error").setError(e).log();this.g.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.b.push({data:b,ub:d});a.catch(J(this,function(a){if(this.c){for(var b=0;b<this.b.length;++b)if(this.b[b].ub==d){this.b.splice(b,
1);break}b=A(a);this.dispatchEvent(b);this.l&&this.l.getEventLogger("eme_error").setError(a).log();this.g.reject(a)}}));this.f.push(d)};function Ue(a){for(var b=[],c=0;c<b.length;++c){var d=Te(a),e=d.load(b[c]);a.f.push(d);e.then(J(a,function(){this.m++;this.m>=this.f.length&&this.g.resolve()})).catch(J(a,function(a){var b=A(a);this.dispatchEvent(b);this.l&&this.l.getEventLogger("eme_error").setError(a).log()}))}}
function Te(a){var b=null,b=a.h.createSession();E(a.i,b,"message",a.D.bind(a));E(a.i,b,"keystatuseschange",a.B.bind(a));return b}Me.prototype.D=function(a){Ve(this,a.target,this.a,a.message)};
Me.prototype.B=function(a){a=a.target;var b={};a.keyStatuses.forEach(function(a,c){if("string"===typeof a){var f=a;a=c;c=f}if("com.microsoft.playready"==this.a.a&&16==a.byteLength){var f=new DataView(a),g=f.getUint32(0,!0),h=f.getUint16(4,!0),k=f.getUint16(6,!0);f.setUint32(0,g,!1);f.setUint16(4,h,!1);f.setUint16(6,k,!1)}f=Lb(new Uint8Array(a));b[f]=c}.bind(this));if(a.expiration<Date.now()){for(var c=0;c<this.b.length;++c)if(this.b[c].ub==a){this.b.splice(c,1);break}a.close();this.f.splice(this.f.indexOf(a),
1)}this.l&&this.l.getEventLogger("eme_key_status_change").log();We(this.j,b)};
function Ve(a,b,c,d){d=Xe(c,d);var e=null;a.l&&(e=a.l.getOperationLogger("license_request").start());Le(new Ke(d.url,d.body,d.method,c.withCredentials,e,d.headers,a.A)).then(J(a,function(a){e&&(e.setResult("success"),e.log());c.f&&(a=c.f(a));e=null;this.l&&(e=this.l.getOperationLogger("eme_post_license_session_update").start());null===a||void 0===a||0===a.byteLength?null!==e&&(e.setError("empty license"),e.setResult("failed").log()):b.update(a).then(J(this,function(){e&&(e.setResult("success"),e.log());
var a=y({type:"sessionReady",detail:b});this.dispatchEvent(a);this.m++;this.m>=this.f.length&&this.g.resolve()})).catch(J(this,function(a){a.ub=b;var c=A(a);e&&(e.setResult("failed"),e.setError(a).log());this.dispatchEvent(c)}))})).catch(J(a,function(a){if(c.f){var d=JSON.stringify({data:[{error:a}]}),d=new Uint8Array(d.split("").map(function(a){return a.charCodeAt(0)}));c.f(d)}a.ub=b;d=A(a);e&&e.setError(a).log();this.dispatchEvent(d)}))}
function Xe(a,b){var c={url:a.i,body:b.slice(0),method:"POST",headers:{},key_system:a.a};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),g=0;g<e.length;g++)c.headers[e[g].childNodes[0].nodeValue]=f[g].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.o)return c;
a.o(c);c.url=Ya(c,"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"===typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=Ya(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=Za(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c};function W(a,b,c,d,e,f,g){F.call(this,null);this.b=a;this.f=b;this.a=null;this.g=new bb;this.m=this.i=null;this.F=0;this.S=this.Z=this.$=null;this.ba=g;this.J=null;this.O=this.h=!1;this.V=this.Y=!0;this.K=!1;this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:ha,mpdRequestTimeout:ia,segmentRequestTimeout:ja,preferredLanguage:"en",restrictions:new ka};this.l=c;this.G=d;this.ca=e;this.ga=f;this.o=null;this.j=1;this.T=null;this.u=this.A=this.w=!1;this.R=this.B=
null}r(W,F);q("shaka.player.Player",W);W.version="v1.6.4-fb";W.isBrowserSupported=function(){return!!window.MediaSource&&!!window.Uint8Array};
W.prototype.Ba=function(){var a={},b=this.a;if(b){var c=b.Yb();a.BandwidthEstimator=c.BandwidthEstimator;var d=c.VideoSourceStream;d&&(a.VideoSourceStream=d,(d=a.VideoBufferManager=d.Ba().SourceBufferManager)&&(a.VideoSourceBuffer=d.Ba().SourceBuffer));(d=a.AudioSourceStream=c.AudioSourceStream)&&(d=a.AudioBufferManager=d.Ba().SourceBufferManager)&&(a.AudioSourceBuffer=d.Ba().SourceBuffer);a.TextSourceStream=c.TextSourceStream;a.getManifest=b.Ub.bind(b)}else a.getManifest=function(){};a.Nd=!0;return a};
W.prototype.getDebug=W.prototype.Ba;W.prototype.ta=function(a){this.Y=a};W.prototype.setResumeAfterBuffering=W.prototype.ta;function Oe(a){return"text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a)}W.isTypeSupported=Oe;W.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+ra(a)+" }",0)};
W.prototype.destroy=function(){return this.U().then(J(this,function(){this.g.destroy();this.b=this.g=null;this.R&&this.R.remove()})).catch(function(){})};W.prototype.destroy=W.prototype.destroy;W.prototype.U=function(){this.K=!0;return Ze(this)};W.prototype.unload=W.prototype.U;
function Ze(a){var b;a.l&&(b=a.l.getOperationLogger("unload").start());if(!a.a)return b&&b.log(),Promise.resolve();a.h&&$e(a,"unloading");a.b.pause();db(a.g);af(a);bf(a);a.i&&(a.i.destroy(),a.i=null);a.a&&(a.a.destroy(),a.a=null);a.f.getBool("www_videos_playback_remove_src_attr_on_unload",!1)?(a.b.removeAttribute("src"),a.f.getBool("www_videos_playback_load_after_remove_src_attr",!1)&&a.b.load()):a.b.src="";var c=a.f.getBool("www_shaka_clear_media_keys_on_unload",!1)&&a.b.setMediaKeys&&"function"===
typeof a.b.setMediaKeys?a.b.setMediaKeys(null):Promise.resolve(),c=c.then(function(){b&&b.log();if(a.f.getBool("enable_p2p_support",!1)){var c=y({type:"unload"});a.dispatchEvent(c)}});a.h=!1;a.O=!1;a.A=!1;a.u=!1;return c}function cf(a,b){for(var c=0;c<a.length;c++)b.push(a[c].contentType,a[c])}W.prototype.Ga=function(a){return df(this,a)};W.prototype.load=W.prototype.Ga;
function df(a,b){var c;a.l&&(c=a.l.getOperationLogger("load").setState("loading").start(),b.l=b.g.performanceLogger=a.l);a.G&&(b.Bb=b.g.abrLogger=a.G);a.ba&&(b.ia=a.ba);a.ca&&(b.I=a.ca);a.ga&&b.U.push(a.ga);ef(b,a.b);var d=null;a.K=!1;E(a.g,b,"initiallivemanifestrequestfailure",a.ma.bind(a));E(a.g,b,"replicaswitch",a.pa.bind(a));a.a&&(d=Ze(a).then(J(a,function(){return b.wb()})));a.b.autoplay&&(u.qa("load"),E(a.g,a.b,"timeupdate",a.ed.bind(a)));b.lc(a.c);b.la=a.T;a.T=null;d||(d=b.wb());a.f.getBool("fix_shaka_player_load_race_condition",
!1)&&(a.a=b);d.catch(J(a,function(a){b.destroy();return Promise.reject(a)}));return d.then(J(a,function(){if(ff(this,b))return gf();this.a=b;this.g.Va(this.a,"initiallivemanifestrequestfailure");this.g.Va(this.a,"replicaswitch");E(this.g,this.a,"seekrangechanged",this.ra.bind(this));E(this.g,this.a,"allStreamsStarted",this.Fd.bind(this));var a=new D;cf(Ne(this.a),a);Pe(this.a,a);a=this.ea();c&&0<a.length&&(a=a.reduce(function(a,b){if(null===a||b.bandwidth<a.bandwidth)a=b;return a},null),c.setLowestQualityRepresentationID(a.streamInfoID));
if(!this.c.enableContentProtection)return Promise.resolve();this.i=new Me(this,this.b,this.a,this.l);return this.i.initialize()})).then(J(a,function(){if(ff(this,b))return gf();hf(this);E(this.g,this.b,"playing",this.kd.bind(this));E(this.g,this.b,"pause",this.ia.bind(this));E(this.g,this.b,"waiting",this.sd.bind(this));E(this.g,this.b,"play",this.na.bind(this));return jf(this.a,this,this.b)})).then(J(a,function(){if(ff(this,b))return gf();if(this.c.enableContentProtection){var a;this.l&&(a=this.l.getOperationLogger("eme_attach"));
return Se(this.i).then(function(){a&&a.log()})}return Promise.resolve()})).then(J(a,function(){if(ff(this,b))return gf();kf(this);c&&c.updateState("ready").log()})).catch(J(a,function(a){c&&c.setError(JSON.stringify(a)).log();if(ff(this,b))return gf();if("destroy"!=a.type){var d=A(a);this.dispatchEvent(d)}return this.U().then(function(){return Promise.reject(a)})}))}function ff(a,b){return!a.b||a.K||a.f.getBool("fix_shaka_player_load_race_condition",!1)&&b!==a.a}n=W.prototype;
n.Fd=function(){var a,b;this.f.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&this.l&&(a=this.l.getOperationLogger("on_all_streams_started"),b=this.l.getOperationLogger("restore_video_playback_rate"));this.O=!0;this.h?this.D():(this.b.playbackRate=this.j,b&&b.log());a&&a.log()};function gf(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}
function hf(a){var b=a.b.parentNode;b&&a.f.getBool("prevent_playing_on_insufficient_buffer",!1)&&(a.R=eventListenerCapture(b,"playing",function(a){a.target===this.b&&this.D(a)}.bind(a)))}n.ed=function(){u.end("load");this.g.Va(this.b,"timeupdate")};n.sd=function(a){lf(this);this.f.getBool("unify_stream_start_with_buffer_detector",!1)&&!this.h&&this.D(a)};
n.kd=function(){u.qa("playing");this.l&&this.l.getEventLogger("playing").setState("playing").log();!this.m&&0>this.j&&(this.b.playbackRate=0,this.P(this.b.currentTime,Date.now(),this.j));this.h&&!this.V&&$e(this,"playing")};n.Bd=function(a){this.u=a};W.prototype.setPendingPlayRequest=W.prototype.Bd;W.prototype.na=function(){this.u=!0};W.prototype.ia=function(){this.l&&this.l.getEventLogger("pause").setState("paused").log();u.end("playing");u.get("playing");bf(this)};
W.prototype.ra=function(a){this.F=a.start;this.$=a.last;this.Z=a.end;this.S=a.seekRangeGaps;this.f.getBool("no_skip_gaps_on_seek_range_changed",!1)||lf(this)};W.prototype.ea=function(){return this.a?this.a.Z():[]};W.prototype.getVideoTracks=W.prototype.ea;W.prototype.ya=function(){return this.a?this.a.va():[]};W.prototype.getAudioTracks=W.prototype.ya;W.prototype.Ea=function(){return this.a?this.a.mc():[]};W.prototype.getTextTracks=W.prototype.Ea;
W.prototype.selectVideoTrack=function(a,b){return this.a?this.a.selectVideoTrack(a,void 0==b?!0:b):!1};W.prototype.selectVideoTrack=W.prototype.selectVideoTrack;W.prototype.Ha=function(a,b,c){return this.a?mf(this.a,"audio",a,void 0==b?!0:b,c):!1};W.prototype.selectAudioTrack=W.prototype.Ha;W.prototype.Oa=function(a){return this.a?mf(this.a,"text",a,!1):!1};W.prototype.selectTextTrack=W.prototype.Oa;W.prototype.xa=function(a){this.a&&nf(this.a,a)};W.prototype.enableTextTrack=W.prototype.xa;
W.prototype.sa=function(a){bf(this);this.w&&this.h||!(0<=a)?this.b.paused||(this.b.playbackRate=0,this.P(this.b.currentTime,Date.now(),a)):this.b.playbackRate=a;this.j=a};W.prototype.setPlaybackRate=W.prototype.sa;W.prototype.ka=function(){return this.j};W.prototype.getPlaybackRate=W.prototype.ka;W.prototype.Da=function(){return this.a?this.a.Ab():null};W.prototype.getManifest=W.prototype.Da;W.prototype.Ra=function(a){this.T=a};W.prototype.setPlaybackStartTime=W.prototype.Ra;
W.prototype.I=function(){return this.a?!!this.a.P():!1};W.prototype.isLive=W.prototype.I;
W.prototype.wa=function(a){if(a){var b=B(a,"enableAdaptation");null!=b&&(this.c.enableAdaptation=b);b=B(a,"endBufferingOnPlaying");null!=b&&(this.V=b);b=B(a,"usePlaybackRateForBuffering");null!=b&&(this.w=b);b=C(a,"streamBufferSize",0);null!=b&&(this.c.streamBufferSize=b);b=C(a,"dynamicStreamBufferSize",0);null!=b&&(this.c.dynamicStreamBufferSize=b);null!=a.smartBufferAdjustmentParams&&(this.c.smartBufferAdjustmentParams=a.smartBufferAdjustmentParams);b=B(a,"addCdnDebugQueryParameters");null!=b&&
(this.c.addCdnDebugQueryParameters=b);b=C(a,"initialStreamBufferSize",0);null!=b&&(this.c.initialStreamBufferSize=b);b=B(a,"includeStreamBufferSizeInStartOffset");null!=b&&(this.c.includeStreamBufferSizeInStartOffset=b);b=C(a,"jumpToLiveThreshold");null!=b&&(this.c.jumpToLiveThreshold=b);b=C(a,"liveStreamEndTimeout",0);null!=b&&(this.c.liveStreamEndTimeout=b);b=C(a,"licenseRequestTimeout",0);null!=b&&(this.c.licenseRequestTimeout=b);b=C(a,"mpdRequestTimeout",0);null!=b&&(this.c.mpdRequestTimeout=
b);b=C(a,"minMpdRefreshInterval",0);null!=b&&(this.c.minMpdRefreshInterval=b);b=B(a,"enableLiveInterruptionDetection");null!=b&&(this.c.enableLiveInterruptionDetection=b);b=B(a,"enableManifestDebug");null!=b&&(this.c.enableManifestDebug=b,F.prototype.oc=b,b||(F.prototype.La=function(){}));b=B(a,"resolveVideoTimeUpdateOnFragmentedTimeRanges");null!=b&&(this.c.resolveVideoTimeUpdateOnFragmentedTimeRanges=b);b=C(a,"liveInterruptionConsecutiveUpdatesWithoutChange");null!=b&&(this.c.liveInterruptionConsecutiveUpdatesWithoutChange=
b);b=C(a,"liveInterruptionConsecutiveUpdatesWithChange");null!=b&&(this.c.liveInterruptionConsecutiveUpdatesWithChange=b);b=B(a,"reappendInitSegmentAfterAbort");null!=b&&(this.c.reappendInitSegmentAfterAbort=b);b=B(a,"liveSendPushHeaders");null!=b&&(this.c.liveSendPushHeaders=b);b=C(a,"liveMaxManifestFetchesWithPush");null!=b&&(this.c.liveMaxManifestFetchesWithPush=b);b=C(a,"liveMaxSegmentsToPush");null!=b&&(this.c.liveMaxSegmentsToPush=b);b=C(a,"segmentRequestTimeout",0);null!=b&&(this.c.segmentRequestTimeout=
b);b=Ya(a,"preferredLanguage");null!=b&&(this.c.preferredLanguage=b);b=Za(a,"restrictions",ka);null!=b&&(this.c.restrictions=b.clone());b=a.liveInitialPushRepresentation;null!=b&&(this.c.liveInitialPushRepresentation=b);b=a.liveAudioPushRepresentation;null!=b&&(this.c.liveAudioPushRepresentation=b);b=a.useInlineInitSegment;null!=b&&(this.c.useInlineInitSegment=b);b=B(a,"disableCacheBustingEvenThoughItMayAffectBandwidthEstimation");null!=b&&(Tc=!b);b=B(a,"currentTimeDuringReadyStateZeroThrows");null!=
b&&(this.c.currentTimeDuringReadyStateZeroThrows=b);b=C(a,"liveDataFetchMaxRetries");null!=b&&(this.c.liveDataFetchMaxRetries=b);b=C(a,"liveSourceBufferClearMaxRetries");null!=b&&(this.c.liveSourceBufferClearMaxRetries=b);b=B(a,"useLongCacheForManifest");null!=b&&(this.c.useLongCacheForManifest=b);b=B(a,"jumpToEarliestPositionInCurrentBlock");null!=b&&(this.c.jumpToEarliestPositionInCurrentBlock=b);b=B(a,"ignoreMinBufferTime");null!=b&&(this.c.ignoreMinBufferTime=b);b=C(a,"playheadFragmentedGapDiffAllowance");
null!=b&&(this.c.playheadFragmentedGapDiffAllowance=b);b=B(a,"fixBufferingGoalDetermination");null!=b&&(this.c.fixBufferingGoalDetermination=b);b=B(a,"skipEmptySegments");null!=b&&(this.c.skipEmptySegments=b);(b=B(a,"useMicroTaskTimeouts"))&&(this.c.useMicroTaskTimeouts=b);(b=B(a,"enableRequestPipelining"))&&(this.c.enableRequestPipelining=b);(b=B(a,"enableStreaming"))&&(this.c.enableStreaming=b);(a=B(a,"enableContentProtection"))&&(this.c.enableContentProtection=a);this.a&&this.a.lc(this.c)}};
W.prototype.configure=W.prototype.wa;W.prototype.Pa=function(a){this.a&&this.a.qc(a)};W.prototype.setEnableLiveheadCatchup=W.prototype.Pa;W.prototype.Fa=function(){return this.a?this.a.na:!1};W.prototype.isLiveheadCatchupEnabled=W.prototype.Fa;
function lf(a){if(a.f.getBool("skip_manifest_gap_based_on_stream_limits",!1)&&(!a.I()||!a.f.getBool("no_skip_manifest_gaps_if_live",!1))){var b;a.f.getBool("skip_manifest_gaps_use_cached_stream_limits",!1)?a.a&&null!==a.S?b={start:a.F,end:a.Z,last:a.$,ab:a.S}:b=a.a?a.a.nb():null:b=a.a?a.a.nb():null;if(b)for(var c=a.f.getNumber("skip_manifest_gap_boundary_precision_ms",1E3)/1E3,d=b.ab,e=a.b.playbackRate,f=a.b.currentTime,g=0;g<d.length;++g){var h=d[g].startTime-c,k=d[g].endTime+c;f<=k&&f>=h&&(a.f.getBool("fix_seek_range_gap_boundary",
!1)||(h=d[g].startTime,k=d[g].endTime),0<=e?b.end>k&&(a.b.currentTime=k):b.start<h&&(a.b.currentTime=h))}}}W.prototype.la=function(){var a=this.a&&this.a.nb();return(a=a&&{start:a.start,end:a.end,last:a.last,seekRangeGaps:a.ab})||null};W.prototype.getVideoSourceStreamLimits=W.prototype.la;W.prototype.Ca=function(){return this.c};W.prototype.getConfiguration=W.prototype.Ca;function bf(a){a.m&&(clearTimeout(a.m),a.m=null)}
function kf(a){var b;a.f.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&a.l&&(b=a.l.getOperationLogger("start_watchdog"));af(a);a.J=setTimeout(a.D.bind(a),100);b&&b.log()}function af(a){var b;a.f.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&a.l&&(b=a.l.getOperationLogger("cancel_watchdog"));a.J&&(clearTimeout(a.J),a.J=null);b&&b.log()}
W.prototype.P=function(a,b,c){this.m=null;var d=(Date.now()-b)/1E3*c;this.b.currentTime<this.F+(this.I()?1:.05)?this.b.pause():(d=Math.max(this.F,a+d),this.b.currentTime=d,this.m=setTimeout(this.P.bind(this,a,b,c),250))};function of(a){return a.f.getBool("unify_stream_start_with_buffer_detector",!1)&&!a.O}
function $e(a,b){if(!of(a)){u.end("buffering");null!==a.B&&(a.B=null);a.o&&(a.o.setConcluder(b).log(),a.o=null);if(a.G){var c=Date.now();a.G.setEvent("buffering").setClientTimeBegin(Math.round(c-u.get("buffering"))).setClientTimeEnd(Math.round(c)).log()}a.w&&(a.b.playbackRate=a.j);a.h=!1;a.dispatchEvent(y({type:"bufferingEnd"}));a.A&&(a.A=!1,dispatchDomEvent(a.b,"playing"));a.u=!1}}W.prototype.ja=function(a){this.dispatchEvent(y(a))};W.prototype.dispatchEventExtern=W.prototype.ja;
function pf(a){var b=a.b.buffered;if(1===b.length)b=b.end(0);else if(0===b.length)b=0;else{for(var c=0,d=0;d<b.length;++d)b.end(d)>=a.b.currentTime&&(c=b.start(d)<=a.b.currentTime?c+(b.end(d)-a.b.currentTime):c+(b.end(d)-b.start(d)));return c}return Math.max(b-a.b.currentTime,0)}
W.prototype.D=function(a){if(!this.f.getBool("prevent_playing_on_insufficient_buffer",!1)||!this.K){kf(this);var b=a?a.type:"",c="waiting"===b;if(!this.b.ended&&!this.b.seeking||c){var d;this.f.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&this.l&&(d=this.l.getOperationLogger("watchdog"));var e=this.b.buffered,f=e.length?e.end(e.length-1):0,g;this.f.getBool("fix_unstall_buffer_calculation",!1)?g=pf(this):g=Math.max(f-this.b.currentTime,0);var h=this.b.currentTime,e=this.I()?this.f.getNumber("live_buffering_underflow_threshold",
.5):this.f.getNumber("buffering_underflow_threshold",0),k=this.b.duration,k=isNaN(k)?0:Math.max(k-.05,0),f=f>=k||h>=k,b=b||"watchdog_timer";if(this.h){qf(this,a);a=rf(this.a);var l=0<a?g/a:0;g>a||sf(this.a)||this.f.getBool("fix_buffering_at_the_end_of_playback",!0)&&f?($e(this,b),this.Y&&!this.w&&this.b.play()):this.B!==l&&(this.B=l,this.dispatchEvent(y({type:"bufferingProgress",progress:l})))}else this.b.paused&&!c||!(!f&&g<e||of(this))||(this.h=!0,this.w?this.b.playbackRate=0:this.b.pause(),this.l&&
!this.o&&(g=this.b.buffered,g=g.length?g.end(g.length-1):0,this.f.getBool("fix_unstall_buffer_calculation",!1)?l=pf(this):l=Math.max(g-this.b.currentTime,0),g=1E3*(rf(this.a)-l),this.o=this.l.getOperationLogger("buffering").setLength(Math.round(g)).setType(this.u?"start/unpause":"in_play").setInitiator(b).start()),u.qa("buffering"),this.dispatchEvent(y({type:"bufferingStart"})),this.f.getBool("no_skip_gaps_on_buffering",!1)||lf(this),qf(this,a)),sf(this.a)&&$e(this,b);d&&d.log()}else this.f.getBool("fix_ff_in_play_stall_upon_seek",
!1)&&qf(this,a)}};W.prototype.ma=function(a){this.dispatchEvent(a)};W.prototype.pa=function(a){this.dispatchEvent(a)};function qf(a,b){b&&"playing"===b.type&&(a.A=!0,eventKill(b))}W.prototype.va=function(a){if(this.a){var b=this.a;b.c.video&&b.c.video.Jc(a)}};W.prototype.setVideoStreamOffset=W.prototype.va;function tf(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,g=/video\/webm; codecs="av01.*"/,h=!1,k=0;k<f.v.length;++k){var l=f.v[k];Oe(Nd(l))?g.test(Nd(l))&&(h=!0):(f.v.splice(k,1),--k)}if(h)for(k=0;k<f.v.length;++k)l=f.v[k],g.test(Nd(l))||(f.v.splice(k,1),--k);0==e.v.length&&(c.a.splice(d,1),--d)}for(b=0;b<a.length;++b)for(c=a[b],d=0;d<c.a.length;++d)c.a[d].v.sort(uf)}
function uf(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function vf(a){this.a=a}vf.prototype.destroy=function(){this.a.destroy();this.a=null};vf.prototype.update=function(a){var b=wf(a,null),c=wf(this.a,a);return Promise.all([b,c]).then(J(this,function(b){var c=b[0];b=b[1];tf(this.a.a);a.b&&!this.a.b&&(a.h=!0);a.c=this.a.c;a.i=this.a.i?this.a.i.clone():null;a.g=this.a.g;var f=[];xf(a,this.a,c,b,f);tf(a.a);return Promise.resolve(f)}))};
function wf(a,b){function c(a,b){return a.concat(b)}var d=a.a.map(function(a){return a.a}).reduce(c,[]).map(function(a){return a.v}).reduce(c,[]);if(VideoPlayerShakaGlobalConfig.getBool("templated_last_x_timeline",!1)&&b)var e=b.a.map(function(a){return a.a}).reduce(c,[]).map(function(a){return a.v}).reduce(c,[]).map(function(a){return a.M.create()}),e=Promise.all(e).then(function(a){for(var b=Number.POSITIVE_INFINITY,c=0;c<a.length;++c){var e=a[c];e.length()&&e.last().unscaledStartTime<b&&(b=e.last().unscaledStartTime)}b=
a.length?b:null;a=d.map(function(a){a.M.Ec&&a.M.Ec(b);return a.M.create()});return Promise.all(a)});else e=d.map(function(a){return a.M.create()}),e=Promise.all(e);return e.then(function(a){for(var b={},c=0;c<d.length;++c)b[d[c].X]=a[c];return Promise.resolve(b)})}
function xf(a,b,c,d,e){var f=new D;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new D;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=ab(f);for(b=0;b<a.length;++b){var h=a[b],k=f.get(h);1<k.length||(h=g.get(h))&&0!=h.length&&1==h.length&&(yf(k[0],h[0],c,d,e),k[0].duration=h[0].duration)}}
function yf(a,b,c,d,e){var f=new D;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new D;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=ab(f);for(b=0;b<a.length;++b){var h=a[b],k=f.get(h);1<k.length||(h=g.get(h))&&0!=h.length&&1==h.length&&zf(k[0],h[0],c,d,e)}}
function zf(a,b,c,d,e){var f=new D;a.v.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new D;b.v.forEach(function(a,b){g.push(a.id||""+b,a)});b={};for(var h=ab(f),k=0;k<h.length;++k){var l=h[k];b[l]=l;var m=f.get(l);1<m.length||((l=g.get(l))&&0!=l.length?1==l.length&&(Bf(m[0],l[0],c,d),m[0].aa=l[0].aa,l[0].aa=null,m[0].a=l[0].a,VideoPlayerShakaGlobalConfig.getBool("refresh_bandwidth_from_live_manifest",!1)&&(m[0].bandwidth=l[0].bandwidth)):(e.push(m[0]),a.v.splice(a.v.indexOf(m[0]),1)))}h=ab(g);
for(k=0;k<h.length;++k)l=h[k],b[l]||(b[l]=l,l=g.get(l),a.v.push(l[0]))}function Bf(a,b,c,d){a=c[a.X];c=d[b.X];d=(b=a.length())?a.last().endTime:0;if(a.B(c)){c=a.length();var e=!1;VideoPlayerShakaGlobalConfig.getBool("robust_count_changes",!1)&&(e=!!c&&a.last().endTime>d);a.g.push(b!==c||e);50<a.g.length&&a.g.shift()}};function X(){this.a=this.b=null;this.f=new bb;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}q("shaka.media.SimpleAbrManager",X);X.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};X.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
X.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,E(this.f,this.b.getEstimator(),"bandwidth",this.m.bind(this)),E(this.f,this.a,"adaptation",this.j.bind(this)),E(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};X.prototype.enable=function(a){this.i=a};X.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=Cf(this);return a?a.id:null};X.prototype.getInitialSwitchReason=function(){return null};X.prototype.getInitialAudioTrackId=function(){return null};
X.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};X.prototype.m=function(){Date.now()<this.c||this.h()};X.prototype.h=function(){if(this.i){var a=Cf(this);if(a){if(a.active){this.c=Date.now()+3E3;return}this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};X.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function Cf(a){var b=a.a.Z();if(0==b.length)return null;b.sort(va);var c;a:{c=a.a.va();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],g=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth&&(g=(g.bandwidth+c)/.85,a>=(f.bandwidth+c)/.95&&a<=g&&(d=f,d.active)))break}return d};function Y(a,b,c,d){F.call(this,null);this.b=a;this.a=b;this.wa=c;this.kb=new VideoPlayerLocalBandwidthEstimator(this,c,b);this.i=new bb;this.h=new MediaSource;this.ba=this.video=null;this.Cb=0;this.nc=this.$b=!1;this.Mb=ia;this.Bb=this.V=this.ia=this.l=null;this.Lb=3;this.ra=this.ac=this.Fa=this.Ea=!1;this.Pa=0;this.da=new VideoPushTracker;this.ga=null;this.jc=1;this.hc=Infinity;this.Vb=this.Tb=!1;this.pa=this.Oa=null;this.Xb=this.Wb=this.Ga=this.dc=this.ma=!1;this.f=new D;this.A=d;this.A.initialize(this.kb,
this);this.O=!1;this.S="en";this.ya=!1;this.J=new I;this.Jb=new I;this.m=new ka;this.D=null;this.kc=1;this.c={};this.sa=new I;this.ja=0;this.Ra=15E3;this.j=null;this.fc=!1;this.ec=0;this.Ca=!1;this.B={};this.la=this.ka=this.u=null;this.g={};this.$=!1;this.gc=0;this.K=this.a.getNumber("buffering_overflow_threshold",0);this.pc=null;this.o={};this.w={};this.R=null;this.U=[];this.T=this.I=null;this.G=new NetworkStatusDetector;this.ic=!1;this.na=!0;this.ea=!1;this.uc=new SubscriptionsHandler;this.Zb=!1;
this.xa=1;this.Id=this.a.getNumber("stream_maximum_onpause_buffer_size_multiplier",0);this.ca=null;this.a.getBool("allow_infinite_retry_on_net_err",!0)&&this.uc.addSubscriptions(this.G.addListener("networkInterrupted",this.Tc,this),this.G.addListener("networkResumed",this.Uc,this),this.G.addListener("systemWake",this.Vc,this))}r(Y,F);q("shaka.player.StreamVideoSource",Y);Y.prototype.Yb=function(){return{VideoSourceStream:this.c.video,AudioSourceStream:this.c.audio,TextSourceStream:this.c.text,BandwidthEstimator:this.wa}};
Y.prototype.getStreamDebug=Y.prototype.Yb;Y.prototype.Pc=function(){return this.b?this.b.w:"none"};Y.prototype.getMpdAudioConfig=Y.prototype.Pc;
Y.prototype.lc=function(a){null!=a.streamBufferSize&&(this.g.streamBufferSize=a.streamBufferSize);null!=a.initialStreamBufferSize&&(this.g.initialStreamBufferSize=a.initialStreamBufferSize);null!=a.dynamicStreamBufferSize&&(this.g.dynamicStreamBufferSize=a.dynamicStreamBufferSize);null!=a.smartBufferAdjustmentParams&&(this.g.smartBufferAdjustmentParams=a.smartBufferAdjustmentParams);null!=a.addCdnDebugQueryParameters&&(this.g.addCdnDebugQueryParameters=a.addCdnDebugQueryParameters);null!=a.segmentRequestTimeout&&
(this.g.segmentRequestTimeout=a.segmentRequestTimeout);null!=a.resolveVideoTimeUpdateOnFragmentedTimeRanges&&(this.g.resolveVideoTimeUpdateOnFragmentedTimeRanges=a.resolveVideoTimeUpdateOnFragmentedTimeRanges);null!=a.reappendInitSegmentAfterAbort&&(this.g.reappendInitSegmentAfterAbort=a.reappendInitSegmentAfterAbort);null!=a.liveDataFetchMaxRetries&&(this.g.liveDataFetchMaxRetries=a.liveDataFetchMaxRetries);null!=a.liveSourceBufferClearMaxRetries&&(this.g.liveSourceBufferClearMaxRetries=a.liveSourceBufferClearMaxRetries);
null!=a.playheadFragmentedGapDiffAllowance&&(this.g.playheadFragmentedGapDiffAllowance=a.playheadFragmentedGapDiffAllowance);null!=a.fixBufferingGoalDetermination&&(this.g.fixBufferingGoalDetermination=a.fixBufferingGoalDetermination);null!=a.skipEmptySegments&&(this.g.skipEmptySegments=a.skipEmptySegments);null!=a.useMicroTaskTimeouts&&(this.g.useMicroTaskTimeouts=a.useMicroTaskTimeouts);Df(this);null!=a.includeStreamBufferSizeInStartOffset&&(this.$b=Boolean(a.includeStreamBufferSizeInStartOffset));
null!=a.liveAudioPushRepresentation&&(this.pa=String(a.liveAudioPushRepresentation));null!=a.liveInitialPushRepresentation&&(this.Oa=String(a.liveInitialPushRepresentation));null!=a.enableAdaptation&&this.A.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.Mb=Number(a.mpdRequestTimeout));null!=a.minMpdRefreshInterval&&(this.Lb=Number(a.minMpdRefreshInterval)/1E3);null!=a.enableManifestDebug&&(this.Vb=!!a.enableManifestDebug);null!=a.liveStreamEndTimeout&&(this.Ra=Number(a.liveStreamEndTimeout));
null!=a.preferredLanguage&&(this.S=Sa(String(a.preferredLanguage)));null!=a.liveSendPushHeaders&&(this.ra=Boolean(a.liveSendPushHeaders));null!=a.liveMaxManifestFetchesWithPush&&(this.Pa=Number(a.liveMaxManifestFetchesWithPush));null!=a.currentTimeDuringReadyStateZeroThrows&&(this.Tb=Boolean(a.currentTimeDuringReadyStateZeroThrows));null!=a.liveMaxSegmentsToPush&&(this.hc=Number(a.liveMaxSegmentsToPush));null!=a.jumpToLiveThreshold&&(this.ec=Number(a.jumpToLiveThreshold));null!=a.restrictions&&(this.m=
a.restrictions,this.O&&Ef(this));null!=a.useLongCacheForManifest&&(this.ma=Boolean(a.useLongCacheForManifest));null!=a.jumpToEarliestPositionInCurrentBlock&&(this.dc=Boolean(a.jumpToEarliestPositionInCurrentBlock));null!=a.ignoreMinBufferTime&&(this.Ga=Boolean(a.ignoreMinBufferTime));null!==a.enableRequestPipelining&&(this.Wb=Boolean(a.enableRequestPipelining));null!==a.enableStreaming&&(this.Xb=Boolean(a.enableStreaming))};
Y.prototype.destroy=function(){this.J.destroy();this.sa.destroy();this.sa=this.J=null;this.ka&&(clearTimeout(this.ka),this.ka=null);this.u&&(clearTimeout(this.u),this.u=null);this.B=null;this.i.destroy();this.i=null;Wa(this.c).forEach(function(a){a.destroy()});this.f=this.c=null;this.b&&(this.b.destroy(),this.b=null);this.A.destroy();this.Ja=this.m=this.video=this.h=this.wa=this.A=null;this.a.getBool("fixing_scheduler_disable_leaks",!0)&&(Object.keys(this.o).forEach(function(a){(a=this.o[a])&&a.disable()}.bind(this)),
this.o={});Object.keys(this.w).forEach(function(a){(a=this.w[a])&&a.destroy()}.bind(this));this.w={};this.I&&(this.I.disable(),this.I=null);this.R&&(this.R.cleanup(),this.R=null);for(var a=0;a<this.U.length;a++)this.U[a].cleanup();this.U=[];this.uc.release()};function ef(a,b){if(a.l){var c=a.l.getOperationLogger("media_source_open").start();a.Jb.then(function(){c.log()})}E(a.i,a.h,"sourceopen",a.hd.bind(a));b.src=window.URL.createObjectURL(a.h)}n=Y.prototype;n.vc=function(){};
function jf(a,b,c){var d;a.l&&(d=a.l.getOperationLogger("source_attach").start());if(!a.O)return a=Error("Cannot call attach() right now."),a.type="app",d&&d.setError(a).log(),Promise.reject(a);a.Ja=b;a.video=c;a.ba=null;a.a.getBool("enable_viewport_priority_adjustment",!1)&&(a.R=new ViewportPriorityAdjuster(a.video),a.R.setOnPriorityChanged(function(a){Object.keys(this.o).forEach(function(b){this.o[b].updatePriorityWithNewAdjustment(a)}.bind(this))}.bind(a)));a.a.getBool("enable_first_video_priority_adjustment",
!1)&&a.U.push(new FirstLoadedVideoPriorityAdjuster(a.video));E(a.i,a.video,"loadedmetadata",a.gd.bind(a));E(a.i,a.wa,"bandwidth",a.Gd.bind(a));if(a.b.b||a.a.getBool("back_off_buffering_overflow",!1))E(a.i,b,"bufferingStart",a.cd.bind(a)),E(a.i,b,"bufferingEnd",a.bd.bind(a));b=a.a.getBool("enable_content_protection",!1)?(b=a.video.mediaKeys)&&a.video.setMediaKeys?a.video.setMediaKeys(b):Promise.resolve():Promise.resolve();Ff(a).then(J(a,function(){d&&this.P()&&d.setLiveheadPosition(Gf(Hf(this)));this.J&&
this.J.resolve();this.vc()})).catch(J(a,function(a){this.J&&this.J.reject(a)}));return Promise.all([a.J,b]).then(function(){d&&d.log()})}
n.wb=function(){if(this.O){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.b||0==this.b.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);tf(this.b.a);if(0==this.b.a.length||0==this.b.a[0].a.length||!this.b.a[0].a.some(function(a){return"video"===a.contentType}))return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.O=
!0;this.Ga||(this.g.initialStreamBufferSize=Math.max(this.g.initialStreamBufferSize||0,this.b.g));this.ia&&this.ia.setStreamType(this.b.B);Df(this);Ef(this);return Promise.resolve()};function If(a){var b=y({type:"manifestwrapped",bubbles:!0});a.dispatchEvent(b)}function Jf(a,b){var c=y({type:"liveheadIdleAt",seconds:b,bubbles:!0});a.dispatchEvent(c)}function Gf(a){return Math.min.apply(Math,a.map(function(a){return a.length()?a.last().endTime:null}).filter(function(a){return!!a}))}
n.Kb=function(a,b){var c;this.a.getBool("decouple_mpd_update_loop_from_request_loop",!1)&&Kf(this,0);this.V&&(this.V.log(),this.V=null);this.l&&(c=this.l.getOperationLogger("update_manifest").start());if(!b||this.O){var d=Date.now();this.a.getBool("decouple_mpd_update_loop_from_request_loop",!1)||(this.u=null);var e=null,f,g;if(this.ra&&(!this.Pa||this.Pa>this.jc)){f=Math.floor(Lf(this))+1;f=Math.min(f,this.hc);var h=this.c.video;if(h=h?h.Gb():null)h=h.last(),null!=h.unscaledStartTime&&(g=h.unscaledStartTime);
if(this.video.paused||this.$)f=0}f&&this.jc++;h=this.b.i;h=this.a.getBool("enable_clean_failover_uri_on_mpd_requests",!0)?h.clone():h;c&&!a&&c.setResource(h.toString());(a?this.xc():this.yc(h,f,g)).then(J(this,function(b){a||this.G.informNetworkResumed();e=new vf(b);var c;this.l&&(c=this.l.getOperationLogger("update_manifest_info").start());b=e.update(this.b);b.then(function(){c&&c.log()},function(a){c&&c.setError(a).log()}).catch(function(){});return b})).then(J(this,function(a){e.destroy();e=null;
var f=Hf(this);this.La("SegmentIndexesUpdated",f);if(this.a.getBool("emit_live_playhead_idle_from_client",!0)){var g=this.a.getNumber("live_playhead_idle_all_stream_threshold",4),h=this.a.getNumber("live_playhead_idle_single_stream_threshold",5);if(Hf(this).every(function(a){return a.u()>=g})||Hf(this).some(function(a){return a.u()>=h})){var t=Gf(f);Jf(this,t)}}f.some(function(a){return a.rb()})&&If(this);t=Mf(this,f);c&&this.P()&&c.setLiveheadPosition(Gf(f));c&&c.setManifestType(this.b.b?"dynamic":
"static").setUpdatePeriod(null===this.b.c?null:Math.ceil(1E3*this.b.c));this.na&&Nf(this,t);this.a.getBool("skip_remaining_buffered_on_stream_end",!1)&&t&&this.b.b&&this.b.h&&this.video.paused&&(this.video.currentTime=this.ja-.1);if(sf(this))return c&&c.log(),this.fb();for(f=0;f<a.length;++f)Of(this,a[f]);this.Ga||(this.g.initialStreamBufferSize=Math.max(this.g.initialStreamBufferSize||0,this.b.g));this.g.useInitialBufferSizeWhenPaused=this.b.b;Df(this);Ef(this);0==Object.keys(this.c).length?Ff(this):
(a=Date.now(),b||Kf(this,(a-d)/1E3));c&&c.log();this.tb()&&extractCEA608.prepare();this.a.getBool("update_cea608_availability_on_mpd_parsing",!1)&&(a=this.tb(),this.Zb!==a&&(f=y({type:"cea608AvailabilityChanged",bubbles:!0}),this.dispatchEvent(f),this.Zb=a))})).catch(J(this,function(a){c&&c.setError(a).log();e&&(e.destroy(),e=null);if(!b){var d=this.b.f||this.a.getBool("retry_egress_500s",!1),f=[0,410];this.a.getBool("enable_double_ingest",!1)&&f.push(417,200);!this.a.getBool("no_retry_on_502_503",
!1)&&d&&(f=f.concat([502,503]));d=this.a.getBool("fix_live_stream_gone_on_manifest_update",!0)?-1===f.indexOf(a.status):0!==a.status;if(this.a.getBool("allow_infinite_retry_on_net_err",!0)&&"net"===a.type&&!d)switch(a.status){case 410:this.ic=!0;this.j&&(clearTimeout(this.j),this.j=null);this.fb();break;case 200:case 417:a.responseHeaders&&null!=a.responseHeaders["x-fb-video-replica"]?this.dispatchEvent(y({type:"replicaswitch",bubbles:!0,replica:a.responseHeaders["x-fb-video-replica"],url:a.url,status:a.status})):
d=!0;break;default:Pf(this)}0===a.status?this.G.informNetworkInterrupted():this.G.informNetworkResumed();if("delay"==a.type)return Pf(this);this.a.getBool("allow_infinite_retry_on_net_err",!0)&&!d||"aborted"==a.type||(a=A(a),this.dispatchEvent(a),this.b&&Pf(this))}}))}};n.yc=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};n.xc=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};
function Nf(a,b){if(b&&a.b&&a.b.b)if(a.a.getBool("seek_over_unavailable_segments_on_manifest_update",!1)&&a.ea)b.end>a.video.currentTime+10&&(a.ea=!1,a.video.currentTime=b.end,Qf(a));else if(a.video.paused&&b.end>a.video.currentTime+10)if(a.a.getBool("enable_lazy_livehead_catchup",!1)){var c=a.xa;c<a.Id&&(a.xa=++c);Rf(a,c);a.ca=b.end}else a.ea=!1,a.video.currentTime=b.end,Qf(a)}
function Kf(a,b){if(null==a.b.c)BanzaiODS.bumpEntityKey(2966,"videos.www.live","update_period_is_null");else if(!a.Fa){if(a.a.getBool("decouple_mpd_update_loop_from_request_loop",!1)&&(a.u&&(clearTimeout(a.u),a.u=null),sf(a)))return;var c=Math.max(a.b.c,a.Lb),c=Math.max(c-b,0),d=a.Kb.bind(a,!1);!c&&a.g.useMicroTaskTimeouts?Promise.resolve().then(d):(a.V&&a.V.setResult("failed").log(),a.l&&(a.V=a.l.getOperationLogger("schedule_manifest_update").start().setUpdatePeriod(Math.ceil(1E3*c))),a.u=setTimeout(d,
1E3*c))}}function Of(a,b){var c=Md(b),d=a.c[c];if(d&&d.Ya()==b){var e=a.f.get(Md(b)).map(function(a){return a.v}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return a.oa&&a.fa});if(0==e.length){c=Error("All usable streams have been removed from the manifest.");c.type="app";c=A(c);a.dispatchEvent(c);return}a.B[c].Lc==b&&delete a.B[c];d.jb(e[0],!0);b.destroy()}b.destroy()}n.Cd=function(a){this.pc=a};Y.prototype.setTaggedTimeRanges=Y.prototype.Cd;
Y.prototype.wd=function(){return 0===Object.keys(this.c).length?!1:["audio","video"].every(J(this,function(a){return!this.c[a]||this.c[a].T}))};Y.prototype.hasHitBufferingGoal=Y.prototype.wd;
Y.prototype.Z=function(a){if(!this.f||!this.f.a.hasOwnProperty("video"))return[];a=a&&a.useLocalBitrate||!1;var b=this.c.video,c=b?b.Ya():null,d=c?c.X:0,e=1,f=null;this.a.getBool("use_live_bitrate_estimates",!1)&&this.P()&&null!=b&&(f=b.la(),null!=c&&0<c.bandwidth&&(e=f/c.bandwidth));for(var c=[],g=this.f.get("video"),h=0;h<g.length;++h)for(var k=g[h],l=0;l<k.v.length;++l){var m=k.v[l];if(m.oa&&m.fa){var p=null;if(a&&null!==m.M){var t=m.M.c(),w=b;if(this.P()||null===t||null===w)p=null;else{var p=
pe(w,this.video.currentTime,t),z=t.getSegments();this.a.getBool("start_local_bitrate_at_buffer_end",!1)&&(w=LocalBitrateHelper.getBufferEndSegmentIndex(z,p,this.video.currentTime+ae(w,this.video.currentTime)),null!==w&&(p=w));p=LocalBitrateHelper.getLocalBitrate(t.getSegments(),p,this.a.getNumber("local_bitrate_segments_ahead",10))}this.a.getBool("use_max_local_bitrate",!1)&&(p=Math.max(p,m.bandwidth))}t=m.X;p=p||m.bandwidth;this.a.getBool("use_live_bitrate_estimates",!1)&&null!=f&&(t===d?p=Math.max(p,
f):1<e&&(p=p*e),p=Math.round(p));m=new ua(t,p,m.width,m.height,m.id,m.fbQualityLabel,m.fbQualityClass,m.f,m.frameRate,m.mimeType,m.codecs,m.g,m.h);t==d&&(m.active=!0);c.push(m)}}return c};Y.prototype.getVideoTracks=Y.prototype.Z;Y.prototype.Rc=function(){if(this.ga)return this.ga;if(!this.b)return null;for(var a=0;a<this.b.a.length;++a)for(var b=this.b.a[a],c=0;c<b.a.length;++c)if(this.ga=b.a[c].c)return this.ga;return null};Y.prototype.getVideoProjection=Y.prototype.Rc;Y.prototype.Oc=function(){return this.kb};
Y.prototype.getLocalEstimator=Y.prototype.Oc;function Sf(a){a=a.Z();for(var b=0;b<a.length;b++)if(a[b].active)return a[b]}Y.prototype.va=function(){if(!this.f||!this.f.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.Ya():null)?a.X:0,b=[],c=this.f.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,g=0;g<e.v.length;++g){var h=e.v[g];if(h.oa&&h.fa){var k=h.X,h=new fa(k,h.bandwidth,f,h.id,h.mimeType,h.codecs,this.b.u,h.c);k==a&&(h.active=!0);b.push(h)}}return b};
Y.prototype.getAudioTracks=Y.prototype.va;Y.prototype.mc=function(){if(!this.f||!this.f.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.Ya():null,b=b?b.X:0,c=[],d=this.f.get("text"),e=0;e<d.length;++e)for(var f=d[e],g=f.lang,h=0;h<f.v.length;++h){var k=f.v[h].X,l=new ta(k,g);k==b&&(l.active=!0,l.enabled=a.Eb());c.push(l)}return c};Y.prototype.getTextTracks=Y.prototype.mc;Y.prototype.bc=function(){return this.b&&this.b.m&&0<this.b.m?!0:!1};Y.prototype.isUsingASRCaptions=Y.prototype.bc;
Y.prototype.cc=function(){return this.b&&this.b.o&&0<this.b.o&&gkx("1176251")?!0:!1};Y.prototype.isUsingASRCaptionsEmployeeDogfooding=Y.prototype.cc;function rf(a){var b=Number(a.g.initialStreamBufferSize);a.g.fixBufferingGoalDetermination&&(b=1);if(a.a.getBool("back_off_buffering_overflow",!1))b=a.K;else{var c=a.a.getNumber("buffering_overflow_threshold",0);0<c&&(b=c)}return a.ac?Number(a.g.streamBufferSize):b}
function Ne(a){if(a.O){a=a.b.a[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,Qd(a.a[c]));a=b}else a=[];return a}
function Pe(a,b){if(a.O){for(var c={},d=a.b.a[0],e=0;e<d.a.length;++e){var f=d.a[e];c[f.X]=f}a.f.a={};d=ab(b);for(e=0;e<d.length;++e){var f=d[e],g=b.get(f);if("video"==f){var h=g[0].id;a.f.push(f,c[h])}else if("audio"==f){if(0<g.length)for(var h=g[0].b.split(";")[0],k=0;k<g.length;++k){var l=g[k];l.b.split(";")[0]==h&&a.f.push(f,c[l.id])}}else for(k=0;k<g.length;++k)h=g[k].id,a.f.push(f,c[h])}a.ya=!0;if(c=a.f.get("audio"))Tf(a,c),a.f.set("audio",c),c=c[0].lang||a.S,Ra(2,a.S,c)&&(a.ya=!1);if(c=a.f.get("text"))Tf(a,
c),a.f.set("text",c),c=c[0].lang||a.S,Ra(2,a.S,c)||(a.ya=!1)}}Y.prototype.Xc=function(){this.Ea=!0};Y.prototype.setClearBufferAfterSeeking=Y.prototype.Xc;Y.prototype.selectVideoTrack=function(a,b,c,d,e){return mf(this,"video",a,b,c,d,e)};Y.prototype.resumeVideoFetching=function(){var a=this.c.video?this.c.video.F:null;a&&a.resumeVideoFetching()};Y.prototype.resumeVideoFetching=Y.prototype.resumeVideoFetching;Y.prototype.Hd=function(){var a=this.c.video?this.c.video.F:null;a&&a.stopUntilSegmentsUpdate()};
Y.prototype.stopUntilVideoStreamSwitch=Y.prototype.Hd;function nf(a,b){var c=a.c.text;c&&c.vb(b)}
function Ef(a){if(a.m){for(var b=!1,c=0;c<a.b.a.length;++c)for(var d=a.b.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var g=0;g<f.v.length;++g){var h=f.v[g],k=h.fa;h.fa=!0;a.m.maxWidth&&h.width>a.m.maxWidth&&(h.fa=!1);a.m.maxHeight&&h.height>a.m.maxHeight&&(h.fa=!1);a.m.minHeight&&h.height<a.m.minHeight&&(h.fa=!1);a.m.maxBandwidth&&h.bandwidth>a.m.maxBandwidth&&(h.fa=!1);a.m.minBandwidth&&h.bandwidth<a.m.minBandwidth&&(h.fa=!1);k!=h.fa&&(b=!0)}}0!=$a(a.f).length&&b&&(Uf(a),
0<a.Z().length||(b=Error("The application has restricted all video tracks!"),b.type="app",b=A(b),a.dispatchEvent(b)))}}Y.prototype.P=function(){return this.b?this.b.b:null};Y.prototype.isLive=Y.prototype.P;Y.prototype.Yc=function(a){this.ac=a};Y.prototype.setIsLiveInterrupted=Y.prototype.Yc;Y.prototype.vd=function(){for(var a in this.c)this.c[a].Hc()};Y.prototype.forceResyncVideoBuffer=Y.prototype.vd;
function We(a,b){for(var c,d=!1,e=new D,f=$a(a.f),g=0;g<f.length;++g)for(var h=f[g],k=0;k<h.v.length;++k){var l=h.v[k];l.b.forEach(function(a){e.push(a,l)})}for(c in b)if(f=Pa[b[c]]||null,h=e.get(c))for(g=0;g<h.length;++g)l=h[g],k=l.oa,l.oa=!f,k!=l.oa&&(d=!0);else ib(c);d&&(Uf(a),d=a.va(),c=a.Z(),d=a.f.a.hasOwnProperty("audio")&&0==d.length,c=a.f.a.hasOwnProperty("video")&&0==c.length,d||c)&&(c=Error("The key system has restricted all "+(d&&c?"audio and video tracks.":d?"audio tracks.":"video tracks.")),
c.type="drm",c=A(c),a.dispatchEvent(c))}function Uf(a){var b=y({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}function mf(a,b,c,d,e,f,g){g=!!g;if(!a.f.a.hasOwnProperty(b)||!a.c[b])return!1;for(var h=a.f.get(b),k=0;k<h.length;++k)for(var l=h[k],m=0;m<l.v.length;++m){var p=l.v[m];if(p.X==c){if(!p.oa||!p.fa)return!1;if("text"!=b&&!a.Ca)return c=a.B[b],a.B[b]={Lc:p,rc:null!=c&&c.rc||d,sc:null!=c&&c.sc||e,switchReason:f,Ka:g},!0;a.c[b].jb(p,d,e,f,g);return!0}}return!1}
function Tf(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(Ra(c,a.S,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.f){b.splice(d,1);b.splice(0,0,e);break}}n=Y.prototype;n.hd=function(){this.i.Va(this.h,"sourceopen");this.Jb.resolve()};
function Ff(a){var b;a.l&&(b=a.l.getOperationLogger("start_streams").start());for(var c=[],d=["audio","video","text"],e=0;e<d.length;++e){var f=d[e];a.f.a.hasOwnProperty(f)&&c.push(a.f.get(f)[0])}for(var g=Vf(a,c),e=0;e<d.length;++e)if(f=d[e],a.f.a.hasOwnProperty(f)&&!g[f])return a=Error("Unable to select an initial "+f+" stream: all "+f+" streams have been restricted (by the application or by the key system)."),a.type="stream",b&&b.setError(a).log(),Promise.reject(a);c=Wa(g).map(function(a){return a.M.create()});
c.push(a.Jb);return Promise.all(c).then(J(a,function(a){a.pop();if(!a.every(function(a){return a.length()}))return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=Mf(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!Wf(this,g))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.A.start();Xf(this,g,a);return Promise.resolve()})).then(function(){b&&b.log()}).catch(J(a,function(a){if("aborted"==
a.type)b&&b.setError(a).log();else{Object.keys(this.c);if(this.b.b)return ya()<this.b.j?(a=Math.max(this.b.j-Date.now()/1E3,this.Lb),this.u=setTimeout(this.Kb.bind(this,!0),1E3*a)):Kf(this,0),b&&b.log(),Promise.resolve();b&&b.setError(a).log();return Promise.reject(a)}}))}
function Vf(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var g=a.A.getInitialVideoTrackId();if(null==g)continue;f=e.v.filter(function(a){return a.X==g});if(0==f.length)continue;f=f[0]}else if("audio"==e.contentType)if(g=a.A.getInitialAudioTrackId(),f=e.v.filter(function(a){return a.X==g}),0==f.length){f=e.v.filter(function(a){return a.oa&&a.fa});if(0==f.length)continue;f=e.v[Math.floor(f.length/2)]}else f=f[0];else 0<e.v.length&&(f=e.v[0]);c[e.contentType]=f}return c}
function Wf(a,b){var c={},d;for(d in b){var e=b[d],e="text"==d?new te(a,a.video):Yf(a,e);if(!e)return Wa(c).forEach(function(a){a.destroy()}),!1;c[d]=e}a.Qb(a.nc);a.c=c;return!0}
function Yf(a,b){var c=Nd(b),d=Zf(c.split(";")[0]),e=null,f=a.a.getBool("use_local_estimator_for_abr_sampling",!0)?a.kb:a.wa,g=null,h=null,k=a.b.f||a.b.A,k=a.a.getBool("skip_segment_request_manager",!1)&&k;a.Xb&&canUseFetchStream()?(h=new MultipleSegmentsProvider(a.a.getNumber("streaming_segment_size",4)),g=$f(a,h,d,f)):a.Wb&&!k&&(e=ag(a,d,f));var k=null,l=a.f.get(d);"video"===d&&0<l.length&&(k=function(a,b){for(var c=null,d=null,e=0;e<l[0].v.length;e++)l[0].v[e].id===a?c=l[0].v[e]:l[0].v[e].id===
b&&(d=l[0].v[e]);return null===c||null===d?0:c.bandwidth>d.bandwidth?1:-1});c=new U(a,a.video,a.a,a.h,c,f,a.pc,a.da,k,a.G,e,g,h,a.ia);c.pa(a.g);return c}
function $f(a,b,c,d){var e=a.w[c],f="audio"!==c||a.a.getBool("enable_audio_streaming",!1);if(!e&&f){var e=new VideoStreamingManager(a.a,b,c,a.l,a.U),g="video"===c;g&&e.addListener("bandwidthUpdate",function(a){d.sample(a.timeTaken,a.bytesRead,g,{timeToLastByte:a.timeTaken},this.Bb,this.l,!this.a.getBool("evaluate_abr_on_stream_bandwidth_sample",!0))}.bind(a))}e&&(a.w[c]=e);return e||null}
function ag(a,b,c){if("video"===b||"audio"===b&&a.a.getBool("enable_request_pipelining_for_vod_audios",!1)){var d=a.o[b];d||(d=new SegmentRequestManager(a.a,b,a.P()?VideoPriorityCalculator.calculateLive:VideoPriorityCalculator.calculate,a.l,c,a.Bb,a.da,a.ia),a.R&&d.updatePriorityWithNewAdjustment(a.R.getPriorityAdjustment()),a.o[b]=d);return d}return null}function bg(a,b){a.video.currentTime=b;a.a.getBool("set_pending_seek_on_set_current_time_failure",!1)&&a.video.currentTime+1<b&&cg(a,b);a.D=b}
function Xf(a,b,c){a.kc=a.video.playbackRate;a.video.playbackRate=0;dg(a,c);var d;d=a.b.f;(!a.a.getNumber("templated_adjust_stream_limits_start_offset_int",0)&&!a.a.getNumber("templated_jump_to_live_sidx_end_offset",0)||!d)&&a.la&&a.la<=c.end&&a.la>=c.start?d=a.la:a.b.b?(d=eg(a,c),a.fc=!0):d=c.start;E(a.i,a.video,"seeking",a.md.bind(a));a.I?(a.I.setOnPlaying(a.mb.bind(a,!0)),a.I.setOnPaused(a.mb.bind(a,!1)),a.I.enable()):(E(a.i,a.video,"playing",a.mb.bind(a,!0)),a.a.getBool("update_priority_on_play_event",
!0)&&E(a.i,a.video,"play",a.mb.bind(a,!0)),E(a.i,a.video,"pause",a.mb.bind(a,!1)));E(a.i,a.video,"seeking",a.Mc.bind(a));E(a.i,a.video,"timeupdate",throttle(a.Mc.bind(a),a.a.getNumber("scheduler_priority_update_interval",1E3)));if(a.video.currentTime!=d)if(a.Tb)0!==a.video.readyState?bg(a,d):cg(a,d);else try{bg(a,d)}catch(e){cg(a,d)}fg(a,c.start,c.end,c.last,c.ab);var f=[],g;for(g in a.c){c=a.c[g];J(a,function(a){f.push(a.Kc(this.sa).then(J(this,function(b){var c=a.sb();c>this.Cb&&(this.Cb=c);return b})))})(c);
E(a.i,c,"ended",a.od.bind(a));E(a.i,c,"should_end_all_streams",a.pd.bind(a));E(a.i,c,"should_nudge",a.jd.bind(a));d=b[g];var h=a.A.getInitialSwitchReason()||void 0;c.jb(d,!1,void 0,h)}Promise.all(f).then(J(a,function(a){this.a.getBool("prevent_stream_start_if_streams_change",!1)&&!gg(this)||hg(this,a)})).catch(J(a,function(a){"destroy"!=a.type&&(a=A(a),this.dispatchEvent(a))}));nf(a,a.ya)}
n.mb=function(a){Object.keys(this.o).forEach(function(b){this.o[b].updatePriorityWithNewPlayingState(a)}.bind(this));Object.keys(this.w).forEach(function(b){this.w[b].getPriorityUpdater().updatePriorityWithNewPlayingState(a)}.bind(this));if(this.l){var b=Mf(this,Hf(this));b&&this.video.currentTime<b.start&&BanzaiODS.bumpEntityKey(2966,"videos.www.shaka","current_time_at_playing_less_than_stream_limits_start")}a&&null!==this.ca&&(this.xa=1,Rf(this,this.xa),ig(this))};
n.Mc=function(){this.video&&(Object.keys(this.o).forEach(function(a){this.o[a].updatePriorityWithNewPlayhead(this.video.currentTime)}.bind(this)),Object.keys(this.w).forEach(function(a){this.w[a].getPriorityUpdater().updatePriorityWithNewPlayhead(this.video.currentTime)}.bind(this)))};function Qf(a){if(a.a.getBool("clear_current_segment_indexes_during_livehead_catchup",!1))for(var b in a.c)a.c[b].i=null}function cg(a,b){a.ba=b;for(var c in a.c){var d=a.c[c];a.ba&&(d.J=a.ba)}}
function gg(a){return!Object.keys(a.c).some(J(a,function(a){return this.c[a]&&!this.c[a].h}))}
function hg(a,b){ba(b&&b.length==Object.keys(a.c).length);for(var c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,e=0;e<b.length;++e)var f=b[e],c=Math.min(c,f),d=Math.max(d,f);c=Hf(a);for(e=0;e<c.length;++e)c[e].Ua(d);a.a.getBool("process_deferred_switches_early",!1)&&jg(a);kg(a,c,d);var g=Wa(a.c).map(function(a){return a.Ya().id});a.a.getBool("sequentially_load_streams",!1)?lg(a,g,d):(e=$a(a.f).map(function(a){return a.v}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return!~g.indexOf(a.id)}).map(J(a,
function(a){var b=[a.M.pb?a.M.pb():a.M.create()];a.aa&&b.push(a.aa.create(this.l,this.da));return Promise.all(b)})),Promise.all(e).then(J(a,function(a){for(var b=0;b<a.length;++b)a[b][0].Ua(d);this.Ca=!0;jg(this)})).catch(J(a,function(a){"aborted"!=a.type&&(a=A(a),this.dispatchEvent(a))})))}
function lg(a,b,c){var d=Promise.resolve();$a(a.f).map(function(a){return a.v}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return!~b.indexOf(a.id)}).forEach(function(a){d=d.then(J(this,function(b){b&&b[0].Ua(c);b=[a.M.pb?a.M.pb():a.M.create()];a.aa&&b.push(a.aa.create(this.l,this.da));return Promise.all(b)})).catch(function(a){throw a;})});d.then(J(a,function(){this.Ca=!0;jg(this)})).catch(J(a,function(a){"aborted"!=a.type&&(a=A(a),this.dispatchEvent(a))}))}
function jg(a){for(var b in a.B){var c=a.B[b];a.c[b].jb(c.Lc,c.rc,c.sc,c.switchReason,c.Ka)}a.B={}}
function kg(a,b,c){var d;a.a.getBool("www_videos_extended_spl_logging_for_connected_tv",!1)&&a.l&&(d=a.l.getOperationLogger("stream_video_source_begin_playback"));if(b=Mf(a,b))dg(a,b),fg(a,b.start,b.end,b.last,b.ab);0!=c?(c=a.video.currentTime+c,a.a.getNumber("www_videos_nudge_timestamp_correction_s",0)&&(c+=a.a.getNumber("www_videos_nudge_timestamp_correction_s",0)),a.video.currentTime=c,a.D=c):a.fc&&b&&(c=eg(a,b),Math.abs(c-a.video.currentTime)>=a.ec&&(a.video.currentTime=c));a.a.getBool("unify_stream_start_with_buffer_detector",
!1)?(c=y({type:"allStreamsStarted",bubbles:!0}),a.dispatchEvent(c)):a.video.playbackRate=a.kc;a.b.b&&null!=a.b.c&&Kf(a,0);mg(a);a.sa.resolve();d&&d.log()}
function eg(a,b){var c=b.end;void 0!==b.Bc&&(c=b.Bc);if(a.a.getBool("templated_always_jump_to_stream_limits_end",!1)&&a.b&&a.b.f)return b.end;if(a.dc){var d=a.video.currentTime,e=b.start;if(a.a.getNumber("templated_adjust_stream_limits_start_offset_int",0)&&a.b&&a.b.f){for(var f=Hf(a),g=0,h=0;h<f.length;++h){var k=f[h],l=Math.min(a.a.getNumber("templated_adjust_stream_limits_start_offset_int",0),k.length());k.length()&&0<l&&l<=k.length()&&(g=Math.max(k.get(k.length()-l).startTime,g))}e=Math.max(e,
g)}if(d>=e&&d<=b.end&&d<c)if(a.a.getNumber("templated_jump_to_live_sidx_end_offset",0)&&a.b&&a.b.f){f=Hf(a);k=null;e=Number.POSITIVE_INFINITY;for(h=0;h<f.length;++h)f[h].length()<e&&(e=f[h].length(),k=f[h]);k&&e>a.a.getNumber("templated_jump_to_live_sidx_end_offset",0)&&(f=k.get(k.length()-a.a.getNumber("templated_jump_to_live_sidx_end_offset",0)).startTime,d>=f&&(c=d))}else c=d}return c}
function dg(a,b){if(a.b.b)isNaN(a.h.duration)&&(a.h.duration=b.end+2592E3);else if(isNaN(a.h.duration)||b.end>a.h.duration)if(a.h.duration=b.end,!a.a.getBool("disable_append_window_end",!1))for(var c=a.a.getNumber("append_window_end_fudge_factor",0),d=0;d<a.h.sourceBuffers.length;++d)a.h.sourceBuffers[d].appendWindowEnd=b.end+c}
n.rd=function(){this.ka=null;mg(this);var a=Mf(this,Hf(this));if(a){var b=this.b.b;this.a.getBool("treat_live_static_manifest_as_dynamic",!1)&&(b=b||this.b.h);b&&this.ja!=a.last&&(this.ja=a.last,null!=this.j&&(clearTimeout(this.j),this.j=null));fg(this,a.start,a.end,a.last,a.ab);this.video.paused||ng(this,this.video.currentTime,a.start,a.end)}};function fg(a,b,c,d,e){b=y({type:"seekrangechanged",bubbles:!0,start:b,end:c,last:d,seekRangeGaps:e});a.dispatchEvent(b)}
n.md=function(){var a=this.video.currentTime,b=Mf(this,Hf(this));this.l&&b&&a<b.start&&BanzaiODS.bumpEntityKey(2966,"videos.www.shaka","current_time_at_seek_less_than_stream_limits_start");if(null!=this.D){if(a>=this.D-.01&&a<=this.D+.01){this.D=null;this.l&&b&&a<b.start&&BanzaiODS.bumpEntityKey(2966,"videos.www.shaka","ignored_seek_when_current_time_at_seek_less_than_stream_limits_start");return}this.D=null}if(b){var c=b.start,d=b.end;this.a.getBool("skip_remaining_buffered_on_stream_end",!1)&&this.b.b&&
this.b.h&&this.video.paused&&(d=this.ja);(c=ng(this,a,c,d))||(a<=d+.01||this.b.b&&!og(this,d)?c=!1:(this.video.currentTime=d,c=!0));if(c)this.l&&a<b.start&&BanzaiODS.bumpEntityKey(2966,"videos.www.shaka","clamp_playhead_when_current_time_at_seek_less_than_stream_limits_start");else{for(var e in this.c)this.c[e].Cc(this.Ea);this.Ea=!1}}};function ng(a,b,c,d){if(b>=c-.01)return!1;b=0;a.b.b&&(b=.5,og(a,c+b)||(b=a.b.g));a.video.currentTime=Math.min(c+b,d);return!0}
function og(a,b){for(var c in a.c)if(!a.c[c].Ic(b))return!1;return!0}n.od=function(){if(!this.b.b||this.Fa){for(var a in this.c)if(!this.c[a].gb())return;this.fb()}};n.pd=function(){clearTimeout(this.u);this.Fa=!0;for(var a in this.c)this.c[a].gb()||this.c[a].Db()};n.jd=function(){this.a.getBool("ignore_seek_when_nudging",!0)&&(this.D=this.video.currentTime);this.video.currentTime+=.001};
n.tb=function(){if(this.bc()||this.cc())return!0;var a=this.b,b=null,c=null;a&&a.a&&a.a[0]&&(b=a.a[0]);b&&b.a&&b.a[0]&&(c=b.a[0]);return!!c&&c.b};Y.prototype.hasInlinedCea608Subtitles=Y.prototype.tb;Y.prototype.Qb=function(a){this.nc=a;var b=this.c;"video"in b&&(a=a&&this.tb(),b.video.c.S=a)};Y.prototype.setEnableCea608Parsing=Y.prototype.Qb;
function sf(a){var b=a.a.getNumber("live_buffering_underflow_threshold",.5),c=a.a.getBool("fix_live_stream_gone_on_manifest_update",!0)&&a.ic,d=!1;if(a.b.h){var d=a.a.getNumber("live_stream_end_slack",0),e;for(e in a.c)a.c[e].gb()||(d=0);d=a.video.currentTime+b+d>a.ja}return c||d}n=Y.prototype;
n.cd=function(){this.$=!0;if(this.b&&this.b.b){if(sf(this))return this.fb();this.a.getBool("allow_infinite_retry_on_net_err",!0)&&this.G.isNetworkInterrupted()||!Wa(this.c).every(function(a){return a.gb()})||pg(this,this.Ra)}this.a.getBool("back_off_buffering_overflow",!1)&&(null===this.K||Date.now()-this.gc>this.a.getNumber("back_off_buffering_overflow_time_window",2E3)?this.K=this.a.getNumber("buffering_overflow_threshold",0):this.K*=this.a.getNumber("back_off_buffering_overflow_time_factor",2),
this.K=Math.min(this.K,this.a.getNumber("back_off_buffering_overflow_max",5)))};function pg(a,b){a.j=setTimeout(a.fb.bind(a),b)}n.bd=function(){this.$=!1;this.a.getBool("back_off_buffering_overflow",!1)&&(this.gc=Date.now());null!=this.j&&(clearTimeout(this.j),this.j=null)};n.gd=function(){null!==this.ba&&(bg(this,this.ba),cg(this,null))};n.Gd=function(){};
n.fb=function(){this.$=!1;this.j=null;var a;if(a=this.a.getBool("test_source_buffers_not_updating_end_of_stream",!1))a:{if(this.h)for(a=0;a<this.h.sourceBuffers.length;++a)if(this.h.sourceBuffers[a].updating){a=!0;break a}a=!1}if(a)return pg(this,1E3);this.h&&"open"==this.h.readyState&&this.h.endOfStream()};function Hf(a){return Wa(a.c).map(function(a){return a.Gb()}).filter(function(a){return null!=a})}function Lf(a){return Math.max(a.b?a.b.g:1,a.$b?a.g.streamBufferSize||0:0)}
function Mf(a,b){for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=[],g=!VideoPlayerShakaGlobalConfig.getBool("no_seek_range_gaps_during_compute_stream_limits",!1),h=0;h<b.length;++h){var k=b[h].A();g&&(f=f.concat(b[h].getSeekRangeGaps()));c=Math.max(c,k.start);null!=k.end&&(d=Math.min(d,k.end));b[h].length()&&(e=Math.min(e,b[h].last().endTime))}g&&(f=mergeSeekRangeGaps(f));if(d==Number.POSITIVE_INFINITY)if(d=a.b.a[0],d.duration)d=(d.start||0)+d.duration;else return null;if(a.b.b){var g=
Lf(a),d=Math.max(d-g,c),l;a.ra&&a.a.getBool("live_jump_to_pushed_segment",!1)&&b.length&&(h=Math.floor(Lf(a)/1)+1,g=b[0],h=g.length()-h,(g=g.get(h))&&(l=g.startTime))}if(c>d)return null;d=Math.floor(1E5*d)/1E5;return{start:c,end:d,last:e,ab:f,Bc:l}}n.nb=function(){return Mf(this,Hf(this))};Y.prototype.computeStreamLimits=Y.prototype.nb;function mg(a){a.b.b&&(a.ka=setTimeout(a.rd.bind(a),1E3))}function Df(a){for(var b in a.c)a.c[b].pa(a.g)}Y.prototype.sb=function(){return this.Cb};
Y.prototype.getLongestInitResponseTime=Y.prototype.sb;function Zf(a){return"v"===a.charAt(0)?"video":"a"===a.charAt(0)?"audio":null}Y.prototype.Tc=function(){var a=y({type:"networkinterrupted",bubbles:!0});this.dispatchEvent(a);this.T=this.T||Date.now();this.$&&this.j&&clearTimeout(this.j)};
Y.prototype.Uc=function(){var a=y({type:"networkresumed",bubbles:!0});this.dispatchEvent(a);a=this.a.getNumber("max_network_interrupted_time_before_seek",1E4);null!==this.T&&Date.now()-this.T>=a&&(this.T=null,this.ea=!0);this.a.getBool("fix_network_interrupted_start_not_nulled",!1)&&(this.T=null);this.$&&pg(this,this.Ra)};Y.prototype.Vc=function(){this.ea=!0};function Pf(a){a.a.getBool("decouple_mpd_update_loop_from_request_loop",!1)||Kf(a,0)}Y.prototype.qc=function(a){this.na=a};
Y.prototype.setEnableLiveheadCatchup=Y.prototype.qc;Y.prototype.zd=function(){return this.na};Y.prototype.isLiveheadCatchupEnabled=Y.prototype.zd;Y.prototype.Sc=function(){return this.c.video?this.c.video.c.i:null};Y.prototype.getVideoStreamProgressTracker=Y.prototype.Sc;Y.prototype.qb=function(){return this.c.video?this.c.video.qb():null};Y.prototype.getBufferVelocity=Y.prototype.qb;function Rf(a,b){for(var c in a.c)a.c[c].na=b}
function ig(a){var b=[];if(null!==a.ca){var c=a.ca,d;for(d in a.c)b.push(re(a.c[d],a.ca));Promise.all(b).then(J(a,function(){if(c){for(var a in this.c){var b=this.c[a];b.K=null;b.V=!1;b.I=null}c>this.video.currentTime&&(this.video.currentTime=c)}}))}a.ca=null};function Z(a,b,c,d,e,f,g){d||(d=new G);e||(e=new X);Y.call(this,null,b,d,e);"string"===typeof a?this.Nb=a:this.Pb=a;this.a=b;this.F=null;this.ta=c;this.Da=[];this.Rb=[];this.Sb=[];this.Ha=0;this.Y=null;this.Ob=g||null}r(Z,Y);q("shaka.player.DashVideoSource",Z);Z.prototype.Jd=function(a){this.F=a;this.Kb(!0,!0)};Z.prototype.updateManifest=Z.prototype.Jd;Z.prototype.Ab=function(){return this.Pb||this.F};Z.prototype.getManifest=Z.prototype.Ab;Z.prototype.Ub=function(){return this.Ab()};
Z.prototype.debugGetManifest=Z.prototype.Ub;Z.prototype.Zc=function(a,b,c){this.Da.push(a);this.Rb.push(b||"");this.Sb.push(c||"")};Z.prototype.addExternalCaptions=Z.prototype.Zc;Z.prototype.td=function(a){this.Y=a};Z.prototype.setNetworkCallback=Z.prototype.td;Z.prototype.destroy=function(){this.F=this.Y=this.ta=null;Y.prototype.destroy.call(this)};
Z.prototype.wb=function(){var a;this.l&&(a=this.l.getOperationLogger("source_load").start());var b,c=J(this,function(a){if(this.a.getBool("enable_double_ingest_on_initial_mpd",!1))switch(a.status){case 200:case 417:if(a.responseHeaders&&null!=a.responseHeaders["x-fb-video-replica"])return this.dispatchEvent(y({type:"replicaswitch",bubbles:!0,replica:a.responseHeaders["x-fb-video-replica"]})),new Promise(function(){})}0===a.status&&this.dispatchEvent(y({type:"initiallivemanifestrequestfailure",bubbles:!0,
status:a.status,url:this.Nb}));throw a;}),d=J(this,function(c){this.La("MPDFetchDuration",(Date.now()-b)/1E3);this.F=c;for(var d=0;d<this.Da.length;d++)Lc(c,this.Da[d],this.Rb[d],this.Sb[d]);var d=new ye(this.a,this.ta,this.l,this.Ob),e;this.l&&(e=this.l.getOperationLogger("process_manifest").start());this.b=ze(d,c,this.Y);e&&e.log();a&&a.setManifestType(this.b.b?"dynamic":"static");return Y.prototype.wb.call(this).then(function(){a&&a.log()})});if(this.Pb)return b=Date.now(),d(this.Pb);var e=[new L(this.Nb)],
f;if(this.ra){var g=new VideoPushParametersHelper(this.Nb);g.setStreamEndOffset(Math.floor(Lf(this)/1));this.Oa&&g.setPushVideoRepresentationID(this.Oa);this.pa&&g.setPushAudioRepresentationID(this.pa);this.ma&&g.setUseLongCacheForManifest(this.ma);f=new fd(null);f.a=g}e=new K(this.Y,e,void 0,void 0,void 0,this.Ob);f=new dd(e,this.Mb,f,this.da);b=Date.now();return ed(f,this.l).then(d,c)};
Z.prototype.vc=function(){if(this.Vb){var a=this.b;if(a=(a=a&&a.a)&&a[0]){var a=a.a.reduce(function(a,b){return a.concat(b.v)},[]),b=function(a){return null!=a};Promise.all(a.map(function(a){a=a.M;return a.Qc?a.Sa:a.create()})).then(function(a){a=a.filter(b);this.La("InitialSegmentIndexes",a)}.bind(this));Promise.all(a.map(function(a){return a.aa})).then(function(a){a=a.filter(b);this.La("SegmentInitSources",a)}.bind(this))}}};
Z.prototype.yc=function(a,b,c){if(this.video.paused&&this.Ha+1E4>Date.now()&&this.b)return Promise.reject({type:"delay"});var d;if(b&&void 0!=c)d=new fd(b),d.f=c,b=Sf(this),null!=b&&(d.c=b.streamInfoID,d.b=this.pa);else for(b=a.c,c=0;c<b.length;c++){var e=new VideoPushParametersHelper(b[c].toString());this.ma&&e.setUseLongCacheForManifest(this.ma);b[c]=new L(e.getURL())}a=new dd(a,this.Mb,d,this.da);var f=Date.now();return ed(a,this.l).then(J(this,function(a){this.Ha=Date.now();this.La("MPDFetchDuration",
(this.Ha-f)/1E3);this.a.getBool("treat_live_static_manifest_as_dynamic",!1)&&(a.manifestIsLiveStreaming="dynamic"===(this.F?this.F.type:a.type));this.F=a;var b=new ye(this.a,this.ta,this.l,this.Ob);if(this.l)var c=this.l.getOperationLogger("process_manifest").start();a=ze(b,a,this.Y);c&&c.log();return Promise.resolve(a)}))};Z.prototype.xc=function(){var a=ze(new ye(this.a,this.ta),this.F,this.Y);return Promise.resolve(a)};}.bind(g, global))();

module.exports = g.shaka;


/*  */}),null);